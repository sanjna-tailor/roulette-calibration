"use strict";var ds=Object.defineProperty,fs=Object.defineProperties;var hs=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var Vr=Object.prototype.hasOwnProperty,Zr=Object.prototype.propertyIsEnumerable;var Fr=(c,e,d)=>e in c?ds(c,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[e]=d,q=(c,e)=>{for(var d in e||(e={}))Vr.call(e,d)&&Fr(c,d,e[d]);if(At)for(var d of At(e))Zr.call(e,d)&&Fr(c,d,e[d]);return c},be=(c,e)=>fs(c,hs(e));var De=(c,e)=>{var d={};for(var w in c)Vr.call(c,w)&&e.indexOf(w)<0&&(d[w]=c[w]);if(c!=null&&At)for(var w of At(c))e.indexOf(w)<0&&Zr.call(c,w)&&(d[w]=c[w]);return d};Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var Bt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function st(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var un={exports:{}};/*!
 * js-logger - http://github.com/jonnyreeves/js-logger
 * Jonny Reeves, http://jonnyreeves.co.uk/
 * js-logger may be freely distributed under the MIT license.
 */(function(c){(function(e){var d={};d.VERSION="1.6.1";var w,C={},b=function(h,n){return function(){return n.apply(h,arguments)}},m=function(){var h=arguments,n=h[0],i,o;for(o=1;o<h.length;o++)for(i in h[o])!(i in n)&&h[o].hasOwnProperty(i)&&(n[i]=h[o][i]);return n},t=function(h,n){return{value:h,name:n}};d.TRACE=t(1,"TRACE"),d.DEBUG=t(2,"DEBUG"),d.INFO=t(3,"INFO"),d.TIME=t(4,"TIME"),d.WARN=t(5,"WARN"),d.ERROR=t(8,"ERROR"),d.OFF=t(99,"OFF");var v=function(h){this.context=h,this.setLevel(h.filterLevel),this.log=this.info};v.prototype={setLevel:function(h){h&&"value"in h&&(this.context.filterLevel=h)},getLevel:function(){return this.context.filterLevel},enabledFor:function(h){var n=this.context.filterLevel;return h.value>=n.value},trace:function(){this.invoke(d.TRACE,arguments)},debug:function(){this.invoke(d.DEBUG,arguments)},info:function(){this.invoke(d.INFO,arguments)},warn:function(){this.invoke(d.WARN,arguments)},error:function(){this.invoke(d.ERROR,arguments)},time:function(h){typeof h=="string"&&h.length>0&&this.invoke(d.TIME,[h,"start"])},timeEnd:function(h){typeof h=="string"&&h.length>0&&this.invoke(d.TIME,[h,"end"])},invoke:function(h,n){w&&this.enabledFor(h)&&w(n,m({level:h},this.context))}};var y=new v({filterLevel:d.OFF});(function(){var h=d;h.enabledFor=b(y,y.enabledFor),h.trace=b(y,y.trace),h.debug=b(y,y.debug),h.time=b(y,y.time),h.timeEnd=b(y,y.timeEnd),h.info=b(y,y.info),h.warn=b(y,y.warn),h.error=b(y,y.error),h.log=h.info})(),d.setHandler=function(h){w=h},d.setLevel=function(h){y.setLevel(h);for(var n in C)C.hasOwnProperty(n)&&C[n].setLevel(h)},d.getLevel=function(){return y.getLevel()},d.get=function(h){return C[h]||(C[h]=new v(m({name:h},y.context)))},d.createDefaultHandler=function(h){h=h||{},h.formatter=h.formatter||function(s,r){r.name&&s.unshift("["+r.name+"]")};var n={},i=function(o,s){Function.prototype.apply.call(o,console,s)};return typeof console>"u"?function(){}:function(o,s){o=Array.prototype.slice.call(o);var r=console.log,l;s.level===d.TIME?(l=(s.name?"["+s.name+"] ":"")+o[0],o[1]==="start"?console.time?console.time(l):n[l]=new Date().getTime():console.timeEnd?console.timeEnd(l):i(r,[l+": "+(new Date().getTime()-n[l])+"ms"])):(s.level===d.WARN&&console.warn?r=console.warn:s.level===d.ERROR&&console.error?r=console.error:s.level===d.INFO&&console.info?r=console.info:s.level===d.DEBUG&&console.debug?r=console.debug:s.level===d.TRACE&&console.trace&&(r=console.trace),h.formatter(o,s),i(r,o))}},d.useDefaults=function(h){d.setLevel(h&&h.defaultLevel||d.DEBUG),d.setHandler(d.createDefaultHandler(h))},d.setDefaults=d.useDefaults,c.exports?c.exports=d:(d._prevLogger=e.Logger,d.noConflict=function(){return e.Logger=d._prevLogger,d},e.Logger=d)})(Bt)})(un);var ps=un.exports;const We=st(ps),dn="0.2.1",Pt=60;var ln;const ms=((ln=window==null?void 0:window.navigator)==null?void 0:ln.userAgent)||"No user agent available";let Mt="",Ot="",$t="",it="",ot="",Wr="",Nt="",jt=0;const Dt=[];function gs(c){function e(d,w){return{ts:Math.round(w.timestamp)||"",ot:d==="audio"?"a":"v",bl:w.jitterBufferDelay||0,br:Math.round(w.bitrateBitsPerSecond||0),pld:w.packetsLostDeltaPerSecond||0,j:w.jitter||0,mtp:w.packetRate||0,mid:w.mid||"",mimeType:w.mimeType||""}}return c.stats=c.stats.reduce((d,w)=>{const C=w.audio.inbounds.length!==0?w.audio.inbounds.map(m=>e("audio",m)):w.audio.outbounds.map(m=>e("audio",m)),b=w.video.inbounds.length!==0?w.video.inbounds.map(m=>e("video",m)):w.video.outbounds.map(m=>e("video",m));return d.concat([...C,...b])},[]),c}const ve={initAccountId:c=>{Mt=Mt===""?c:Mt},initStreamName:c=>{Ot=Ot===""?c:Ot},initSubscriberId:c=>{$t=$t===""?c:$t},initStreamViewId:c=>{it=it===""?c:it},initFeedId:c=>{ot=ot===""?c:ot},setConnectionTime:c=>{jt=jt===0?c:jt},setConnectionState:c=>{Wr=c},setClusterId:c=>{Nt=Nt===""?c:Nt},addStats:c=>{Dt.length===Pt&&Dt.shift(),Dt.push(c)},get:(c=Pt,e="JSON")=>{let d;!Number.isInteger(c)||c>Pt||c<=0?d=Pt:d=c;const w={client:"@millicast/millicast-sdk",version:dn,timestamp:new Date().toISOString(),userAgent:ms,clusterId:Nt,accountId:Mt,streamName:Ot,subscriberId:$t,connection:Wr,stats:Dt.slice(-d),connectionDurationMs:new Date().getTime()-jt};return ot!==""?w.feedId=ot:it!==""&&(w.streamViewId=it),e==="CMCD"?gs(w):w}};We.useDefaults({defaultLevel:We.TRACE});const Ft=["TRACE","DEBUG","INFO","WARN","ERROR"],fn=(c,e)=>{c.unshift("[".concat(e.name||"Global","] ").concat(new Date().toISOString()," - ").concat(e.level.name," -"))},hn=(c,e)=>e?c.value>=Fe[e].value:c.value>=Vt.value,ys=(c,e)=>{c=Array.prototype.slice.call(c),c=c.map(d=>typeof d=="object"?JSON.stringify(d):d),fn(c,e),dt!==0?(Je.push(c.join(" ")),Je.length>=dt&&(Je=Je.slice(-dt))):Je=[]},bs=We.createDefaultHandler({formatter:fn});We.setHandler((c,e)=>{ys(c,e),hn(e.level,e.name)&&bs(c,e);for(const{handler:d,level:w}of pn)e.level.value>=w.value&&d(c,e)});const vs=1e4;let dt=vs,Je=[],Vt=We.OFF;const Fe={},pn=[],Oe=be(q({},We),{enabledFor:hn,getHistory:()=>Je,getHistoryMaxSize:()=>dt,setHistoryMaxSize:c=>{dt=c},setLevel:c=>{Vt=c;for(const e in Fe)Fe[e]=c},getLevel:()=>Vt,get:c=>{Fe[c]||(Fe[c]=Vt);const e=We.get(c);return e.setLevel=d=>{Fe[c]=d},e.getLevel=()=>Fe[c],e},setHandler:(c,e)=>{pn.push({handler:c,level:e})},diagnose:(c={})=>{let e;const d={statsCount:60,historySize:1e3,minLogLevel:"TRACE",statsFormat:"JSON"};typeof c=="number"?(d.statsCount=c,e=d):e=q(q({},d),c);const{statsCount:w,historySize:C,minLogLevel:b,statsFormat:m}=e,t=ve.get(w,m),v=Oe.getHistory();if(!Number.isInteger(C)||C<=0)throw new Error("Invalid Argument Exception : historySize must be a positive integer.");if(!Ft.includes(b.toUpperCase()))throw new Error('Invalid Argument Exception : the minLogLevel parameter only excepts "trace", "debug", "info", "warn", and "error" as arguments.');if(Ft.includes(b.toUpperCase())){const y=Ft.slice(Ft.indexOf(b.toUpperCase())),h=v.filter(n=>y.some(i=>n.includes(i)));t.history=h.slice(-C)}return t},JSON:"JSON",CMCD:"CMCD",VERSION:dn});var vr={exports:{}},et=typeof Reflect=="object"?Reflect:null,Ur=et&&typeof et.apply=="function"?et.apply:function(e,d,w){return Function.prototype.apply.call(e,d,w)},Zt;et&&typeof et.ownKeys=="function"?Zt=et.ownKeys:Object.getOwnPropertySymbols?Zt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Zt=function(e){return Object.getOwnPropertyNames(e)};function ws(c){console&&console.warn&&console.warn(c)}var mn=Number.isNaN||function(e){return e!==e};function oe(){oe.init.call(this)}vr.exports=oe;vr.exports.once=Cs;oe.EventEmitter=oe;oe.prototype._events=void 0;oe.prototype._eventsCount=0;oe.prototype._maxListeners=void 0;var Gr=10;function Yt(c){if(typeof c!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof c)}Object.defineProperty(oe,"defaultMaxListeners",{enumerable:!0,get:function(){return Gr},set:function(c){if(typeof c!="number"||c<0||mn(c))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+c+".");Gr=c}});oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||mn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function gn(c){return c._maxListeners===void 0?oe.defaultMaxListeners:c._maxListeners}oe.prototype.getMaxListeners=function(){return gn(this)};oe.prototype.emit=function(e){for(var d=[],w=1;w<arguments.length;w++)d.push(arguments[w]);var C=e==="error",b=this._events;if(b!==void 0)C=C&&b.error===void 0;else if(!C)return!1;if(C){var m;if(d.length>0&&(m=d[0]),m instanceof Error)throw m;var t=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw t.context=m,t}var v=b[e];if(v===void 0)return!1;if(typeof v=="function")Ur(v,this,d);else for(var y=v.length,h=xn(v,y),w=0;w<y;++w)Ur(h[w],this,d);return!0};function yn(c,e,d,w){var C,b,m;if(Yt(d),b=c._events,b===void 0?(b=c._events=Object.create(null),c._eventsCount=0):(b.newListener!==void 0&&(c.emit("newListener",e,d.listener?d.listener:d),b=c._events),m=b[e]),m===void 0)m=b[e]=d,++c._eventsCount;else if(typeof m=="function"?m=b[e]=w?[d,m]:[m,d]:w?m.unshift(d):m.push(d),C=gn(c),C>0&&m.length>C&&!m.warned){m.warned=!0;var t=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");t.name="MaxListenersExceededWarning",t.emitter=c,t.type=e,t.count=m.length,ws(t)}return c}oe.prototype.addListener=function(e,d){return yn(this,e,d,!1)};oe.prototype.on=oe.prototype.addListener;oe.prototype.prependListener=function(e,d){return yn(this,e,d,!0)};function xs(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bn(c,e,d){var w={fired:!1,wrapFn:void 0,target:c,type:e,listener:d},C=xs.bind(w);return C.listener=d,w.wrapFn=C,C}oe.prototype.once=function(e,d){return Yt(d),this.on(e,bn(this,e,d)),this};oe.prototype.prependOnceListener=function(e,d){return Yt(d),this.prependListener(e,bn(this,e,d)),this};oe.prototype.removeListener=function(e,d){var w,C,b,m,t;if(Yt(d),C=this._events,C===void 0)return this;if(w=C[e],w===void 0)return this;if(w===d||w.listener===d)--this._eventsCount===0?this._events=Object.create(null):(delete C[e],C.removeListener&&this.emit("removeListener",e,w.listener||d));else if(typeof w!="function"){for(b=-1,m=w.length-1;m>=0;m--)if(w[m]===d||w[m].listener===d){t=w[m].listener,b=m;break}if(b<0)return this;b===0?w.shift():Ss(w,b),w.length===1&&(C[e]=w[0]),C.removeListener!==void 0&&this.emit("removeListener",e,t||d)}return this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.removeAllListeners=function(e){var d,w,C;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[e]),this;if(arguments.length===0){var b=Object.keys(w),m;for(C=0;C<b.length;++C)m=b[C],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(d=w[e],typeof d=="function")this.removeListener(e,d);else if(d!==void 0)for(C=d.length-1;C>=0;C--)this.removeListener(e,d[C]);return this};function vn(c,e,d){var w=c._events;if(w===void 0)return[];var C=w[e];return C===void 0?[]:typeof C=="function"?d?[C.listener||C]:[C]:d?_s(C):xn(C,C.length)}oe.prototype.listeners=function(e){return vn(this,e,!0)};oe.prototype.rawListeners=function(e){return vn(this,e,!1)};oe.listenerCount=function(c,e){return typeof c.listenerCount=="function"?c.listenerCount(e):wn.call(c,e)};oe.prototype.listenerCount=wn;function wn(c){var e=this._events;if(e!==void 0){var d=e[c];if(typeof d=="function")return 1;if(d!==void 0)return d.length}return 0}oe.prototype.eventNames=function(){return this._eventsCount>0?Zt(this._events):[]};function xn(c,e){for(var d=new Array(e),w=0;w<e;++w)d[w]=c[w];return d}function Ss(c,e){for(;e+1<c.length;e++)c[e]=c[e+1];c.pop()}function _s(c){for(var e=new Array(c.length),d=0;d<e.length;++d)e[d]=c[d].listener||c[d];return e}function Cs(c,e){return new Promise(function(d,w){function C(m){c.removeListener(e,b),w(m)}function b(){typeof c.removeListener=="function"&&c.removeListener("error",C),d([].slice.call(arguments))}Sn(c,e,b,{once:!0}),e!=="error"&&Rs(c,C,{once:!0})})}function Rs(c,e,d){typeof c.on=="function"&&Sn(c,"error",e,d)}function Sn(c,e,d,w){if(typeof c.on=="function")w.once?c.once(e,d):c.on(e,d);else if(typeof c.addEventListener=="function")c.addEventListener(e,function C(b){w.once&&c.removeEventListener(e,C),d(b)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof c)}var wr=vr.exports;const Ht=st(wr);var xr={exports:{}};xr.exports=_n;xr.exports.filter=ks;var Is=wr.EventEmitter;function _n(c,e,d){Array.isArray(d)||(d=[d]);var w=[];return d.forEach(function(C){var b=function(){var m=[].slice.call(arguments);m.unshift(C),e.emit.apply(e,m)};w.push(b),c.on(C,b)}),function(){d.forEach(function(b,m){c.removeListener(b,w[m])})}}function ks(c,e){var d=new Is;return _n(c,d,e),d}var Es=xr.exports;const ft=st(Es);var Cn={exports:{}};/*! For license information please see webrtc-stats.js.LICENSE.txt */(function(c,e){(function(d,w){c.exports=w()})(self,()=>{return d={7:C=>{var b,m=typeof Reflect=="object"?Reflect:null,t=m&&typeof m.apply=="function"?m.apply:function(p,_,k){return Function.prototype.apply.call(p,_,k)};b=m&&typeof m.ownKeys=="function"?m.ownKeys:Object.getOwnPropertySymbols?function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:function(p){return Object.getOwnPropertyNames(p)};var v=Number.isNaN||function(p){return p!=p};function y(){y.init.call(this)}C.exports=y,C.exports.once=function(p,_){return new Promise(function(k,E){function g(I){p.removeListener(_,R),E(I)}function R(){typeof p.removeListener=="function"&&p.removeListener("error",g),k([].slice.call(arguments))}f(p,_,R,{once:!0}),_!=="error"&&function(I,A,O){typeof I.on=="function"&&f(I,"error",A,{once:!0})}(p,g)})},y.EventEmitter=y,y.prototype._events=void 0,y.prototype._eventsCount=0,y.prototype._maxListeners=void 0;var h=10;function n(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}function i(p){return p._maxListeners===void 0?y.defaultMaxListeners:p._maxListeners}function o(p,_,k,E){var g,R,I,A;if(n(k),(R=p._events)===void 0?(R=p._events=Object.create(null),p._eventsCount=0):(R.newListener!==void 0&&(p.emit("newListener",_,k.listener?k.listener:k),R=p._events),I=R[_]),I===void 0)I=R[_]=k,++p._eventsCount;else if(typeof I=="function"?I=R[_]=E?[k,I]:[I,k]:E?I.unshift(k):I.push(k),(g=i(p))>0&&I.length>g&&!I.warned){I.warned=!0;var O=new Error("Possible EventEmitter memory leak detected. "+I.length+" "+String(_)+" listeners added. Use emitter.setMaxListeners() to increase limit");O.name="MaxListenersExceededWarning",O.emitter=p,O.type=_,O.count=I.length,A=O,console&&console.warn&&console.warn(A)}return p}function s(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function r(p,_,k){var E={fired:!1,wrapFn:void 0,target:p,type:_,listener:k},g=s.bind(E);return g.listener=k,E.wrapFn=g,g}function l(p,_,k){var E=p._events;if(E===void 0)return[];var g=E[_];return g===void 0?[]:typeof g=="function"?k?[g.listener||g]:[g]:k?function(R){for(var I=new Array(R.length),A=0;A<I.length;++A)I[A]=R[A].listener||R[A];return I}(g):u(g,g.length)}function a(p){var _=this._events;if(_!==void 0){var k=_[p];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}function u(p,_){for(var k=new Array(_),E=0;E<_;++E)k[E]=p[E];return k}function f(p,_,k,E){if(typeof p.on=="function")E.once?p.once(_,k):p.on(_,k);else{if(typeof p.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p);p.addEventListener(_,function g(R){E.once&&p.removeEventListener(_,g),k(R)})}}Object.defineProperty(y,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(p){if(typeof p!="number"||p<0||v(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");h=p}}),y.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},y.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||v(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this},y.prototype.getMaxListeners=function(){return i(this)},y.prototype.emit=function(p){for(var _=[],k=1;k<arguments.length;k++)_.push(arguments[k]);var E=p==="error",g=this._events;if(g!==void 0)E=E&&g.error===void 0;else if(!E)return!1;if(E){var R;if(_.length>0&&(R=_[0]),R instanceof Error)throw R;var I=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw I.context=R,I}var A=g[p];if(A===void 0)return!1;if(typeof A=="function")t(A,this,_);else{var O=A.length,N=u(A,O);for(k=0;k<O;++k)t(N[k],this,_)}return!0},y.prototype.addListener=function(p,_){return o(this,p,_,!1)},y.prototype.on=y.prototype.addListener,y.prototype.prependListener=function(p,_){return o(this,p,_,!0)},y.prototype.once=function(p,_){return n(_),this.on(p,r(this,p,_)),this},y.prototype.prependOnceListener=function(p,_){return n(_),this.prependListener(p,r(this,p,_)),this},y.prototype.removeListener=function(p,_){var k,E,g,R,I;if(n(_),(E=this._events)===void 0)return this;if((k=E[p])===void 0)return this;if(k===_||k.listener===_)--this._eventsCount==0?this._events=Object.create(null):(delete E[p],E.removeListener&&this.emit("removeListener",p,k.listener||_));else if(typeof k!="function"){for(g=-1,R=k.length-1;R>=0;R--)if(k[R]===_||k[R].listener===_){I=k[R].listener,g=R;break}if(g<0)return this;g===0?k.shift():function(A,O){for(;O+1<A.length;O++)A[O]=A[O+1];A.pop()}(k,g),k.length===1&&(E[p]=k[0]),E.removeListener!==void 0&&this.emit("removeListener",p,I||_)}return this},y.prototype.off=y.prototype.removeListener,y.prototype.removeAllListeners=function(p){var _,k,E;if((k=this._events)===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[p]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete k[p]),this;if(arguments.length===0){var g,R=Object.keys(k);for(E=0;E<R.length;++E)(g=R[E])!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(_=k[p])=="function")this.removeListener(p,_);else if(_!==void 0)for(E=_.length-1;E>=0;E--)this.removeListener(p,_[E]);return this},y.prototype.listeners=function(p){return l(this,p,!0)},y.prototype.rawListeners=function(p){return l(this,p,!1)},y.listenerCount=function(p,_){return typeof p.listenerCount=="function"?p.listenerCount(_):a.call(p,_)},y.prototype.listenerCount=a,y.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},586:function(C,b,m){var t,v;(function(y){var h,n={VERSION:"1.6.1"},i={},o=function(f,p){return function(){return p.apply(f,arguments)}},s=function(){var f,p,_=arguments,k=_[0];for(p=1;p<_.length;p++)for(f in _[p])!(f in k)&&_[p].hasOwnProperty(f)&&(k[f]=_[p][f]);return k},r=function(f,p){return{value:f,name:p}};n.TRACE=r(1,"TRACE"),n.DEBUG=r(2,"DEBUG"),n.INFO=r(3,"INFO"),n.TIME=r(4,"TIME"),n.WARN=r(5,"WARN"),n.ERROR=r(8,"ERROR"),n.OFF=r(99,"OFF");var l=function(f){this.context=f,this.setLevel(f.filterLevel),this.log=this.info};l.prototype={setLevel:function(f){f&&"value"in f&&(this.context.filterLevel=f)},getLevel:function(){return this.context.filterLevel},enabledFor:function(f){var p=this.context.filterLevel;return f.value>=p.value},trace:function(){this.invoke(n.TRACE,arguments)},debug:function(){this.invoke(n.DEBUG,arguments)},info:function(){this.invoke(n.INFO,arguments)},warn:function(){this.invoke(n.WARN,arguments)},error:function(){this.invoke(n.ERROR,arguments)},time:function(f){typeof f=="string"&&f.length>0&&this.invoke(n.TIME,[f,"start"])},timeEnd:function(f){typeof f=="string"&&f.length>0&&this.invoke(n.TIME,[f,"end"])},invoke:function(f,p){h&&this.enabledFor(f)&&h(p,s({level:f},this.context))}};var a,u=new l({filterLevel:n.OFF});(a=n).enabledFor=o(u,u.enabledFor),a.trace=o(u,u.trace),a.debug=o(u,u.debug),a.time=o(u,u.time),a.timeEnd=o(u,u.timeEnd),a.info=o(u,u.info),a.warn=o(u,u.warn),a.error=o(u,u.error),a.log=a.info,n.setHandler=function(f){h=f},n.setLevel=function(f){for(var p in u.setLevel(f),i)i.hasOwnProperty(p)&&i[p].setLevel(f)},n.getLevel=function(){return u.getLevel()},n.get=function(f){return i[f]||(i[f]=new l(s({name:f},u.context)))},n.createDefaultHandler=function(f){(f=f||{}).formatter=f.formatter||function(k,E){E.name&&k.unshift("["+E.name+"]")};var p={},_=function(k,E){Function.prototype.apply.call(k,console,E)};return typeof console>"u"?function(){}:function(k,E){k=Array.prototype.slice.call(k);var g,R=console.log;E.level===n.TIME?(g=(E.name?"["+E.name+"] ":"")+k[0],k[1]==="start"?console.time?console.time(g):p[g]=new Date().getTime():console.timeEnd?console.timeEnd(g):_(R,[g+": "+(new Date().getTime()-p[g])+"ms"])):(E.level===n.WARN&&console.warn?R=console.warn:E.level===n.ERROR&&console.error?R=console.error:E.level===n.INFO&&console.info?R=console.info:E.level===n.DEBUG&&console.debug?R=console.debug:E.level===n.TRACE&&console.trace&&(R=console.trace),f.formatter(k,E),_(R,k))}},n.useDefaults=function(f){n.setLevel(f&&f.defaultLevel||n.DEBUG),n.setHandler(n.createDefaultHandler(f))},n.setDefaults=n.useDefaults,(v=typeof(t=n)=="function"?t.call(b,m,b,C):t)===void 0||(C.exports=v)})()},156:function(C,b,m){var t=this&&this.__createBinding||(Object.create?function(n,i,o,s){s===void 0&&(s=o);var r=Object.getOwnPropertyDescriptor(i,o);r&&!("get"in r?!i.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,s,r)}:function(n,i,o,s){s===void 0&&(s=o),n[s]=i[o]}),v=this&&this.__exportStar||function(n,i){for(var o in n)o==="default"||Object.prototype.hasOwnProperty.call(i,o)||t(i,n,o)},y=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(b,"__esModule",{value:!0}),b.Logger=void 0;var h=m(586);Object.defineProperty(b,"Logger",{enumerable:!0,get:function(){return y(h).default}}),v(m(284),b),v(m(280),b),v(m(738),b),v(m(767),b)},738:(C,b)=>{var m;Object.defineProperty(b,"__esModule",{value:!0}),b.QualityLimitationReason=void 0,function(t){t[t.none=0]="none",t[t.cpu=1]="cpu",t[t.bandwidth=2]="bandwidth",t[t.other=3]="other"}(m||(b.QualityLimitationReason=m={}))},280:(C,b)=>{Object.defineProperty(b,"__esModule",{value:!0})},767:(C,b)=>{Object.defineProperty(b,"__esModule",{value:!0})},185:(C,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.calculatePacketsLostRatio=b.calculateRate=b.getMediaKind=void 0,b.getMediaKind=m=>{let t=m.kind||m.mediaType;return["audio","video"].includes(t)||m.type!=="inbound-rtp"||(t=m.id.toLocaleLowerCase().includes("video")?"video":"audio"),t},b.calculateRate=(m,t,v,y)=>v&&y?(t-y)/((m-v)/1e3):0,b.calculatePacketsLostRatio=(m,t,v,y)=>t==0?0:(m-(v!=null?v:0))/(t-(y!=null?y:0))},284:function(C,b,m){var t,v,y,h,n,i,o,s,r,l,a,u,f,p,_,k,E=this&&this.__awaiter||function(Z,M,F,X){return new(F||(F=Promise))(function(U,W){function K(ie){try{se(X.next(ie))}catch(le){W(le)}}function ee(ie){try{se(X.throw(ie))}catch(le){W(le)}}function se(ie){var le;ie.done?U(ie.value):(le=ie.value,le instanceof F?le:new F(function(ge){ge(le)})).then(K,ee)}se((X=X.apply(Z,M||[])).next())})},g=this&&this.__classPrivateFieldSet||function(Z,M,F,X,U){if(X==="m")throw new TypeError("Private method is not writable");if(X==="a"&&!U)throw new TypeError("Private accessor was defined without a setter");if(typeof M=="function"?Z!==M||!U:!M.has(Z))throw new TypeError("Cannot write private member to an object whose class did not declare it");return X==="a"?U.call(Z,F):U?U.value=F:M.set(Z,F),F},R=this&&this.__classPrivateFieldGet||function(Z,M,F,X){if(F==="a"&&!X)throw new TypeError("Private accessor was defined without a getter");if(typeof M=="function"?Z!==M||!X:!M.has(Z))throw new TypeError("Cannot read private member from an object whose class did not declare it");return F==="m"?X:F==="a"?X.call(Z):X?X.value:M.get(Z)},I=this&&this.__importDefault||function(Z){return Z&&Z.__esModule?Z:{default:Z}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebRTCStats=void 0;const A=m(7),O=I(m(586)),N=m(738),V=m(185);class B extends A.EventEmitter{constructor(M){super(),t.add(this),v.set(this,void 0),y.set(this,void 0),h.set(this,void 0),n.set(this,null),i.set(this,void 0),o.set(this,null),this.start=()=>{R(this,i,"f").info("WebRTC statistics collection is starting..."),g(this,o,null,"f"),g(this,n,setInterval(R(this,s,"f"),R(this,y,"f")),"f")},this.stop=()=>{R(this,n,"f")&&(clearInterval(R(this,n,"f")),g(this,n,null,"f"),R(this,i,"f").info("WebRTC statistics collection has stopped."))},s.set(this,()=>E(this,void 0,void 0,function*(){let F,X;try{R(this,i,"f").trace("Requesting WebRTC statistics..."),F=yield R(this,v,"f").call(this),X=new Date().toISOString()}catch(K){return R(this,i,"f").error("Problem collecting the WebRTC statistics.",K),void this.emit("error","Problem collecting the WebRTC statistics - ".concat(K))}const U=Array.from(F.values()),W={timestamp:X,input:{audio:[],video:[]},output:{audio:[],video:[]}};R(this,h,"f")&&(W.rawStats=F);for(let K=0;K<Object.keys(U).length;K++){const ee=U[K];switch(ee.type){case"outbound-rtp":const se=ee,ie=(0,V.getMediaKind)(se);ie==="audio"?yield R(this,t,"m",a).call(this,F,se,W):ie==="video"&&(yield R(this,t,"m",u).call(this,F,se,W));break;case"inbound-rtp":const le=ee;let ge=(0,V.getMediaKind)(le);ge==="audio"?yield R(this,t,"m",p).call(this,F,le,W):ge==="video"&&(yield R(this,t,"m",_).call(this,F,le,W));break;case"candidate-pair":const Ae=ee;Ae.nominated&&R(this,t,"m",k).call(this,Ae,W)}}g(this,o,W,"f"),this.emit("stats",W)})),g(this,i,O.default.get("WebRTCStats"),"f"),g(this,v,M.getStats,"f"),g(this,y,M.getStatsInterval||1e3,"f"),g(this,h,!!M.includeRawStats,"f")}}b.WebRTCStats=B,v=new WeakMap,y=new WeakMap,h=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,s=new WeakMap,t=new WeakSet,r=function(Z,M){if(M){const F=Z.get(M);if(F)return{mimeType:F.mimeType}}return{}},l=function(Z,M,F){return E(this,void 0,void 0,function*(){var X,U,W,K;const ee=(0,V.calculateRate)(M.timestamp,M.bytesSent,F==null?void 0:F.timestamp,F==null?void 0:F.totalBytesSent),se=(0,V.calculateRate)(M.timestamp,M.packetsSent,F==null?void 0:F.timestamp,F==null?void 0:F.totalPacketsSent),ie=R(this,t,"m",r).call(this,Z,M.codecId);return Object.assign({id:M.id,timestamp:M.timestamp,mid:M.mid,totalBytesSent:M.bytesSent,bytesSentDelta:M.bytesSent-((X=F==null?void 0:F.totalBytesSent)!==null&&X!==void 0?X:0),totalPacketsSent:M.packetsSent,packetsSentDelta:M.packetsSent-((U=F==null?void 0:F.totalPacketsSent)!==null&&U!==void 0?U:0),bitrate:ee,packetRate:se,targetBitrate:M.targetBitrate,retransmittedPacketsSent:M.retransmittedPacketsSent,retransmittedPacketsSentDelta:M.retransmittedPacketsSent-((W=F==null?void 0:F.retransmittedPacketsSent)!==null&&W!==void 0?W:0),retransmittedBytesSent:M.retransmittedBytesSent,retransmittedBytesSentDelta:M.retransmittedBytesSent-((K=F==null?void 0:F.retransmittedBytesSent)!==null&&K!==void 0?K:0)},ie)})},a=function(Z,M,F){return E(this,void 0,void 0,function*(){var X;const U=(X=R(this,o,"f"))===null||X===void 0?void 0:X.output.audio.find(ee=>ee.id===M.id);if(U&&M.timestamp-U.timestamp<=0)return;const W=yield R(this,t,"m",l).call(this,Z,M,U),K=Object.assign({},W);F.output.audio.push(K)})},u=function(Z,M,F){return E(this,void 0,void 0,function*(){var X;const U=(X=R(this,o,"f"))===null||X===void 0?void 0:X.output.video.find(se=>se.id===M.id);if(U&&M.timestamp-U.timestamp<=0)return;const W=yield R(this,t,"m",l).call(this,Z,M,U);let K=N.QualityLimitationReason.none;M.qualityLimitationReason&&(K=M.qualityLimitationReason);const ee=Object.assign(Object.assign({},W),{frameWidth:M.frameWidth,frameHeight:M.frameHeight,framesPerSecond:M.framesPerSecond,framesSent:M.framesSent,qualityLimitationReason:K,qualityLimitationDurations:M.qualityLimitationDurations});F.output.video.push(ee)})},f=function(Z,M,F){return E(this,void 0,void 0,function*(){var X,U;const W=(0,V.calculateRate)(M.timestamp,M.bytesReceived,F==null?void 0:F.timestamp,F==null?void 0:F.totalBytesReceived),K=(0,V.calculateRate)(M.timestamp,M.packetsReceived,F==null?void 0:F.timestamp,F==null?void 0:F.totalPacketsReceived),ee=(0,V.calculatePacketsLostRatio)(M.packetsReceived,M.packetsLost,F==null?void 0:F.totalPacketsReceived,F==null?void 0:F.totalPacketsLost),se=((X=M.packetsLost)!==null&&X!==void 0?X:0)-((U=F==null?void 0:F.totalPacketsLost)!==null&&U!==void 0?U:0),ie=R(this,t,"m",r).call(this,Z,M.codecId);return Object.assign({id:M.id,timestamp:M.timestamp,mid:M.mid,trackIdentifier:M.trackIdentifier,jitter:M.jitter,jitterBufferDelay:M.jitterBufferDelay,jitterBufferEmittedCount:M.jitterBufferEmittedCount,totalBytesReceived:M.bytesReceived,totalPacketsReceived:M.packetsReceived,totalPacketsLost:M.packetsLost,bitrate:W,packetRate:K,packetLossRatio:ee,packetLossDelta:se},ie)})},p=function(Z,M,F){return E(this,void 0,void 0,function*(){var X;const U=(X=R(this,o,"f"))===null||X===void 0?void 0:X.input.audio.find(K=>K.id===M.id);if(U&&M.timestamp-U.timestamp<=0)return;const W=yield R(this,t,"m",f).call(this,Z,M,U);F.input.audio.push(W)})},_=function(Z,M,F){return E(this,void 0,void 0,function*(){var X;const U=(X=R(this,o,"f"))===null||X===void 0?void 0:X.input.video.find(ee=>ee.id===M.id);if(U&&M.timestamp-U.timestamp<=0)return;const W=yield R(this,t,"m",f).call(this,Z,M,U),K=Object.assign(Object.assign({},W),{keyFramesDecoded:M.keyFramesDecoded,frameHeight:M.frameHeight,frameWidth:M.frameWidth,framesDecoded:M.framesDecoded,framesDropped:M.framesDropped,framesPerSecond:M.framesPerSecond,framesReceived:M.framesReceived});F.input.video.push(K)})},k=function(Z,M){M.totalRoundTripTime=Z.totalRoundTripTime,M.currentRoundTripTime=Z.currentRoundTripTime,M.responsesReceived=Z.responsesReceived,M.availableOutgoingBitrate=Z.availableOutgoingBitrate,M.availableIncomingBitrate=Z.availableIncomingBitrate}}},w={},function C(b){var m=w[b];if(m!==void 0)return m.exports;var t=w[b]={exports:{}};return d[b].call(t.exports,t,t.exports,C),t.exports}(156);var d,w})})(Cn);var Ts=Cn.exports;const at=Oe.get("PeerConnectionStats"),Rn={stats:"stats"},Ls=c=>{const m=c,{input:e,output:d,rawStats:w}=m,C=De(m,["input","output","rawStats"]);return be(q({},C),{audio:{inbounds:c.input.audio.map(n=>{var i=n,{packetLossRatio:t,packetLossDelta:v,bitrate:y}=i,h=De(i,["packetLossRatio","packetLossDelta","bitrate"]);return q({packetsLostRatioPerSecond:t,packetsLostDeltaPerSecond:v,bitrateBitsPerSecond:y*8,bitrate:y},h)}),outbounds:c.output.audio.map(n=>{var i=n,{packetLossRatio:t,packetLossDelta:v,bitrate:y}=i,h=De(i,["packetLossRatio","packetLossDelta","bitrate"]);return q({packetsLostRatioPerSecond:t,packetsLostDeltaPerSecond:v,bitrateBitsPerSecond:y*8,bitrate:y},h)})},video:{inbounds:c.input.video.map(n=>{var i=n,{packetLossRatio:t,packetLossDelta:v,bitrate:y}=i,h=De(i,["packetLossRatio","packetLossDelta","bitrate"]);return q({packetsLostRatioPerSecond:t,packetsLostDeltaPerSecond:v,bitrateBitsPerSecond:y*8,bitrate:y},h)}),outbounds:c.output.video.map(n=>{var i=n,{packetLossRatio:t,packetLossDelta:v,bitrate:y}=i,h=De(i,["packetLossRatio","packetLossDelta","bitrate"]);return q({packetsLostRatioPerSecond:t,packetsLostDeltaPerSecond:v,bitrateBitsPerSecond:y*8,bitrate:y},h)})},raw:c.rawStats})};class As extends Ht{constructor(e,d={statsIntervalMs:1e3,autoInitStats:!0}){super(),this.peer=e,this.collection=null,this.initialized=!1,d.autoInitStats&&this.init(d.statsIntervalMs)}init(e){if(this.initialized){at.warn("PeerConnectionStats.init() has already been called. Automatic initialization occurs when the PeerConnectionStats object is constructed.");return}at.info("Initializing peer connection stats");const d=this.peer;try{this.collection=new Ts.WebRTCStats({getStatsInterval:e,getStats:()=>d.getStats(),includeRawStats:!0}),this.collection.on("stats",w=>{const C=Ls(w);ve.addStats(C),this.emit(Rn.stats,C)}),this.collection.start(),this.initialized=!0}catch(w){at.error(w)}}parseStats(e){return at.warn("The parseStats method is deprecated and will be removed in future releases."),null}stop(){at.info("Stopping peer connection stats"),this.collection.stop()}}var fe={},$e={},In={},kn={exports:{}},Br=kn.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(c){return c.encoding?"rtpmap:%d %s/%s/%s":c.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(c){return c.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(c){return c.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(c){return"extmap:%d"+(c.direction?"/%s":"%v")+(c["encrypt-uri"]?" %s":"%v")+" %s"+(c.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(c){return c.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(c){var e="candidate:%s %d %s %d %s %d typ %s";return e+=c.raddr!=null?" raddr %s rport %d":"%v%v",e+=c.tcptype!=null?" tcptype %s":"%v",c.generation!=null&&(e+=" generation %d"),e+=c["network-id"]!=null?" network-id %d":"%v",e+=c["network-cost"]!=null?" network-cost %d":"%v",e}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(c){var e="ssrc:%d";return c.attribute!=null&&(e+=" %s",c.value!=null&&(e+=":%s")),e}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(c){return c.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(c){return c.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(c){return"imageattr:%s %s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(c){return"simulcast:%s %s"+(c.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(c){return"ts-refclk:%s"+(c.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(c){var e="mediaclk:";return e+=c.id!=null?"id=%s %s":"%v%s",e+=c.mediaClockValue!=null?"=%s":"",e+=c.rateNumerator!=null?" rate=%s":"",e+=c.rateDenominator!=null?"/%s":"",e}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Br).forEach(function(c){var e=Br[c];e.forEach(function(d){d.reg||(d.reg=/(.*)/),d.format||(d.format="%s")})});var En=kn.exports;(function(c){var e=function(t){return String(Number(t))===t?Number(t):t},d=function(t,v,y,h){if(h&&!y)v[h]=e(t[1]);else for(var n=0;n<y.length;n+=1)t[n+1]!=null&&(v[y[n]]=e(t[n+1]))},w=function(t,v,y){var h=t.name&&t.names;t.push&&!v[t.push]?v[t.push]=[]:h&&!v[t.name]&&(v[t.name]={});var n=t.push?{}:h?v[t.name]:v;d(y.match(t.reg),n,t.names,t.name),t.push&&v[t.push].push(n)},C=En,b=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(t){var v={},y=[],h=v;return t.split(/(\r\n|\r|\n)/).filter(b).forEach(function(n){var i=n[0],o=n.slice(2);i==="m"&&(y.push({rtp:[],fmtp:[]}),h=y[y.length-1]);for(var s=0;s<(C[i]||[]).length;s+=1){var r=C[i][s];if(r.reg.test(o))return w(r,h,o)}}),v.media=y,v};var m=function(t,v){var y=v.split(/=(.+)/,2);return y.length===2?t[y[0]]=e(y[1]):y.length===1&&v.length>1&&(t[y[0]]=void 0),t};c.parseParams=function(t){return t.split(/;\s?/).reduce(m,{})},c.parseFmtpConfig=c.parseParams,c.parsePayloads=function(t){return t.toString().split(" ").map(Number)},c.parseRemoteCandidates=function(t){for(var v=[],y=t.split(" ").map(e),h=0;h<y.length;h+=3)v.push({component:y[h],ip:y[h+1],port:y[h+2]});return v},c.parseImageAttributes=function(t){return t.split(" ").map(function(v){return v.substring(1,v.length-1).split(",").reduce(m,{})})},c.parseSimulcastStreamList=function(t){return t.split(";").map(function(v){return v.split(",").map(function(y){var h,n=!1;return y[0]!=="~"?h=e(y):(h=e(y.substring(1,y.length)),n=!0),{scid:h,paused:n}})})}})(In);var rr=En,Ps=/%[sdv%]/g,Ms=function(c){var e=1,d=arguments,w=d.length;return c.replace(Ps,function(C){if(e>=w)return C;var b=d[e];switch(e+=1,C){case"%%":return"%";case"%s":return String(b);case"%d":return Number(b);case"%v":return""}})},ct=function(c,e,d){var w=e.format instanceof Function?e.format(e.push?d:d[e.name]):e.format,C=[c+"="+w];if(e.names)for(var b=0;b<e.names.length;b+=1){var m=e.names[b];e.name?C.push(d[e.name][m]):C.push(d[e.names[b]])}else C.push(d[e.name]);return Ms.apply(null,C)},Os=["v","o","s","i","u","e","p","c","b","t","r","z","a"],$s=["i","c","b","a"],Ns=function(c,e){e=e||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(b){b.payloads==null&&(b.payloads="")});var d=e.outerOrder||Os,w=e.innerOrder||$s,C=[];return d.forEach(function(b){rr[b].forEach(function(m){m.name in c&&c[m.name]!=null?C.push(ct(b,m,c)):m.push in c&&c[m.push]!=null&&c[m.push].forEach(function(t){C.push(ct(b,m,t))})})}),c.media.forEach(function(b){C.push(ct("m",rr.m[0],b)),w.forEach(function(m){rr[m].forEach(function(t){t.name in b&&b[t.name]!=null?C.push(ct(m,t,b)):t.push in b&&b[t.push]!=null&&b[t.push].forEach(function(v){C.push(ct(m,t,v))})})})}),C.join("\r\n")+"\r\n"},ze=In,js=Ns;$e.write=js;$e.parse=ze.parse;$e.parseParams=ze.parseParams;$e.parseFmtpConfig=ze.parseFmtpConfig;$e.parsePayloads=ze.parsePayloads;$e.parseRemoteCandidates=ze.parseRemoteCandidates;$e.parseImageAttributes=ze.parseImageAttributes;$e.parseSimulcastStreamList=ze.parseSimulcastStreamList;var Ds=function(c){const e=new Intl.Collator(c,{sensitivity:"base"});return(d,w)=>e.compare(d,w)==0};let ht=class Tn{constructor(e,d,w,C,b,m,t,v,y){this.foundation=e,this.componentId=d,this.transport=w,this.priority=C,this.address=b,this.port=m,this.type=t,this.relAddr=v,this.relPort=y}equals(e){return e.foundation===this.foundation&&e.componentId===this.componentId&&e.transport===this.transport&&e.priority===this.priority&&e.address===this.address&&e.port===this.port&&e.type===this.type&&e.relAddr===this.relAddr&&e.relPort===this.relPort}clone(){return new Tn(this.foundation,this.componentId,this.transport,this.priority,this.address,this.port,this.type,this.relAddr,this.relPort)}plain(){const e={foundation:this.foundation,componentId:this.componentId,transport:this.transport,priority:this.priority,address:this.address,port:this.port,type:this.type};return this.relAddr&&(e.relAddr=this.relAddr),this.relPort&&(e.relPort=this.relPort),e}getFoundation(){return this.foundation}getComponentId(){return this.componentId}getTransport(){return this.transport}getPriority(){return this.priority}getAddress(){return this.address}getPort(){return this.port}getType(){return this.type}getRelAddr(){return this.relAddr}getRelPort(){return this.relPort}};ht.expand=function(c){return c.constructor.name==="CandidateInfo"?c:(c=c,new ht(c.foundation,c.componentId,c.transport,c.priority,c.address,c.port,c.type,c.relAddr,c.relPort))};ht.clone=function(c){return c.constructor.name==="CandidateInfo"?c.clone():ht.expand(c)};var Ln=ht;let pt=class An{constructor(e,d){this.id=e,this.params=d||[]}clone(){return new An(this.id,this.params)}plain(){return this.params.length?{id:this.id,params:this.params}:{id:this.id}}getId(){return this.id}getParams(){return this.params}};pt.expand=function(c){return c.constructor.name==="RTCPFeedbackInfo"?c:(c=c,new pt(c.id,c.params))};pt.clone=function(c){return c.constructor.name==="RTCPFeedbackInfo"?c.clone():pt.expand(c)};var Sr=pt;const Pn=Sr;let Ue=class Mn{constructor(e,d,w){this.codec=e,this.type=d,this.params={},this.rtcpfbs=new Set,w&&this.addParams(w)}clone(){const e=new Mn(this.codec,this.type,this.params);this.hasRTX()&&e.setRTX(this.getRTX());for(const d of this.rtcpfbs)e.addRTCPFeedback(d.clone());return this.hasChannels()&&e.setChannels(this.getChannels()),e}plain(){const e={codec:this.codec,type:this.type};this.rtx&&(e.rtx=this.rtx),this.channels&&(e.channels=this.channels),Object.keys(this.params).length&&(e.params=this.params);for(const d of this.rtcpfbs)e.rtcpfbs||(e.rtcpfbs=[]),e.rtcpfbs.push(d.plain());return e}setRTX(e){this.rtx=e}getType(){return this.type}setType(e){this.type=e}getCodec(){return this.codec}getParams(){return this.params}addParams(e){for(const d in e)this.params[d]=e[d]}addParam(e,d){this.params[e]=d}hasParam(e){return Object.hasOwnProperty.call(this.params,e)}getParam(e,d=void 0){if(this.hasParam(e))return this.params[e];if(d===void 0)throw new Error("param ".concat(e," not found and no default value provided"));return""+d}hasRTX(){return this.rtx}getRTX(){return this.rtx}hasChannels(){return this.channels}getChannels(){return this.channels}setChannels(e){this.channels=e}addRTCPFeedback(e){this.rtcpfbs.add(e)}getRTCPFeedbacks(){return this.rtcpfbs}};Ue.expand=function(c){if(c.constructor.name==="CodecInfo")return c;c=c;const e=new Ue(c.codec,c.type,c.params);c.rtx&&e.setRTX(c.rtx),c.channels&&e.setChannels(c.channels);for(const d of c.rtcpfbs||[]){const w=Pn.expand(d);e.addRTCPFeedback(w)}return e};Ue.clone=function(c){return c.constructor.name==="CodecInfo"?c.clone():Ue.expand(c)};Ue.MapFromNames=function(c,e,d){var w;const C=new Map;let b=96;for(const m of c){let t;const v=m.split(";"),y=v.shift().toLowerCase().trim();y==="pcmu"?t=0:y==="pcma"?t=8:t=++b;const h=new Ue(y,t);y==="opus"?h.setChannels(2):y==="multiopus"&&h.setChannels(6),e&&y!=="ulpfec"&&y!=="flexfec-03"&&y!=="red"&&h.setRTX(++b);for(const n of d||[])h.addRTCPFeedback(new Pn(n.id,n.params));for(const n of v){let i=n.split("=");h.addParam(i[0].trim(),(w=i[1])===null||w===void 0?void 0:w.trim())}C.set(t,h)}return C};var Jt=Ue;function cr(){var c=this;if(!(this instanceof cr))return new(Function.prototype.bind.apply(cr,[null].concat(Array.prototype.slice.call(arguments))));Array.from(arguments).forEach(function(e){c[e]=Symbol.for("MEDOOZE_SEMANTIC_SDP_"+e)})}var _r=cr;const Fs=_r,de=Fs("ACTIVE","PASSIVE","ACTPASS","INACTIVE");de.byValue=function(c){switch(c){case de.ACTIVE:case de.PASSIVE:case de.ACTPASS:case de.INACTIVE:return c}return de[c.toUpperCase()]};de.toString=function(c){switch(c){case de.ACTIVE:return"active";case de.PASSIVE:return"passive";case de.ACTPASS:return"actpass";case de.INACTIVE:return"inactive"}};de.reverse=function(c,e){switch(c){case de.ACTIVE:return de.PASSIVE;case de.PASSIVE:return de.ACTIVE;case de.ACTPASS:return e?de.ACTIVE:de.PASSIVE;case de.INACTIVE:return de.INACTIVE}};var Cr=de;const lr=Cr;let mt=class On{constructor(e,d,w){this.setup=e,this.hash=d,this.fingerprint=w}clone(){return new On(this.setup,this.hash,this.fingerprint)}plain(){return{setup:lr.toString(this.setup),hash:this.hash,fingerprint:this.fingerprint}}getFingerprint(){return this.fingerprint}getHash(){return this.hash}getSetup(){return this.setup}setSetup(e){this.setup=e}};mt.expand=function(c){return c.constructor.name==="DTLSInfo"?c:(c=c,new mt(c.setup?lr.byValue(c.setup):lr.ACTPASS,c.hash,c.fingerprint))};mt.clone=function(c){return c.constructor.name==="DTLSInfo"?c.clone():mt.expand(c)};var $n=mt;let gt=class Nn{constructor(e,d,w,C){this.tag=e,this.suite=d,this.keyParams=w,this.sessionParams=C}clone(){return new Nn(this.tag,this.suite,this.keyParams,this.sessionParams)}plain(){return{tag:this.tag,suite:this.suite,keyParams:this.keyParams,sessionParams:this.sessionParams}}getSessionParams(){return this.sessionParams}getKeyParams(){return this.keyParams}getSuite(){return this.suite}getTag(){return this.tag}};gt.expand=function(c){return c.constructor.name==="CryptoInfo"?c:(c=c,new gt(c.tag,c.suite,c.keyParams,c.sessionParams))};gt.clone=function(c){return c.constructor.name==="CryptoInfo"?c.clone():gt.expand(c)};var jn=gt,ur={exports:{}},dr={exports:{}},Dn={},Qt={};Qt.byteLength=Ws;Qt.toByteArray=Gs;Qt.fromByteArray=zs;var Te=[],_e=[],Vs=typeof Uint8Array<"u"?Uint8Array:Array,nr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Ke=0,Zs=nr.length;Ke<Zs;++Ke)Te[Ke]=nr[Ke],_e[nr.charCodeAt(Ke)]=Ke;_e[45]=62;_e[95]=63;function Fn(c){var e=c.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var d=c.indexOf("=");d===-1&&(d=e);var w=d===e?0:4-d%4;return[d,w]}function Ws(c){var e=Fn(c),d=e[0],w=e[1];return(d+w)*3/4-w}function Us(c,e,d){return(e+d)*3/4-d}function Gs(c){var e,d=Fn(c),w=d[0],C=d[1],b=new Vs(Us(c,w,C)),m=0,t=C>0?w-4:w,v;for(v=0;v<t;v+=4)e=_e[c.charCodeAt(v)]<<18|_e[c.charCodeAt(v+1)]<<12|_e[c.charCodeAt(v+2)]<<6|_e[c.charCodeAt(v+3)],b[m++]=e>>16&255,b[m++]=e>>8&255,b[m++]=e&255;return C===2&&(e=_e[c.charCodeAt(v)]<<2|_e[c.charCodeAt(v+1)]>>4,b[m++]=e&255),C===1&&(e=_e[c.charCodeAt(v)]<<10|_e[c.charCodeAt(v+1)]<<4|_e[c.charCodeAt(v+2)]>>2,b[m++]=e>>8&255,b[m++]=e&255),b}function Bs(c){return Te[c>>18&63]+Te[c>>12&63]+Te[c>>6&63]+Te[c&63]}function Xs(c,e,d){for(var w,C=[],b=e;b<d;b+=3)w=(c[b]<<16&16711680)+(c[b+1]<<8&65280)+(c[b+2]&255),C.push(Bs(w));return C.join("")}function zs(c){for(var e,d=c.length,w=d%3,C=[],b=16383,m=0,t=d-w;m<t;m+=b)C.push(Xs(c,m,m+b>t?t:m+b));return w===1?(e=c[d-1],C.push(Te[e>>2]+Te[e<<4&63]+"==")):w===2&&(e=(c[d-2]<<8)+c[d-1],C.push(Te[e>>10]+Te[e>>4&63]+Te[e<<2&63]+"=")),C.join("")}var Rr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Rr.read=function(c,e,d,w,C){var b,m,t=C*8-w-1,v=(1<<t)-1,y=v>>1,h=-7,n=d?C-1:0,i=d?-1:1,o=c[e+n];for(n+=i,b=o&(1<<-h)-1,o>>=-h,h+=t;h>0;b=b*256+c[e+n],n+=i,h-=8);for(m=b&(1<<-h)-1,b>>=-h,h+=w;h>0;m=m*256+c[e+n],n+=i,h-=8);if(b===0)b=1-y;else{if(b===v)return m?NaN:(o?-1:1)*(1/0);m=m+Math.pow(2,w),b=b-y}return(o?-1:1)*m*Math.pow(2,b-w)};Rr.write=function(c,e,d,w,C,b){var m,t,v,y=b*8-C-1,h=(1<<y)-1,n=h>>1,i=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,o=w?0:b-1,s=w?1:-1,r=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(t=isNaN(e)?1:0,m=h):(m=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-m))<1&&(m--,v*=2),m+n>=1?e+=i/v:e+=i*Math.pow(2,1-n),e*v>=2&&(m++,v/=2),m+n>=h?(t=0,m=h):m+n>=1?(t=(e*v-1)*Math.pow(2,C),m=m+n):(t=e*Math.pow(2,n-1)*Math.pow(2,C),m=0));C>=8;c[d+o]=t&255,o+=s,t/=256,C-=8);for(m=m<<C|t,y+=C;y>0;c[d+o]=m&255,o+=s,m/=256,y-=8);c[d+o-s]|=r*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(c){var e=Qt,d=Rr,w=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;c.Buffer=t,c.SlowBuffer=u,c.INSPECT_MAX_BYTES=50;var C=2147483647;c.kMaxLength=C,t.TYPED_ARRAY_SUPPORT=b(),!t.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function b(){try{var T=new Uint8Array(1),x={foo:function(){return 42}};return Object.setPrototypeOf(x,Uint8Array.prototype),Object.setPrototypeOf(T,x),T.foo()===42}catch(S){return!1}}Object.defineProperty(t.prototype,"parent",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.buffer}}),Object.defineProperty(t.prototype,"offset",{enumerable:!0,get:function(){if(t.isBuffer(this))return this.byteOffset}});function m(T){if(T>C)throw new RangeError('The value "'+T+'" is invalid for option "size"');var x=new Uint8Array(T);return Object.setPrototypeOf(x,t.prototype),x}function t(T,x,S){if(typeof T=="number"){if(typeof x=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return n(T)}return v(T,x,S)}t.poolSize=8192;function v(T,x,S){if(typeof T=="string")return i(T,x);if(ArrayBuffer.isView(T))return s(T);if(T==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T);if(we(T,ArrayBuffer)||T&&we(T.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(we(T,SharedArrayBuffer)||T&&we(T.buffer,SharedArrayBuffer)))return r(T,x,S);if(typeof T=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var L=T.valueOf&&T.valueOf();if(L!=null&&L!==T)return t.from(L,x,S);var P=l(T);if(P)return P;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof T[Symbol.toPrimitive]=="function")return t.from(T[Symbol.toPrimitive]("string"),x,S);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof T)}t.from=function(T,x,S){return v(T,x,S)},Object.setPrototypeOf(t.prototype,Uint8Array.prototype),Object.setPrototypeOf(t,Uint8Array);function y(T){if(typeof T!="number")throw new TypeError('"size" argument must be of type number');if(T<0)throw new RangeError('The value "'+T+'" is invalid for option "size"')}function h(T,x,S){return y(T),T<=0?m(T):x!==void 0?typeof S=="string"?m(T).fill(x,S):m(T).fill(x):m(T)}t.alloc=function(T,x,S){return h(T,x,S)};function n(T){return y(T),m(T<0?0:a(T)|0)}t.allocUnsafe=function(T){return n(T)},t.allocUnsafeSlow=function(T){return n(T)};function i(T,x){if((typeof x!="string"||x==="")&&(x="utf8"),!t.isEncoding(x))throw new TypeError("Unknown encoding: "+x);var S=f(T,x)|0,L=m(S),P=L.write(T,x);return P!==S&&(L=L.slice(0,P)),L}function o(T){for(var x=T.length<0?0:a(T.length)|0,S=m(x),L=0;L<x;L+=1)S[L]=T[L]&255;return S}function s(T){if(we(T,Uint8Array)){var x=new Uint8Array(T);return r(x.buffer,x.byteOffset,x.byteLength)}return o(T)}function r(T,x,S){if(x<0||T.byteLength<x)throw new RangeError('"offset" is outside of buffer bounds');if(T.byteLength<x+(S||0))throw new RangeError('"length" is outside of buffer bounds');var L;return x===void 0&&S===void 0?L=new Uint8Array(T):S===void 0?L=new Uint8Array(T,x):L=new Uint8Array(T,x,S),Object.setPrototypeOf(L,t.prototype),L}function l(T){if(t.isBuffer(T)){var x=a(T.length)|0,S=m(x);return S.length===0||T.copy(S,0,0,x),S}if(T.length!==void 0)return typeof T.length!="number"||Me(T.length)?m(0):o(T);if(T.type==="Buffer"&&Array.isArray(T.data))return o(T.data)}function a(T){if(T>=C)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+C.toString(16)+" bytes");return T|0}function u(T){return+T!=T&&(T=0),t.alloc(+T)}t.isBuffer=function(x){return x!=null&&x._isBuffer===!0&&x!==t.prototype},t.compare=function(x,S){if(we(x,Uint8Array)&&(x=t.from(x,x.offset,x.byteLength)),we(S,Uint8Array)&&(S=t.from(S,S.offset,S.byteLength)),!t.isBuffer(x)||!t.isBuffer(S))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(x===S)return 0;for(var L=x.length,P=S.length,j=0,D=Math.min(L,P);j<D;++j)if(x[j]!==S[j]){L=x[j],P=S[j];break}return L<P?-1:P<L?1:0},t.isEncoding=function(x){switch(String(x).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(x,S){if(!Array.isArray(x))throw new TypeError('"list" argument must be an Array of Buffers');if(x.length===0)return t.alloc(0);var L;if(S===void 0)for(S=0,L=0;L<x.length;++L)S+=x[L].length;var P=t.allocUnsafe(S),j=0;for(L=0;L<x.length;++L){var D=x[L];if(we(D,Uint8Array))j+D.length>P.length?t.from(D).copy(P,j):Uint8Array.prototype.set.call(P,D,j);else if(t.isBuffer(D))D.copy(P,j);else throw new TypeError('"list" argument must be an Array of Buffers');j+=D.length}return P};function f(T,x){if(t.isBuffer(T))return T.length;if(ArrayBuffer.isView(T)||we(T,ArrayBuffer))return T.byteLength;if(typeof T!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof T);var S=T.length,L=arguments.length>2&&arguments[2]===!0;if(!L&&S===0)return 0;for(var P=!1;;)switch(x){case"ascii":case"latin1":case"binary":return S;case"utf8":case"utf-8":return Ae(T).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S*2;case"hex":return S>>>1;case"base64":return Lt(T).length;default:if(P)return L?-1:Ae(T).length;x=(""+x).toLowerCase(),P=!0}}t.byteLength=f;function p(T,x,S){var L=!1;if((x===void 0||x<0)&&(x=0),x>this.length||((S===void 0||S>this.length)&&(S=this.length),S<=0)||(S>>>=0,x>>>=0,S<=x))return"";for(T||(T="utf8");;)switch(T){case"hex":return X(this,x,S);case"utf8":case"utf-8":return V(this,x,S);case"ascii":return M(this,x,S);case"latin1":case"binary":return F(this,x,S);case"base64":return N(this,x,S);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,x,S);default:if(L)throw new TypeError("Unknown encoding: "+T);T=(T+"").toLowerCase(),L=!0}}t.prototype._isBuffer=!0;function _(T,x,S){var L=T[x];T[x]=T[S],T[S]=L}t.prototype.swap16=function(){var x=this.length;if(x%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var S=0;S<x;S+=2)_(this,S,S+1);return this},t.prototype.swap32=function(){var x=this.length;if(x%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var S=0;S<x;S+=4)_(this,S,S+3),_(this,S+1,S+2);return this},t.prototype.swap64=function(){var x=this.length;if(x%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var S=0;S<x;S+=8)_(this,S,S+7),_(this,S+1,S+6),_(this,S+2,S+5),_(this,S+3,S+4);return this},t.prototype.toString=function(){var x=this.length;return x===0?"":arguments.length===0?V(this,0,x):p.apply(this,arguments)},t.prototype.toLocaleString=t.prototype.toString,t.prototype.equals=function(x){if(!t.isBuffer(x))throw new TypeError("Argument must be a Buffer");return this===x?!0:t.compare(this,x)===0},t.prototype.inspect=function(){var x="",S=c.INSPECT_MAX_BYTES;return x=this.toString("hex",0,S).replace(/(.{2})/g,"$1 ").trim(),this.length>S&&(x+=" ... "),"<Buffer "+x+">"},w&&(t.prototype[w]=t.prototype.inspect),t.prototype.compare=function(x,S,L,P,j){if(we(x,Uint8Array)&&(x=t.from(x,x.offset,x.byteLength)),!t.isBuffer(x))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof x);if(S===void 0&&(S=0),L===void 0&&(L=x?x.length:0),P===void 0&&(P=0),j===void 0&&(j=this.length),S<0||L>x.length||P<0||j>this.length)throw new RangeError("out of range index");if(P>=j&&S>=L)return 0;if(P>=j)return-1;if(S>=L)return 1;if(S>>>=0,L>>>=0,P>>>=0,j>>>=0,this===x)return 0;for(var D=j-P,Q=L-S,te=Math.min(D,Q),z=this.slice(P,j),Y=x.slice(S,L),G=0;G<te;++G)if(z[G]!==Y[G]){D=z[G],Q=Y[G];break}return D<Q?-1:Q<D?1:0};function k(T,x,S,L,P){if(T.length===0)return-1;if(typeof S=="string"?(L=S,S=0):S>2147483647?S=2147483647:S<-2147483648&&(S=-2147483648),S=+S,Me(S)&&(S=P?0:T.length-1),S<0&&(S=T.length+S),S>=T.length){if(P)return-1;S=T.length-1}else if(S<0)if(P)S=0;else return-1;if(typeof x=="string"&&(x=t.from(x,L)),t.isBuffer(x))return x.length===0?-1:E(T,x,S,L,P);if(typeof x=="number")return x=x&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(T,x,S):Uint8Array.prototype.lastIndexOf.call(T,x,S):E(T,[x],S,L,P);throw new TypeError("val must be string, number or Buffer")}function E(T,x,S,L,P){var j=1,D=T.length,Q=x.length;if(L!==void 0&&(L=String(L).toLowerCase(),L==="ucs2"||L==="ucs-2"||L==="utf16le"||L==="utf-16le")){if(T.length<2||x.length<2)return-1;j=2,D/=2,Q/=2,S/=2}function te(Ce,xe){return j===1?Ce[xe]:Ce.readUInt16BE(xe*j)}var z;if(P){var Y=-1;for(z=S;z<D;z++)if(te(T,z)===te(x,Y===-1?0:z-Y)){if(Y===-1&&(Y=z),z-Y+1===Q)return Y*j}else Y!==-1&&(z-=z-Y),Y=-1}else for(S+Q>D&&(S=D-Q),z=S;z>=0;z--){for(var G=!0,re=0;re<Q;re++)if(te(T,z+re)!==te(x,re)){G=!1;break}if(G)return z}return-1}t.prototype.includes=function(x,S,L){return this.indexOf(x,S,L)!==-1},t.prototype.indexOf=function(x,S,L){return k(this,x,S,L,!0)},t.prototype.lastIndexOf=function(x,S,L){return k(this,x,S,L,!1)};function g(T,x,S,L){S=Number(S)||0;var P=T.length-S;L?(L=Number(L),L>P&&(L=P)):L=P;var j=x.length;L>j/2&&(L=j/2);for(var D=0;D<L;++D){var Q=parseInt(x.substr(D*2,2),16);if(Me(Q))return D;T[S+D]=Q}return D}function R(T,x,S,L){return Pe(Ae(x,T.length-S),T,S,L)}function I(T,x,S,L){return Pe(Et(x),T,S,L)}function A(T,x,S,L){return Pe(Lt(x),T,S,L)}function O(T,x,S,L){return Pe(Tt(x,T.length-S),T,S,L)}t.prototype.write=function(x,S,L,P){if(S===void 0)P="utf8",L=this.length,S=0;else if(L===void 0&&typeof S=="string")P=S,L=this.length,S=0;else if(isFinite(S))S=S>>>0,isFinite(L)?(L=L>>>0,P===void 0&&(P="utf8")):(P=L,L=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var j=this.length-S;if((L===void 0||L>j)&&(L=j),x.length>0&&(L<0||S<0)||S>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");for(var D=!1;;)switch(P){case"hex":return g(this,x,S,L);case"utf8":case"utf-8":return R(this,x,S,L);case"ascii":case"latin1":case"binary":return I(this,x,S,L);case"base64":return A(this,x,S,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,x,S,L);default:if(D)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),D=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(T,x,S){return x===0&&S===T.length?e.fromByteArray(T):e.fromByteArray(T.slice(x,S))}function V(T,x,S){S=Math.min(T.length,S);for(var L=[],P=x;P<S;){var j=T[P],D=null,Q=j>239?4:j>223?3:j>191?2:1;if(P+Q<=S){var te,z,Y,G;switch(Q){case 1:j<128&&(D=j);break;case 2:te=T[P+1],(te&192)===128&&(G=(j&31)<<6|te&63,G>127&&(D=G));break;case 3:te=T[P+1],z=T[P+2],(te&192)===128&&(z&192)===128&&(G=(j&15)<<12|(te&63)<<6|z&63,G>2047&&(G<55296||G>57343)&&(D=G));break;case 4:te=T[P+1],z=T[P+2],Y=T[P+3],(te&192)===128&&(z&192)===128&&(Y&192)===128&&(G=(j&15)<<18|(te&63)<<12|(z&63)<<6|Y&63,G>65535&&G<1114112&&(D=G))}}D===null?(D=65533,Q=1):D>65535&&(D-=65536,L.push(D>>>10&1023|55296),D=56320|D&1023),L.push(D),P+=Q}return Z(L)}var B=4096;function Z(T){var x=T.length;if(x<=B)return String.fromCharCode.apply(String,T);for(var S="",L=0;L<x;)S+=String.fromCharCode.apply(String,T.slice(L,L+=B));return S}function M(T,x,S){var L="";S=Math.min(T.length,S);for(var P=x;P<S;++P)L+=String.fromCharCode(T[P]&127);return L}function F(T,x,S){var L="";S=Math.min(T.length,S);for(var P=x;P<S;++P)L+=String.fromCharCode(T[P]);return L}function X(T,x,S){var L=T.length;(!x||x<0)&&(x=0),(!S||S<0||S>L)&&(S=L);for(var P="",j=x;j<S;++j)P+=er[T[j]];return P}function U(T,x,S){for(var L=T.slice(x,S),P="",j=0;j<L.length-1;j+=2)P+=String.fromCharCode(L[j]+L[j+1]*256);return P}t.prototype.slice=function(x,S){var L=this.length;x=~~x,S=S===void 0?L:~~S,x<0?(x+=L,x<0&&(x=0)):x>L&&(x=L),S<0?(S+=L,S<0&&(S=0)):S>L&&(S=L),S<x&&(S=x);var P=this.subarray(x,S);return Object.setPrototypeOf(P,t.prototype),P};function W(T,x,S){if(T%1!==0||T<0)throw new RangeError("offset is not uint");if(T+x>S)throw new RangeError("Trying to access beyond buffer length")}t.prototype.readUintLE=t.prototype.readUIntLE=function(x,S,L){x=x>>>0,S=S>>>0,L||W(x,S,this.length);for(var P=this[x],j=1,D=0;++D<S&&(j*=256);)P+=this[x+D]*j;return P},t.prototype.readUintBE=t.prototype.readUIntBE=function(x,S,L){x=x>>>0,S=S>>>0,L||W(x,S,this.length);for(var P=this[x+--S],j=1;S>0&&(j*=256);)P+=this[x+--S]*j;return P},t.prototype.readUint8=t.prototype.readUInt8=function(x,S){return x=x>>>0,S||W(x,1,this.length),this[x]},t.prototype.readUint16LE=t.prototype.readUInt16LE=function(x,S){return x=x>>>0,S||W(x,2,this.length),this[x]|this[x+1]<<8},t.prototype.readUint16BE=t.prototype.readUInt16BE=function(x,S){return x=x>>>0,S||W(x,2,this.length),this[x]<<8|this[x+1]},t.prototype.readUint32LE=t.prototype.readUInt32LE=function(x,S){return x=x>>>0,S||W(x,4,this.length),(this[x]|this[x+1]<<8|this[x+2]<<16)+this[x+3]*16777216},t.prototype.readUint32BE=t.prototype.readUInt32BE=function(x,S){return x=x>>>0,S||W(x,4,this.length),this[x]*16777216+(this[x+1]<<16|this[x+2]<<8|this[x+3])},t.prototype.readIntLE=function(x,S,L){x=x>>>0,S=S>>>0,L||W(x,S,this.length);for(var P=this[x],j=1,D=0;++D<S&&(j*=256);)P+=this[x+D]*j;return j*=128,P>=j&&(P-=Math.pow(2,8*S)),P},t.prototype.readIntBE=function(x,S,L){x=x>>>0,S=S>>>0,L||W(x,S,this.length);for(var P=S,j=1,D=this[x+--P];P>0&&(j*=256);)D+=this[x+--P]*j;return j*=128,D>=j&&(D-=Math.pow(2,8*S)),D},t.prototype.readInt8=function(x,S){return x=x>>>0,S||W(x,1,this.length),this[x]&128?(255-this[x]+1)*-1:this[x]},t.prototype.readInt16LE=function(x,S){x=x>>>0,S||W(x,2,this.length);var L=this[x]|this[x+1]<<8;return L&32768?L|4294901760:L},t.prototype.readInt16BE=function(x,S){x=x>>>0,S||W(x,2,this.length);var L=this[x+1]|this[x]<<8;return L&32768?L|4294901760:L},t.prototype.readInt32LE=function(x,S){return x=x>>>0,S||W(x,4,this.length),this[x]|this[x+1]<<8|this[x+2]<<16|this[x+3]<<24},t.prototype.readInt32BE=function(x,S){return x=x>>>0,S||W(x,4,this.length),this[x]<<24|this[x+1]<<16|this[x+2]<<8|this[x+3]},t.prototype.readFloatLE=function(x,S){return x=x>>>0,S||W(x,4,this.length),d.read(this,x,!0,23,4)},t.prototype.readFloatBE=function(x,S){return x=x>>>0,S||W(x,4,this.length),d.read(this,x,!1,23,4)},t.prototype.readDoubleLE=function(x,S){return x=x>>>0,S||W(x,8,this.length),d.read(this,x,!0,52,8)},t.prototype.readDoubleBE=function(x,S){return x=x>>>0,S||W(x,8,this.length),d.read(this,x,!1,52,8)};function K(T,x,S,L,P,j){if(!t.isBuffer(T))throw new TypeError('"buffer" argument must be a Buffer instance');if(x>P||x<j)throw new RangeError('"value" argument is out of bounds');if(S+L>T.length)throw new RangeError("Index out of range")}t.prototype.writeUintLE=t.prototype.writeUIntLE=function(x,S,L,P){if(x=+x,S=S>>>0,L=L>>>0,!P){var j=Math.pow(2,8*L)-1;K(this,x,S,L,j,0)}var D=1,Q=0;for(this[S]=x&255;++Q<L&&(D*=256);)this[S+Q]=x/D&255;return S+L},t.prototype.writeUintBE=t.prototype.writeUIntBE=function(x,S,L,P){if(x=+x,S=S>>>0,L=L>>>0,!P){var j=Math.pow(2,8*L)-1;K(this,x,S,L,j,0)}var D=L-1,Q=1;for(this[S+D]=x&255;--D>=0&&(Q*=256);)this[S+D]=x/Q&255;return S+L},t.prototype.writeUint8=t.prototype.writeUInt8=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,1,255,0),this[S]=x&255,S+1},t.prototype.writeUint16LE=t.prototype.writeUInt16LE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,2,65535,0),this[S]=x&255,this[S+1]=x>>>8,S+2},t.prototype.writeUint16BE=t.prototype.writeUInt16BE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,2,65535,0),this[S]=x>>>8,this[S+1]=x&255,S+2},t.prototype.writeUint32LE=t.prototype.writeUInt32LE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,4,4294967295,0),this[S+3]=x>>>24,this[S+2]=x>>>16,this[S+1]=x>>>8,this[S]=x&255,S+4},t.prototype.writeUint32BE=t.prototype.writeUInt32BE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,4,4294967295,0),this[S]=x>>>24,this[S+1]=x>>>16,this[S+2]=x>>>8,this[S+3]=x&255,S+4},t.prototype.writeIntLE=function(x,S,L,P){if(x=+x,S=S>>>0,!P){var j=Math.pow(2,8*L-1);K(this,x,S,L,j-1,-j)}var D=0,Q=1,te=0;for(this[S]=x&255;++D<L&&(Q*=256);)x<0&&te===0&&this[S+D-1]!==0&&(te=1),this[S+D]=(x/Q>>0)-te&255;return S+L},t.prototype.writeIntBE=function(x,S,L,P){if(x=+x,S=S>>>0,!P){var j=Math.pow(2,8*L-1);K(this,x,S,L,j-1,-j)}var D=L-1,Q=1,te=0;for(this[S+D]=x&255;--D>=0&&(Q*=256);)x<0&&te===0&&this[S+D+1]!==0&&(te=1),this[S+D]=(x/Q>>0)-te&255;return S+L},t.prototype.writeInt8=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,1,127,-128),x<0&&(x=255+x+1),this[S]=x&255,S+1},t.prototype.writeInt16LE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,2,32767,-32768),this[S]=x&255,this[S+1]=x>>>8,S+2},t.prototype.writeInt16BE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,2,32767,-32768),this[S]=x>>>8,this[S+1]=x&255,S+2},t.prototype.writeInt32LE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,4,2147483647,-2147483648),this[S]=x&255,this[S+1]=x>>>8,this[S+2]=x>>>16,this[S+3]=x>>>24,S+4},t.prototype.writeInt32BE=function(x,S,L){return x=+x,S=S>>>0,L||K(this,x,S,4,2147483647,-2147483648),x<0&&(x=4294967295+x+1),this[S]=x>>>24,this[S+1]=x>>>16,this[S+2]=x>>>8,this[S+3]=x&255,S+4};function ee(T,x,S,L,P,j){if(S+L>T.length)throw new RangeError("Index out of range");if(S<0)throw new RangeError("Index out of range")}function se(T,x,S,L,P){return x=+x,S=S>>>0,P||ee(T,x,S,4),d.write(T,x,S,L,23,4),S+4}t.prototype.writeFloatLE=function(x,S,L){return se(this,x,S,!0,L)},t.prototype.writeFloatBE=function(x,S,L){return se(this,x,S,!1,L)};function ie(T,x,S,L,P){return x=+x,S=S>>>0,P||ee(T,x,S,8),d.write(T,x,S,L,52,8),S+8}t.prototype.writeDoubleLE=function(x,S,L){return ie(this,x,S,!0,L)},t.prototype.writeDoubleBE=function(x,S,L){return ie(this,x,S,!1,L)},t.prototype.copy=function(x,S,L,P){if(!t.isBuffer(x))throw new TypeError("argument should be a Buffer");if(L||(L=0),!P&&P!==0&&(P=this.length),S>=x.length&&(S=x.length),S||(S=0),P>0&&P<L&&(P=L),P===L||x.length===0||this.length===0)return 0;if(S<0)throw new RangeError("targetStart out of bounds");if(L<0||L>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),x.length-S<P-L&&(P=x.length-S+L);var j=P-L;return this===x&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(S,L,P):Uint8Array.prototype.set.call(x,this.subarray(L,P),S),j},t.prototype.fill=function(x,S,L,P){if(typeof x=="string"){if(typeof S=="string"?(P=S,S=0,L=this.length):typeof L=="string"&&(P=L,L=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!t.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(x.length===1){var j=x.charCodeAt(0);(P==="utf8"&&j<128||P==="latin1")&&(x=j)}}else typeof x=="number"?x=x&255:typeof x=="boolean"&&(x=Number(x));if(S<0||this.length<S||this.length<L)throw new RangeError("Out of range index");if(L<=S)return this;S=S>>>0,L=L===void 0?this.length:L>>>0,x||(x=0);var D;if(typeof x=="number")for(D=S;D<L;++D)this[D]=x;else{var Q=t.isBuffer(x)?x:t.from(x,P),te=Q.length;if(te===0)throw new TypeError('The value "'+x+'" is invalid for argument "value"');for(D=0;D<L-S;++D)this[D+S]=Q[D%te]}return this};var le=/[^+/0-9A-Za-z-_]/g;function ge(T){if(T=T.split("=")[0],T=T.trim().replace(le,""),T.length<2)return"";for(;T.length%4!==0;)T=T+"=";return T}function Ae(T,x){x=x||1/0;for(var S,L=T.length,P=null,j=[],D=0;D<L;++D){if(S=T.charCodeAt(D),S>55295&&S<57344){if(!P){if(S>56319){(x-=3)>-1&&j.push(239,191,189);continue}else if(D+1===L){(x-=3)>-1&&j.push(239,191,189);continue}P=S;continue}if(S<56320){(x-=3)>-1&&j.push(239,191,189),P=S;continue}S=(P-55296<<10|S-56320)+65536}else P&&(x-=3)>-1&&j.push(239,191,189);if(P=null,S<128){if((x-=1)<0)break;j.push(S)}else if(S<2048){if((x-=2)<0)break;j.push(S>>6|192,S&63|128)}else if(S<65536){if((x-=3)<0)break;j.push(S>>12|224,S>>6&63|128,S&63|128)}else if(S<1114112){if((x-=4)<0)break;j.push(S>>18|240,S>>12&63|128,S>>6&63|128,S&63|128)}else throw new Error("Invalid code point")}return j}function Et(T){for(var x=[],S=0;S<T.length;++S)x.push(T.charCodeAt(S)&255);return x}function Tt(T,x){for(var S,L,P,j=[],D=0;D<T.length&&!((x-=2)<0);++D)S=T.charCodeAt(D),L=S>>8,P=S%256,j.push(P),j.push(L);return j}function Lt(T){return e.toByteArray(ge(T))}function Pe(T,x,S,L){for(var P=0;P<L&&!(P+S>=x.length||P>=T.length);++P)x[P+S]=T[P];return P}function we(T,x){return T instanceof x||T!=null&&T.constructor!=null&&T.constructor.name!=null&&T.constructor.name===x.name}function Me(T){return T!==T}var er=function(){for(var T="0123456789abcdef",x=new Array(256),S=0;S<16;++S)for(var L=S*16,P=0;P<16;++P)x[L+P]=T[S]+T[P];return x}()})(Dn);/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(c,e){var d=Dn,w=d.Buffer;function C(m,t){for(var v in m)t[v]=m[v]}w.from&&w.alloc&&w.allocUnsafe&&w.allocUnsafeSlow?c.exports=d:(C(d,e),e.Buffer=b);function b(m,t,v){return w(m,t,v)}b.prototype=Object.create(w.prototype),C(w,b),b.from=function(m,t,v){if(typeof m=="number")throw new TypeError("Argument must not be a number");return w(m,t,v)},b.alloc=function(m,t,v){if(typeof m!="number")throw new TypeError("Argument must be a number");var y=w(m);return t!==void 0?typeof v=="string"?y.fill(t,v):y.fill(t):y.fill(0),y},b.allocUnsafe=function(m){if(typeof m!="number")throw new TypeError("Argument must be a number");return w(m)},b.allocUnsafeSlow=function(m){if(typeof m!="number")throw new TypeError("Argument must be a number");return d.SlowBuffer(m)}})(dr,dr.exports);var Ks=dr.exports,sr=65536,Ys=4294967295;function Hs(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var Js=Ks.Buffer,Xt=Bt.crypto||Bt.msCrypto;Xt&&Xt.getRandomValues?ur.exports=Qs:ur.exports=Hs;function Qs(c,e){if(c>Ys)throw new RangeError("requested too many random bytes");var d=Js.allocUnsafe(c);if(c>0)if(c>sr)for(var w=0;w<c;w+=sr)Xt.getRandomValues(d.slice(w,w+sr));else Xt.getRandomValues(d);return typeof e=="function"?process.nextTick(function(){e(null,d)}):d}var qs=ur.exports;const Xr=qs;let Ge=class Vn{constructor(e,d){this.ufrag=e,this.pwd=d,this.lite=!1,this.endOfCandidates=!1}clone(){const e=new Vn(this.ufrag,this.pwd);return e.setLite(this.lite),e.setEndOfCandidates(this.endOfCandidates),e}plain(){const e={ufrag:this.ufrag,pwd:this.pwd};return this.lite&&(e.lite=this.lite),this.endOfCandidates&&(e.endOfCandidates=this.endOfCandidates),e}getUfrag(){return this.ufrag}getPwd(){return this.pwd}isLite(){return this.lite}setLite(e){this.lite=e}isEndOfCandidates(){return this.endOfCandidates}setEndOfCandidates(e){this.endOfCandidates=e}};Ge.generate=function(c){const e=new Ge,d=Xr(8),w=Xr(24);return e.ufrag=d.toString("hex"),e.pwd=w.toString("hex"),e.lite=c,e};Ge.expand=function(c){if(c.constructor.name==="ICEInfo")return c;c=c;const e=new Ge(c.ufrag,c.pwd);return e.setLite(c.lite),e.setEndOfCandidates(c.endOfCandidates),e};Ge.clone=function(c){return c.constructor.name==="ICEInfo"?c.clone():Ge.expand(c)};var Zn=Ge;const ei=_r,Ie=ei("SEND","RECV");Ie.byValue=function(c){return Ie[c.toUpperCase()]};Ie.toString=function(c){switch(c){case Ie.SEND:return"send";case Ie.RECV:return"recv"}};Ie.reverse=function(c){switch(c){case Ie.SEND:return Ie.RECV;case Ie.RECV:return Ie.SEND}};var qt=Ie;const Wn=qt;let yt=class Un{constructor(e,d){this.id=e,this.direction=d,this.formats=[],this.params=new Map}clone(){var e=new Un(this.id,this.direction);return e.setFormats(this.formats),e.setParams(this.params),e}plain(){var e={id:this.id,direction:Wn.toString(this.direction)};this.formats&&(e.formats=this.formats);for(var[d,w]of this.params.entries())e.params||(e.params={}),e.params[d]=w;return e}getId(){return this.id}getDirection(){return this.direction}setDirection(e){this.direction=e}getFormats(){return this.formats}setFormats(e){this.formats=[];for(let d=0;d<e.length;++d)this.formats.push(parseInt(e[d]))}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,d){this.params.set(e,d)}};yt.expand=function(c){if(c.constructor.name==="RIDInfo")return c;c=c;const e=new yt(c.id,Wn.byValue(c.direction));for(const[d,w]of Object.entries(c.params||{}))e.addParam(d,w);return c.formats&&e.setFormats(c.formats),e};yt.clone=function(c){return c.constructor.name==="RIDInfo"?c.clone():yt.expand(c)};var Ir=yt;let bt=class Gn{constructor(e,d){this.paused=d,this.id=e}clone(){return new Gn(this.id,this.paused)}plain(){return{id:this.id,paused:this.paused}}isPaused(){return this.paused}getId(){return this.id}};bt.expand=function(c){return c.constructor.name==="SimulcastStreamInfo"?c:(c=c,new bt(c.id,c.paused))};bt.clone=function(c){return c.constructor.name==="SimulcastStreamInfo"?c.clone():bt.expand(c)};var kr=bt;const zr=kr,Ve=qt;let vt=class Bn{constructor(){this.send=[],this.recv=[]}clone(){const e=new Bn;for(const d of this.send)e.addSimulcastAlternativeStreams(Ve.SEND,d.map(w=>w.clone()));for(const d of this.recv)e.addSimulcastAlternativeStreams(Ve.RECV,d.map(w=>w.clone()));return e}plain(){const e={send:[],recv:[]};for(const d of this.send)e.send.push(d.map(w=>w.plain()));for(const d of this.recv)e.recv.push(d.map(w=>w.plain()));return e}addSimulcastAlternativeStreams(e,d){return e===Ve.SEND?this.send.push(d):this.recv.push(d)}addSimulcastStream(e,d){return e===Ve.SEND?this.send.push([d]):this.recv.push([d])}getSimulcastStreams(e){return e===Ve.SEND?this.send:this.recv}};vt.expand=function(c){if(c.constructor.name==="SimulcastInfo")return c;c=c;const e=new vt;for(const d of c.send||[])e.addSimulcastAlternativeStreams(Ve.SEND,d.map(zr.expand));for(const d of c.recv||[])e.addSimulcastAlternativeStreams(Ve.RECV,d.map(zr.expand));return e};vt.clone=function(c){return c.constructor.name==="SimulcastInfo"?c.clone():vt.expand(c)};var Er=vt;const ti=_r,pe=ti("SENDRECV","SENDONLY","RECVONLY","INACTIVE");pe.byValue=function(c){return pe[c.toUpperCase()]};pe.toString=function(c){switch(c){case pe.SENDRECV:return"sendrecv";case pe.SENDONLY:return"sendonly";case pe.RECVONLY:return"recvonly";case pe.INACTIVE:return"inactive"}};pe.reverse=function(c){switch(c){case pe.SENDRECV:return pe.SENDRECV;case pe.SENDONLY:return pe.RECVONLY;case pe.RECVONLY:return pe.SENDONLY;case pe.INACTIVE:return pe.INACTIVE}};var Tr=pe;let wt=class Xn{constructor(e,d){this.port=e,this.maxMessageSize=d}clone(){return new Xn(this.port,this.maxMessageSize)}plain(){return{port:this.port,maxMessageSize:this.maxMessageSize}}getPort(){return this.port}getMaxMessageSize(){return this.maxMessageSize}};wt.expand=function(c){return c.constructor.name==="DataChannelInfo"?c:(c=c,new wt(c.port,c.maxMessageSize))};wt.clone=function(c){return c.constructor.name==="DataChannelInfo"?c.clone():wt.expand(c)};var Lr=wt;const Ar=Jt,ri=Ir,zn=Er,Qe=Tr,lt=qt,Kn=Lr;let Be=class fr{constructor(e,d){this.id=e,this.type=d,this.direction=Qe.SENDRECV,this.extensions=new Map,this.codecs=new Map,this.rids=new Map,this.simulcast=null,this.bitrate=0,this.control=null,this.dataChannel=null}clone(){const e=new fr(this.id,this.type);e.setDirection(this.direction),e.setBitrate(this.bitrate);for(const d of this.codecs.values())e.addCodec(d.clone());for(const[d,w]of this.extensions.entries())e.addExtension(d,w);for(const d of this.rids.values())e.addRID(d.clone());return this.simulcast&&e.setSimulcast(this.simulcast.clone()),this.control&&e.setControl(this.control),this.dataChannel&&e.setDataChannel(this.dataChannel.clone()),e}plain(){const e={id:this.id,type:this.type,direction:Qe.toString(this.direction),codecs:[]};this.dataChannel&&(e.dataChannel=this.dataChannel.plain()),this.bitrate&&(e.bitrate=this.bitrate);for(const d of this.codecs.values())e.codecs.push(d.plain());for(const[d,w]of this.extensions.entries())e.extensions||(e.extensions={}),e.extensions[d]=w;for(const d of this.rids.values())e.rids||(e.rids=[]),e.rids.push(d.plain());return this.simulcast&&(e.simulcast=this.simulcast.plain()),this.control&&(e.control=this.control),e}getType(){return this.type}getId(){return this.id}setId(e){this.id=e}addExtension(e,d){this.extensions.set(e,d)}addRID(e){this.rids.set(e.getId(),e)}addCodec(e){this.codecs.set(e.getType(),e)}setCodecs(e){this.codecs=e}getCodecForType(e){return this.codecs.get(e)}getCodec(e){for(const d of this.codecs.values())if(d.getCodec().toLowerCase()===e.toLowerCase())return d;return null}hasCodec(e){return this.getCodec(e)!==null}getCodecs(){return this.codecs}hasRTX(){for(const e of this.codecs.values())if(e.hasRTX())return!0;return!1}getExtensions(){return this.extensions}getRIDs(){return this.rids}getRID(e){return this.rids.get(e)}getBitrate(){return this.bitrate}setBitrate(e){this.bitrate=e}getDirection(){return this.direction}setDirection(e){this.direction=e}hasControl(){return!!this.control}getControl(){return this.control}setControl(e){this.control=e}hasDataChannel(){return!!this.dataChannel}getDataChannel(){return this.dataChannel}setDataChannel(e){this.dataChannel=e}answer(e){const d=new fr(this.id,this.type);if(e){d.setDirection(Qe.reverse(this.direction));const{codecs:w,dataChannel:C}=e;if(w){let m;Array.isArray(w)?m=Ar.MapFromNames(w,e.rtx,e.rtcpfbs):m=w;for(let t of this.codecs.values())for(let v of m.values()){if(v.getCodec().toLowerCase()!==t.getCodec().toLowerCase()||v.getCodec()==="h264"&&v.hasParam("packetization-mode")&&v.getParam("packetization-mode")!=t.getParam("packetization-mode","0")||v.getCodec()==="h264"&&v.hasParam("profile-level-id")&&t.hasParam("profile-level-id")&&v.getParam("profile-level-id")!=t.getParam("profile-level-id")||v.getCodec()==="multiopus"&&v.hasParam("num_streams")&&t.hasParam("num_streams")&&v.getParam("num_streams")!=t.getParam("num_streams"))continue;const y=v.clone();y.setType(t.getType()),y.hasRTX()&&y.setRTX(t.getRTX()),t.hasChannels()&&y.setChannels(t.getChannels()),y.addParams(t.getParams()),d.addCodec(y);break}}const b=new Set(e.extensions);for(let[m,t]of this.extensions)b.has(t)&&d.addExtension(m,t);if(e.simulcast&&this.simulcast){const m=new zn,t=this.simulcast.getSimulcastStreams(lt.SEND);if(t)for(const y of t){const h=y.map(n=>n.clone());m.addSimulcastAlternativeStreams(lt.RECV,h)}const v=this.simulcast.getSimulcastStreams(lt.RECV);if(v)for(const y of v){const h=y.map(n=>n.clone());m.addSimulcastAlternativeStreams(lt.SEND,h)}for(const y of this.rids.values()){const h=y.clone();h.setDirection(lt.reverse(y.getDirection())),d.addRID(h)}d.setSimulcast(m)}if(C&&this.dataChannel){const m=new Kn(this.dataChannel.getPort(),C.maxMessageSize?C.maxMessageSize:this.dataChannel.getMaxMessageSize());d.setDataChannel(m)}}else d.setDirection(Qe.INACTIVE);return d}getSimulcast(){return this.simulcast}setSimulcast(e){this.simulcast=e}};Be.create=function(c,e){const d=new Be(c,c);if(e){const{codecs:w}=e;w&&(Array.isArray(w)?d.setCodecs(Ar.MapFromNames(w,e.rtx,e.rtcpfbs)):d.setCodecs(w))}else d.setDirection(Qe.INACTIVE);return d};Be.expand=function(c){if(c.constructor.name==="MediaInfo")return c;c=c;const e=new Be(c.id,c.type);if(c.direction&&e.setDirection(Qe.byValue(c.direction)),e.setBitrate(c.bitrate),c.dataChannel){const d=Kn.expand(c.dataChannel);d&&e.setDataChannel(d)}for(const[d,w]of Object.entries(c.extensions))e.addExtension(ni(d),w);for(const d of c.codecs){const w=Ar.expand(d);w&&e.addCodec(w)}for(const d of c.rids||[]){const w=ri.expand(d);e.addRID(w)}return c.simulcast&&e.setSimulcast(zn.expand(c.simulcast)),c.control&&e.setControl(c.control),e};Be.clone=function(c){return c.constructor.name==="MediaInfo"?c.clone():Be.expand(c)};function ni(c){const e=c.toString();if(!/^\d+$/.test(e))throw new Error("invalid integer ".concat(e));return parseInt(e)}var Yn=Be;let xt=class Hn{constructor(e,d){this.semantics=e,this.ssrcs=[];for(let w=0;w<d.length;++w)this.ssrcs.push(parseInt(d[w]))}clone(){return new Hn(this.semantics,this.ssrcs)}plain(){const e={semantics:this.semantics,ssrcs:[]};for(let d=0;d<this.ssrcs.length;++d)e.ssrcs.push(this.ssrcs[d]);return e}getSemantics(){return this.semantics}getSSRCs(){return this.ssrcs}};xt.expand=function(c){return c.constructor.name==="SourceGroupInfo"?c:(c=c,new xt(c.semantics,c.ssrcs))};xt.clone=function(c){return c.constructor.name==="SourceGroupInfo"?c.clone():xt.expand(c)};var Pr=xt;let St=class Jn{constructor(e){this.ssrc=e}clone(){const e=new Jn(this.ssrc);return e.setCName(this.cname),e.setStreamId(this.streamId),e.setTrackId(this.trackId),e}plain(){const e={ssrc:this.ssrc};return this.cname&&(e.cname=this.cname),this.streamId&&(e.streamId=this.streamId),this.trackId&&(e.trackId=this.trackId),e}getCName(){return this.cname}setCName(e){this.cname=e}getStreamId(){return this.streamId}setStreamId(e){this.streamId=e}getTrackId(){return this.trackId}setTrackId(e){this.trackId=e}getSSRC(){return this.ssrc}};St.expand=function(c){if(c.constructor.name==="SourceInfo")return c;c=c;const e=new St(c.ssrc);return e.setCName(c.cname),e.setStreamId(c.streamId),e.setTrackId(c.trackId),e};St.clone=function(c){return c.constructor.name==="SourceInfo"?c.clone():St.expand(c)};var Qn=St;const si=Jt;let _t=class qn{constructor(e,d=!1){this.id=e,this.paused=d,this.codecs=new Map,this.params=new Map}clone(){var e=new qn(this.id,this.paused);for(let d of this.codecs.values())e.addCodec(d.clone());return e.setParams(this.params),e}plain(){var e={id:this.id,paused:this.paused,codecs:{},params:{}};for(var[d,w]of this.codecs.entries())e.codecs[d]=w.plain();for(var[d,C]of this.params.entries())e.params[d]=C;return e}getId(){return this.id}getCodecs(){return this.codecs}addCodec(e){this.codecs.set(e.getType(),e)}getParams(){return this.params}setParams(e){this.params=new Map(e)}addParam(e,d){this.params.set(e,d)}isPaused(){return this.paused}};_t.expand=function(c){if(c.constructor.name==="TrackEncodingInfo")return c;c=c;const e=new _t(c.id,c.paused);for(const d of Object.values(c.codecs||{}))e.addCodec(si.expand(d));for(const[d,w]of Object.entries(c.params||{}))e.addParam(d,w);return e};_t.clone=function(c){return c.constructor.name==="TrackEncodingInfo"?c.clone():_t.expand(c)};var Mr=_t;const ii=Pr,oi=Mr;let Ct=class es{constructor(e,d){this.media=e,this.id=d,this.ssrcs=[],this.groups=[],this.encodings=[]}clone(){const e=new es(this.media,this.id);this.mediaId&&e.setMediaId(this.mediaId);for(let d=0;d<this.ssrcs.length;++d)e.addSSRC(this.ssrcs[d]);for(let d=0;d<this.groups.length;++d)e.addSourceGroup(this.groups[d].clone());for(let d=0;d<this.encodings.length;++d){const w=[];for(let C=0;C<this.encodings[d].length;++C)w.push(this.encodings[d][C].clone());e.addAlternativeEncodings(w)}return e}plain(){const e={media:this.media,id:this.id,ssrcs:[]};this.mediaId&&(e.mediaId=this.mediaId);for(let d=0;d<this.ssrcs.length;++d)e.ssrcs.push(this.ssrcs[d]);for(let d=0;d<this.groups.length;++d)e.groups||(e.groups=[]),e.groups.push(this.groups[d].plain());for(let d=0;d<this.encodings.length;++d){const w=[];for(let C=0;C<this.encodings[d].length;++C)w.push(this.encodings[d][C].plain());w.length&&(e.encodings||(e.encodings=[]),e.encodings.push(w))}return e}getMedia(){return this.media}setMediaId(e){this.mediaId=e}getMediaId(){return this.mediaId}getId(){return this.id}addSSRC(e){this.ssrcs.push(e)}getSSRCs(){return this.ssrcs}addSourceGroup(e){this.groups.push(e)}getSourceGroup(e){for(const d of this.groups)if(d.getSemantics().toLowerCase()===e.toLowerCase())return d;return null}getSourceGroups(){return this.groups}hasSourceGroup(e){for(const d of this.groups)if(d.getSemantics().toLowerCase()===e.toLowerCase())return!0;return!1}getEncodings(){return this.encodings}addEncoding(e){this.encodings.push([e])}addAlternativeEncodings(e){this.encodings.push(e)}setEncodings(e){this.encodings=e}};Ct.expand=function(c){if(c.constructor.name==="TrackInfo")return c;c=c;const e=new Ct(c.media,c.id);c.mediaId&&e.setMediaId(c.mediaId);for(const d of c.ssrcs||[])e.addSSRC(d);for(const d of c.groups||[])e.addSourceGroup(ii.expand(d));for(const d of c.encodings||[]){const w=[];for(const C of d)w.push(oi.expand(C));e.addAlternativeEncodings(w)}return e};Ct.clone=function(c){return c.constructor.name==="TrackInfo"?c.clone():Ct.expand(c)};var Or=Ct;const ai=Or;let Rt=class ts{constructor(e){this.id=e,this.tracks=new Map}clone(){const e=new ts(this.id);for(const d of this.tracks.values())e.addTrack(d.clone());return e}plain(){const e={id:this.id,tracks:[]};for(const d of this.tracks.values())e.tracks.push(d.plain());return e}getId(){return this.id}addTrack(e){this.tracks.set(e.getId(),e)}removeTrack(e){return this.tracks.delete(e.getId())}removeTrackById(e){return this.tracks.delete(e)}getFirstTrack(e){for(let d of this.tracks.values())if(d.getMedia().toLowerCase()===e.toLowerCase())return d;return null}getTracks(){return this.tracks}removeAllTracks(){this.tracks.clear()}getTrack(e){return this.tracks.get(e)}};Rt.expand=function(c){if(c.constructor.name==="StreamInfo")return c;c=c;const e=new Rt(c.id);for(const d of c.tracks||[]){const w=ai.expand(d);w&&e.addTrack(w)}return e};Rt.clone=function(c){return c.constructor.name==="StreamInfo"?c.clone():Rt.expand(c)};var rs=Rt;const qe=$e,Re=Ds("en-US"),tt=Ln,ci=Jt,li=Sr,rt=$n,nt=jn,Xe=Zn,$r=Yn,hr=Cr,pr=Tr,Ze=qt,ui=Pr,di=Qn,Wt=rs,ir=Or,fi=Mr,hi=Er,Kr=kr,pi=Ir,mi=Lr;let ke=class Ut{constructor(e){this.version=e||1,this.streams=new Map,this.medias=new Array,this.candidates=new Array,this.ice=null,this.dtls=null,this.crypto=null,this.extmapAllowMixed=!0}clone(){const e=new Ut(this.version);for(const d of this.medias)e.addMedia(d.clone());for(const d of this.streams.values())e.addStream(d.clone());for(const d of this.candidates)e.addCandidate(d.clone());return e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e.setExtmapAllowMixed(this.extmapAllowMixed),e}plain(){const e={version:this.version,streams:[],medias:[],candidates:[]};for(const d of this.medias)e.medias.push(d.plain());for(const d of this.streams.values())e.streams.push(d.plain());for(const d of this.candidates)e.candidates.push(d.plain());return this.ice&&(e.ice=this.ice.plain()),this.dtls&&(e.dtls=this.dtls.plain()),this.crypto&&(e.crypto=this.crypto.plain()),this.extmapAllowMixed||(e.extmapAllowMixedNotSupported=!this.extmapAllowMixed),e}unify(){const e=new Ut(this.version);for(const w of this.medias)e.addMedia(w.clone());const d={audio:e.getMediasByType("audio"),video:e.getMediasByType("video")};for(const w of this.streams.values()){const C=w.clone();for(const b of C.getTracks().values()){let m=d[b.getMedia()].pop();m||(m=this.getMedia(b.getMedia()).clone(),m.setId(b.getId()),e.addMedia(m)),b.setMediaId(m.getId())}e.addStream(C)}for(const w of this.candidates)e.addCandidate(w.clone());return this.ice&&e.setICE(this.ice.clone()),this.dtls&&e.setDTLS(this.dtls.clone()),this.crypto&&e.setCrypto(this.crypto.clone()),e}setVersion(e){this.version=e}addMedia(e){this.medias.push(e)}getMedia(e){for(let d in this.medias){let w=this.medias[d];if(Re(w.getType(),e))return w}return null}getMediasByType(e){let d=[];for(let w in this.medias){let C=this.medias[w];Re(C.getType(),e)&&d.push(C)}return d}getMediaById(e){for(const d of this.medias)if(Re(d.getId(),e))return d;return null}replaceMedia(e){for(let d in this.medias)if(this.medias[d].getId()==e.getId())return this.medias[d]=e,!0;return!1}getMedias(){return this.medias}getVersion(){return this.version}getDTLS(){return this.dtls}setDTLS(e){this.dtls=e}hasCrypto(){return!!this.crypto}getCrypto(){return this.crypto}setCrypto(e){this.crypto=e}hasICE(){return!!this.ice}getICE(){return this.ice}setICE(e){this.ice=e}addCandidate(e){for(const d of this.candidates)if(d.equals(e))return;this.candidates.push(e)}addCandidates(e){for(const d of e)this.addCandidate(d)}getCandidates(){return this.candidates}getStream(e){return this.streams.get(e)}getStreams(){return this.streams}getFirstStream(){for(const e of this.streams.values())return e;return null}addStream(e){this.streams.set(e.getId(),e)}removeStream(e){return this.streams.delete(e.getId())}removeAllStreams(){this.streams.clear()}getTrackByMediaId(e){for(const d of this.streams.values())for(const[w,C]of d.getTracks())if(C.getMediaId()==e)return C;return null}getStreamByMediaId(e){for(const d of this.streams.values())for(const[w,C]of d.getTracks())if(C.getMediaId()==e)return d;return null}getExtmapAllowMixed(){return this.extmapAllowMixed}setExtmapAllowMixed(e){this.extmapAllowMixed=e}answer(e){const d=new Ut;e.ice&&(e.ice instanceof Xe?d.setICE(e.ice.clone()):d.setICE(Xe.expand(e.ice))),e.dtls&&(e.dtls instanceof rt?d.setDTLS(e.dtls):d.setDTLS(rt.expand(e.dtls))),e.crypto&&(e.crypto instanceof nt?d.setCrypto(e.crypto):d.setCrypto(nt.expand(e.crypto)));for(let w=0;e.candidates&&w<e.candidates.length;++w)e.candidates[w]instanceof tt?d.addCandidate(e.candidates[w].clone()):d.addCandidate(tt.expand(e.candidates[w]));for(const w of this.medias){const C=e&&e.capabilities&&e.capabilities[w.getType()];d.addMedia(w.answer(C))}return d.setExtmapAllowMixed(this.extmapAllowMixed),d}toString(){let e={version:0,media:[]};e.version=0,e.origin={username:"-",sessionId:new Date().getTime(),sessionVersion:this.version,netType:"IN",ipVer:4,address:"127.0.0.1"},e.name="semantic-sdp",e.connection={version:4,ip:"0.0.0.0"},e.timing={start:0,stop:0},this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),e.msidSemantic={semantic:"WMS",token:"*"},e.groups=[],this.extmapAllowMixed&&(e.extmapAllowMixed="extmap-allow-mixed");const d=[];for(const C of this.medias){let b={type:C.getType(),port:9,protocol:"",fmtp:[],rtp:[],rtcpFb:[],ext:[],bandwidth:[],candidates:[],ssrcGroups:[],ssrcs:[],rids:[]};b.direction=pr.toString(C.getDirection()),this.extmapAllowMixed&&(b.extmapAllowMixed="extmap-allow-mixed"),b.mid=C.getId(),d.push(C.getId()),C.hasControl()&&(b.control=C.getControl()),C.getBitrate()>0&&(b.bandwidth.push({type:"AS",limit:C.getBitrate()}),b.bandwidth.push({type:"TIAS",limit:C.getBitrate()*1e3}));let m=this.getCandidates();for(const t of m)b.candidates.push({foundation:t.getFoundation(),component:t.getComponentId(),transport:t.getTransport(),priority:t.getPriority(),ip:t.getAddress(),port:t.getPort(),type:t.getType(),raddr:t.getRelAddr(),rport:t.getRelPort()});if(this.getICE()&&(b.iceUfrag=this.getICE().getUfrag(),b.icePwd=this.getICE().getPwd()),Re("audio",C.getType())||Re("video",C.getType())){b.rtcpMux="rtcp-mux",b.rtcpRsize="rtcp-rsize",this.getDTLS()?(b.protocol="UDP/TLS/RTP/SAVPF",b.fingerprint={type:this.getDTLS().getHash(),hash:this.getDTLS().getFingerprint()},b.setup=hr.toString(this.getDTLS().getSetup())):this.getCrypto()?(b.protocol="RTP/SAVPF",b.crypto=[{id:this.getCrypto().getTag(),suite:this.getCrypto().getSuite(),config:this.getCrypto().getKeyParams()}]):b.protocol="RTP/AVP";for(const y of C.getCodecs().values()){Re("video",C.getType())?b.rtp.push({payload:y.getType(),codec:y.getCodec().toUpperCase(),rate:9e4}):Re("opus",y.getCodec())?b.rtp.push({payload:y.getType(),codec:y.getCodec(),rate:48e3,encoding:y.getChannels()}):Re("multiopus",y.getCodec())?b.rtp.push({payload:y.getType(),codec:y.getCodec(),rate:48e3,encoding:y.getChannels()}):b.rtp.push({payload:y.getType(),codec:y.getCodec(),rate:8e3});for(const n of y.getRTCPFeedbacks())b.rtcpFb.push({payload:y.getType(),type:n.getId(),subtype:n.getParams().join(" ")});y.hasRTX()&&(b.rtp.push({payload:y.getRTX(),codec:"rtx",rate:9e4}),b.fmtp.push({payload:y.getRTX(),config:"apt="+y.getType()}));const h=y.getParams();if(Object.keys(h).length){const n={payload:y.getType(),config:""};for(const i in h)n.config.length&&(n.config+=";"),Object.hasOwnProperty.call(h,i)?n.config+=i+"="+h[i]:n.config+=i;b.fmtp.push(n)}}const t=[];for(const y of b.rtp)t.push(y.payload);b.payloads=t.join(" ");for(let[y,h]of C.getExtensions().entries())b.ext.push({value:y,uri:h});for(let y of C.getRIDs().values()){let h={id:y.getId(),direction:Ze.toString(y.getDirection()),params:""};y.getFormats().length&&(h.params="pt="+y.getFormats().join(","));for(let[n,i]of y.getParams().entries())h.params+=(h.params.length?";":"")+n+"="+i;b.rids.push(h)}const v=C.getSimulcast();if(v){let y=1;b.simulcast={};const h=v.getSimulcastStreams(Ze.SEND),n=v.getSimulcastStreams(Ze.RECV);if(h&&h.length){let i="";for(const o of h){let s="";for(const r of o)s+=(s.length?",":"")+(r.isPaused()?"~":"")+r.getId();i+=(i.length?";":"")+s}b.simulcast["dir"+y]="send",b.simulcast["list"+y]=i,y++}if(n&&n.length){let i="";for(const o of n){let s="";for(const r of o)s+=(s.length?",":"")+(r.isPaused()?"~":"")+r.getId();i+=(i.length?";":"")+s}b.simulcast["dir"+y]="recv",b.simulcast["list"+y]=i,y++}}}else if(C.hasDataChannel()){b.protocol="UDP/DTLS/SCTP",b.payloads="webrtc-datachannel";const t=C.getDataChannel();b.sctpPort=t.getPort(),b.maxMessageSize=t.getMaxMessageSize()}e.media.push(b)}for(let C of this.streams.values())for(let b of C.getTracks().values())for(let m in e.media){let t=e.media[m];if(b.getMediaId()){if(b.getMediaId()==t.mid){let v=b.getSourceGroups();for(let h in v){let n=v[h];t.ssrcGroups.push({semantics:n.getSemantics(),ssrcs:n.getSSRCs().join(" ")})}let y=b.getSSRCs();for(let h in y)t.ssrcs.push({id:y[h],attribute:"cname",value:C.getId()}),t.ssrcs.push({id:y[h],attribute:"msid",value:C.getId()+" "+b.getId()});t.msid=C.getId()+" "+b.getId();break}}else if(Re(t.type,b.getMedia())){let v=b.getSourceGroups();for(let h in v){let n=v[h];t.ssrcGroups.push({semantics:n.getSemantics(),ssrcs:n.getSSRCs().join(" ")})}let y=b.getSSRCs();for(let h in y)t.ssrcs.push({id:y[h],attribute:"cname",value:C.getId()}),t.ssrcs.push({id:y[h],attribute:"msid",value:C.getId()+" "+b.getId()});break}}const w={type:"BUNDLE",mids:d.join(" ")};return e.groups.push(w),qe.write(e)}toIceFragmentString(){let e={version:0,media:[],candidates:[]};this.hasICE()&&this.getICE().isLite()&&(e.icelite="ice-lite"),this.getICE()&&(e.iceUfrag=this.getICE().getUfrag(),e.icePwd=this.getICE().getPwd());for(const d of this.getCandidates())e.candidates.push({foundation:d.getFoundation(),component:d.getComponentId(),transport:d.getTransport(),priority:d.getPriority(),ip:d.getAddress(),port:d.getPort(),type:d.getType(),raddr:d.getRelAddr(),rport:d.getRelPort()});return qe.write(e).slice(10)}};ke.create=function(c){const e=new ke;c.ice&&(c.ice instanceof Xe?e.setICE(c.ice.clone()):e.setICE(Xe.expand(c.ice))),c.dtls&&(c.dtls instanceof rt?e.setDTLS(c.dtls):e.setDTLS(rt.expand(c.dtls))),c.crypto&&(c.crypto instanceof nt?e.setCrypto(c.crypto):e.setCrypto(nt.expand(c.crypto)));for(const C of c.candidates||[])C instanceof tt?e.addCandidate(C.clone()):e.addCandidate(tt.expand(C));let d=96,w=1;for(const[C,b]of Object.entries(c.capabilities||{})){const m=$r.create(C,b);for(const[t,v]of m.getCodecs())v.getType()>=96&&v.setType(d++),v.getRTX()&&v.setRTX(d++);if(b.extensions)for(let t of b.extensions)w===15&&w++,m.addExtension(w++,t);e.addMedia(m)}return e};ke.expand=function(c){if(c.constructor.name==="SDPInfo")return c;c=c;const e=new ke(c.version);for(const d of c.medias||[]){const w=$r.expand(d);w&&e.addMedia(w)}for(const d of c.streams||[]){const w=Wt.expand(d);w&&e.addStream(w)}for(const d of c.candidates||[]){const w=tt.expand(d);w&&e.addCandidate(w)}return c.ice&&e.setICE(Xe.expand(c.ice)),c.dtls&&e.setDTLS(rt.expand(c.dtls)),c.crypto&&e.setCrypto(nt.expand(c.crypto)),c.extmapAllowMixedNotSupported&&(this.extmapAllowMixed=!c.extmapAllowMixedNotSupported),e};ke.clone=function(c){return c.constructor.name==="SDPInfo"?c.clone():ke.expand(c)};ke.process=function(c){return ke.parse(c)};ke.parse=function(c){const e=qe.parse(c),d=new ke;if(d.setVersion(e.version),e.iceUfrag&&e.icePwd){const w=String(e.iceUfrag),C=String(e.icePwd),b=new Xe(w,C);b.setLite(e.icelite=="ice-lite"),b.setEndOfCandidates(e.endOfCandidates=="end-of-candidates"),d.setICE(b)}for(let w in e.media){const C=e.media[w],b=C.type,m=C.mid?C.mid.toString():w,t=new $r(m,b);if(C.iceUfrag&&C.icePwd){const r=String(C.iceUfrag),l=String(C.icePwd),a=new Xe(r,l);a.setLite(e.icelite=="ice-lite"),a.setEndOfCandidates(C.endOfCandidates=="end-of-candidates"),d.setICE(a)}for(let r=0;C.candidates&&r<C.candidates.length;++r){const l=C.candidates[r],a=new tt(l.foundation,l.component,l.transport,l.priority,l.ip,l.port,l.type,l.raddr,l.rport);d.addCandidate(a)}const v=C.fingerprint||e.fingerprint;if(v){const r=v.type,l=v.hash;let a=hr.ACTPASS;C.setup&&(a=hr.byValue(C.setup)),d.setDTLS(new rt(a,r,l))}if(C.crypto){const r=C.crypto[0];d.setCrypto(new nt(r.id,r.suite,r.config,r.sessionConfig))}let y=pr.SENDRECV;C.direction&&(y=pr.byValue(C.direction),t.setDirection(y)),C.control&&t.setControl(C.control),d.setExtmapAllowMixed(C.extmapAllowMixed=="extmap-allow-mixed"||e.extmapAllowMixed=="extmap-allow-mixed");const h=new Map;for(let r in C.rtp){const l=C.rtp[r],a=l.payload,u=l.codec;if(u.toUpperCase()==="RED"||u.toUpperCase()==="ULPFEC")continue;let f={};for(let p in C.fmtp){const _=C.fmtp[p];if(_.payload===a){const k=_.config.split(";");for(let E in k){const g=k[E].split("="),R=g[0].trim(),I=g.splice(1).join("=").trim();f[R]=I}}}if(u.toUpperCase()==="RTX")h.set(parseInt(f.apt),a);else{const p=new ci(u,a,f);l.encoding>1&&p.setChannels(l.encoding),t.addCodec(p)}}for(let r of h.entries()){const l=t.getCodecForType(r[0]);l&&l.setRTX(r[1])}for(let r=0;C.rtcpFb&&r<C.rtcpFb.length;++r){const l=t.getCodecForType(C.rtcpFb[r].payload);if(l){const a=C.rtcpFb[r].type,u=C.rtcpFb[r].subtype?C.rtcpFb[r].subtype.split(" "):null;l.addRTCPFeedback(new li(a,u))}}const n=C.ext;for(let r in n){const l=n[r];t.addExtension(l.value,l.uri)}const i=C.rids;for(let r in i){const l=i[r],a=new pi(l.id,Ze.byValue(l.direction));let u=[];const f=new Map;if(l.params){const p=qe.parseParams(l.params);for(let _ in p)_==="pt"?u=p[_].split(","):f.set(_,p[_]);a.setFormats(u),a.setParams(f)}t.addRID(a)}const o=[];if(C.simulcast){const r=new hi;if(C.simulcast.dir1){const l=Ze.byValue(C.simulcast.dir1),a=qe.parseSimulcastStreamList(C.simulcast.list1);for(let u=0;u<a.length;++u){const f=[];for(let p=0;p<a[u].length;++p)f.push(new Kr(a[u][p].scid,a[u][p].paused));r.addSimulcastAlternativeStreams(l,f)}}if(C.simulcast.dir2){const l=Ze.byValue(C.simulcast.dir2),a=qe.parseSimulcastStreamList(C.simulcast.list2);for(let u=0;u<a.length;++u){const f=[];for(let p=0;p<a[u].length;++p)f.push(new Kr(a[u][p].scid,a[u][p].paused));r.addSimulcastAlternativeStreams(l,f)}}for(let l of r.getSimulcastStreams(Ze.SEND)){const a=[];for(let u=0;u<l.length;u++){const f=new fi(l[u].getId(),l[u].isPaused()),p=t.getRID(f.getId());if(p){const _=p.getFormats();for(let k=0;_&&k<_.length;++k){const E=t.getCodecForType(_[k]);E&&f.addCodec(E)}f.setParams(p.getParams()),a.push(f)}}a.length&&o.push(a)}t.setSimulcast(r)}const s=new Map;if(C.ssrcs)for(let r in C.ssrcs){let l=C.ssrcs[r],a=l.id,u=l.attribute,f=l.value,p=s.get(a);if(p||(p=new di(a),s.set(p.getSSRC(),p)),Re("cname",u))p.setCName(f);else if(Re("msid",u)){let _=f.split(" "),k=_[0],E=_[1];p.setStreamId(k),p.setTrackId(E);let g=d.getStream(k);g||(g=new Wt(k),d.addStream(g));let R=g.getTrack(E);R||(R=new ir(b,E),R.setMediaId(m),R.setEncodings(o),g.addTrack(R)),R.addSSRC(a)}}if(C.msid){let r=C.msid.split(" "),l=r[0],a=r[1],u=d.getStream(l);u||(u=new Wt(l),d.addStream(u));let f=u.getTrack(a);f||(f=new ir(b,a),f.setMediaId(m),f.setEncodings(o),u.addTrack(f));for(let[p,_]of s.entries())_.getStreamId()||(_.setStreamId(l),_.setTrackId(a),f.addSSRC(p))}for(let[r,l]of s.entries())if(!l.getStreamId()){let a=l.getCName(),u=m;l.setStreamId(a),l.setTrackId(u);let f=d.getStream(a);f||(f=new Wt(a),d.addStream(f));let p=f.getTrack(u);p||(p=new ir(b,u),p.setMediaId(m),p.setEncodings(o),f.addTrack(p)),p.addSSRC(r)}if(C.ssrcGroups)for(let r in C.ssrcGroups){let l=C.ssrcGroups[r],a=l.ssrcs.split(" "),u=new ui(l.semantics,a),f=s.get(parseInt(a[0]));f&&d.getStream(f.getStreamId()).getTrack(f.getTrackId()).addSourceGroup(u)}if(C.type=="application"&&C.payloads=="webrtc-datachannel"){const r=new mi(C.sctpPort,C.maxMessageSize);t.setDataChannel(r)}d.addMedia(t)}return d};var gi=ke;Object.defineProperty(fe,"__esModule",{value:!0});var ut=fe.SDPInfo=gi;fe.CandidateInfo=Ln;fe.CodecInfo=Jt;fe.DTLSInfo=$n;fe.CryptoInfo=jn;fe.ICEInfo=Zn;var yi=fe.MediaInfo=Yn;fe.Setup=Cr;fe.SourceGroupInfo=Pr;fe.SourceInfo=Qn;fe.StreamInfo=rs;fe.TrackInfo=Or;fe.RTCPFeedbackInfo=Sr;fe.TrackEncodingInfo=Mr;fe.RIDInfo=Ir;fe.SimulcastInfo=Er;fe.SimulcastStreamInfo=kr;fe.DataChannelInfo=Lr;var bi=fe.Direction=Tr,mr={exports:{}};(function(c,e){(function(d,w){var C="0.7.37",b="",m="?",t="function",v="undefined",y="object",h="string",n="major",i="model",o="name",s="type",r="vendor",l="version",a="architecture",u="console",f="mobile",p="tablet",_="smarttv",k="wearable",E="embedded",g=500,R="Amazon",I="Apple",A="ASUS",O="BlackBerry",N="Browser",V="Chrome",B="Edge",Z="Firefox",M="Google",F="Huawei",X="LG",U="Microsoft",W="Motorola",K="Opera",ee="Samsung",se="Sharp",ie="Sony",le="Xiaomi",ge="Zebra",Ae="Facebook",Et="Chromium OS",Tt="Mac OS",Lt=function(z,Y){var G={};for(var re in z)Y[re]&&Y[re].length%2===0?G[re]=Y[re].concat(z[re]):G[re]=z[re];return G},Pe=function(z){for(var Y={},G=0;G<z.length;G++)Y[z[G].toUpperCase()]=z[G];return Y},we=function(z,Y){return typeof z===h?Me(Y).indexOf(Me(z))!==-1:!1},Me=function(z){return z.toLowerCase()},er=function(z){return typeof z===h?z.replace(/[^\d\.]/g,b).split(".")[0]:w},T=function(z,Y){if(typeof z===h)return z=z.replace(/^\s\s*/,b),typeof Y===v?z:z.substring(0,g)},x=function(z,Y){for(var G=0,re,Ce,xe,ne,H,Ee;G<Y.length&&!H;){var tr=Y[G],Dr=Y[G+1];for(re=Ce=0;re<tr.length&&!H&&tr[re];)if(H=tr[re++].exec(z),H)for(xe=0;xe<Dr.length;xe++)Ee=H[++Ce],ne=Dr[xe],typeof ne===y&&ne.length>0?ne.length===2?typeof ne[1]==t?this[ne[0]]=ne[1].call(this,Ee):this[ne[0]]=ne[1]:ne.length===3?typeof ne[1]===t&&!(ne[1].exec&&ne[1].test)?this[ne[0]]=Ee?ne[1].call(this,Ee,ne[2]):w:this[ne[0]]=Ee?Ee.replace(ne[1],ne[2]):w:ne.length===4&&(this[ne[0]]=Ee?ne[3].call(this,Ee.replace(ne[1],ne[2])):w):this[ne]=Ee||w;G+=2}},S=function(z,Y){for(var G in Y)if(typeof Y[G]===y&&Y[G].length>0){for(var re=0;re<Y[G].length;re++)if(we(Y[G][re],z))return G===m?w:G}else if(we(Y[G],z))return G===m?w:G;return z},L={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},P={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},j={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[l,[o,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[l,[o,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[o,l],[/opios[\/ ]+([\w\.]+)/i],[l,[o,K+" Mini"]],[/\bopr\/([\w\.]+)/i],[l,[o,K]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[l,[o,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[o,l],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[l,[o,"UC"+N]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[l,[o,"WeChat"]],[/konqueror\/([\w\.]+)/i],[l,[o,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[l,[o,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[l,[o,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[l,[o,"Smart Lenovo "+N]],[/(avast|avg)\/([\w\.]+)/i],[[o,/(.+)/,"$1 Secure "+N],l],[/\bfocus\/([\w\.]+)/i],[l,[o,Z+" Focus"]],[/\bopt\/([\w\.]+)/i],[l,[o,K+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[l,[o,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[l,[o,"Dolphin"]],[/coast\/([\w\.]+)/i],[l,[o,K+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[l,[o,"MIUI "+N]],[/fxios\/([-\w\.]+)/i],[l,[o,Z]],[/\bqihu|(qi?ho?o?|360)browser/i],[[o,"360 "+N]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[o,/(.+)/,"$1 "+N],l],[/samsungbrowser\/([\w\.]+)/i],[l,[o,ee+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],l],[/metasr[\/ ]?([\d\.]+)/i],[l,[o,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[o,"Sogou Mobile"],l],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[o,l],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[o],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[o,Ae],l],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[o,l],[/\bgsa\/([\w\.]+) .*safari\//i],[l,[o,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[l,[o,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[l,[o,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[o,V+" WebView"],l],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[l,[o,"Android "+N]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[o,l],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[l,[o,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[l,o],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[o,[l,S,L]],[/(webkit|khtml)\/([\w\.]+)/i],[o,l],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[o,"Netscape"],l],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[l,[o,Z+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[o,l],[/(cobalt)\/([\w\.]+)/i],[o,[l,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[a,"amd64"]],[/(ia32(?=;))/i],[[a,Me]],[/((?:i[346]|x)86)[;\)]/i],[[a,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[a,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[a,"armhf"]],[/windows (ce|mobile); ppc;/i],[[a,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[a,/ower/,b,Me]],[/(sun4\w)[;\)]/i],[[a,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[a,Me]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[i,[r,ee],[s,p]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[i,[r,ee],[s,f]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[i,[r,I],[s,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[i,[r,I],[s,p]],[/(macintosh);/i],[i,[r,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[i,[r,se],[s,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[i,[r,F],[s,p]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[i,[r,F],[s,f]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[i,/_/g," "],[r,le],[s,f]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[i,/_/g," "],[r,le],[s,p]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[i,[r,"OPPO"],[s,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[i,[r,"Vivo"],[s,f]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[i,[r,"Realme"],[s,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[i,[r,W],[s,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[i,[r,W],[s,p]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[i,[r,X],[s,p]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[i,[r,X],[s,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[i,[r,"Lenovo"],[s,p]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[i,/_/g," "],[r,"Nokia"],[s,f]],[/(pixel c)\b/i],[i,[r,M],[s,p]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[i,[r,M],[s,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[i,[r,ie],[s,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[i,"Xperia Tablet"],[r,ie],[s,p]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[i,[r,"OnePlus"],[s,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[i,[r,R],[s,p]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[i,/(.+)/g,"Fire Phone $1"],[r,R],[s,f]],[/(playbook);[-\w\),; ]+(rim)/i],[i,r,[s,p]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[i,[r,O],[s,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[i,[r,A],[s,p]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[i,[r,A],[s,f]],[/(nexus 9)/i],[i,[r,"HTC"],[s,p]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[r,[i,/_/g," "],[s,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[i,[r,"Acer"],[s,p]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[i,[r,"Meizu"],[s,f]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[i,[r,"Ulefone"],[s,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[r,i,[s,f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[r,i,[s,p]],[/(surface duo)/i],[i,[r,U],[s,p]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[i,[r,"Fairphone"],[s,f]],[/(u304aa)/i],[i,[r,"AT&T"],[s,f]],[/\bsie-(\w*)/i],[i,[r,"Siemens"],[s,f]],[/\b(rct\w+) b/i],[i,[r,"RCA"],[s,p]],[/\b(venue[\d ]{2,7}) b/i],[i,[r,"Dell"],[s,p]],[/\b(q(?:mv|ta)\w+) b/i],[i,[r,"Verizon"],[s,p]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[i,[r,"Barnes & Noble"],[s,p]],[/\b(tm\d{3}\w+) b/i],[i,[r,"NuVision"],[s,p]],[/\b(k88) b/i],[i,[r,"ZTE"],[s,p]],[/\b(nx\d{3}j) b/i],[i,[r,"ZTE"],[s,f]],[/\b(gen\d{3}) b.+49h/i],[i,[r,"Swiss"],[s,f]],[/\b(zur\d{3}) b/i],[i,[r,"Swiss"],[s,p]],[/\b((zeki)?tb.*\b) b/i],[i,[r,"Zeki"],[s,p]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[r,"Dragon Touch"],i,[s,p]],[/\b(ns-?\w{0,9}) b/i],[i,[r,"Insignia"],[s,p]],[/\b((nxa|next)-?\w{0,9}) b/i],[i,[r,"NextBook"],[s,p]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[r,"Voice"],i,[s,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[r,"LvTel"],i,[s,f]],[/\b(ph-1) /i],[i,[r,"Essential"],[s,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[i,[r,"Envizen"],[s,p]],[/\b(trio[-\w\. ]+) b/i],[i,[r,"MachSpeed"],[s,p]],[/\btu_(1491) b/i],[i,[r,"Rotor"],[s,p]],[/(shield[\w ]+) b/i],[i,[r,"Nvidia"],[s,p]],[/(sprint) (\w+)/i],[r,i,[s,f]],[/(kin\.[onetw]{3})/i],[[i,/\./g," "],[r,U],[s,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[i,[r,ge],[s,p]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[i,[r,ge],[s,f]],[/smart-tv.+(samsung)/i],[r,[s,_]],[/hbbtv.+maple;(\d+)/i],[[i,/^/,"SmartTV"],[r,ee],[s,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[r,X],[s,_]],[/(apple) ?tv/i],[r,[i,I+" TV"],[s,_]],[/crkey/i],[[i,V+"cast"],[r,M],[s,_]],[/droid.+aft(\w+)( bui|\))/i],[i,[r,R],[s,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[i,[r,se],[s,_]],[/(bravia[\w ]+)( bui|\))/i],[i,[r,ie],[s,_]],[/(mitv-\w{5}) bui/i],[i,[r,le],[s,_]],[/Hbbtv.*(technisat) (.*);/i],[r,i,[s,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[r,T],[i,T],[s,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[s,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[r,i,[s,u]],[/droid.+; (shield) bui/i],[i,[r,"Nvidia"],[s,u]],[/(playstation [345portablevi]+)/i],[i,[r,ie],[s,u]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[i,[r,U],[s,u]],[/((pebble))app/i],[r,i,[s,k]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[i,[r,I],[s,k]],[/droid.+; (glass) \d/i],[i,[r,M],[s,k]],[/droid.+; (wt63?0{2,3})\)/i],[i,[r,ge],[s,k]],[/(quest( 2| pro)?)/i],[i,[r,Ae],[s,k]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[r,[s,E]],[/(aeobc)\b/i],[i,[r,R],[s,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[i,[s,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[i,[s,p]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[s,p]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[s,f]],[/(android[-\w\. ]{0,9});.+buil/i],[i,[r,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[l,[o,B+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[l,[o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[o,l],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[l,o]],os:[[/microsoft (windows) (vista|xp)/i],[o,l],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[o,[l,S,P]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,S,P],[o,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[l,/_/g,"."],[o,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[o,Tt],[l,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[l,o],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[o,l],[/\(bb(10);/i],[l,[o,O]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[l,[o,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[l,[o,Z+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[l,[o,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[l,[o,"watchOS"]],[/crkey\/([\d\.]+)/i],[l,[o,V+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[o,Et],l],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[o,l],[/(sunos) ?([\w\.\d]*)/i],[[o,"Solaris"],l],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[o,l]]},D=function(z,Y){if(typeof z===y&&(Y=z,z=w),!(this instanceof D))return new D(z,Y).getResult();var G=typeof d!==v&&d.navigator?d.navigator:w,re=z||(G&&G.userAgent?G.userAgent:b),Ce=G&&G.userAgentData?G.userAgentData:w,xe=Y?Lt(j,Y):j,ne=G&&G.userAgent==re;return this.getBrowser=function(){var H={};return H[o]=w,H[l]=w,x.call(H,re,xe.browser),H[n]=er(H[l]),ne&&G&&G.brave&&typeof G.brave.isBrave==t&&(H[o]="Brave"),H},this.getCPU=function(){var H={};return H[a]=w,x.call(H,re,xe.cpu),H},this.getDevice=function(){var H={};return H[r]=w,H[i]=w,H[s]=w,x.call(H,re,xe.device),ne&&!H[s]&&Ce&&Ce.mobile&&(H[s]=f),ne&&H[i]=="Macintosh"&&G&&typeof G.standalone!==v&&G.maxTouchPoints&&G.maxTouchPoints>2&&(H[i]="iPad",H[s]=p),H},this.getEngine=function(){var H={};return H[o]=w,H[l]=w,x.call(H,re,xe.engine),H},this.getOS=function(){var H={};return H[o]=w,H[l]=w,x.call(H,re,xe.os),ne&&!H[o]&&Ce&&Ce.platform!="Unknown"&&(H[o]=Ce.platform.replace(/chrome os/i,Et).replace(/macos/i,Tt)),H},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return re},this.setUA=function(H){return re=typeof H===h&&H.length>g?T(H,g):H,this},this.setUA(re),this};D.VERSION=C,D.BROWSER=Pe([o,l,n]),D.CPU=Pe([a]),D.DEVICE=Pe([i,r,s,u,f,_,p,k,E]),D.ENGINE=D.OS=Pe([o,l]),c.exports&&(e=c.exports=D),e.UAParser=D;var Q=typeof d!==v&&(d.jQuery||d.Zepto);if(Q&&!Q.ua){var te=new D;Q.ua=te.getResult(),Q.ua.get=function(){return te.getUA()},Q.ua.set=function(z){te.setUA(z);var Y=te.getResult();for(var G in Y)Q.ua[G]=Y[G]}}})(typeof window=="object"?window:Bt)})(mr,mr.exports);var vi=mr.exports;const wi=st(vi),xi=["iOS"];class It extends wi{constructor(){super(window.navigator.userAgent)}isChromium(){return this.getUA().match(/Chrome/i)}isChrome(){const e=this.getBrowser();if(!e.name)return!1;const d=this.getOS();let w=!0;return w=!new RegExp(xi.join("|"),"i").test(d.name),e.name.match(/Chrome/i)&&w}isFirefox(){const e=this.getBrowser();return e.name?e.name.match(/Firefox/i):!1}isOpera(){const e=this.getBrowser();return e.name?e.name.match(/Opera/i):!1}isSafari(){const e=this.getBrowser();return e.name?e.name.match(/Safari/i):!1}}const ae=Oe.get("SdpParser"),Yr=35,Si=65,Hr=96,_i=127,Ci=Array.from({length:Si-Yr+1},(c,e)=>e+Yr),Ri=Array.from({length:_i-Hr+1},(c,e)=>e+Hr),Jr=1,Ii=14,Qr=16,ki=255,Ei=Array.from({length:Ii-Jr+1},(c,e)=>e+Jr),Ti=Array.from({length:ki-Qr+1},(c,e)=>e+Qr),me={setSimulcast(c,e){if(ae.info("Setting simulcast. Codec: ",e),!new It().isChromium())return ae.warn("Your browser does not appear to support Simulcast. For a better experience, use a Chromium based browser."),c;if(e!=="h264"&&e!=="vp8")return ae.warn("Your selected codec ".concat(e," does not appear to support Simulcast.  To broadcast using simulcast, please use H.264 or VP8.")),c;if(!/m=video/.test(c))return ae.warn("There is no available video for simulcast to be enabled."),c;try{const w=new RegExp("m=video.*?a=ssrc:(\\d*) cname:(.+?)\\r\\n","s"),C=new RegExp("m=video.*?a=ssrc:(\\d*) msid:(.+?)\\r\\n","s"),b=w.exec(c),m=b[1],t=b[2],v=C.exec(c)[2],y=2,h=[m];for(let n=0;n<y;++n){const i=100+n*2,o=i+1;h.push(i),c+="a=ssrc-group:FID "+i+" "+o+"\r\na=ssrc:"+i+" cname:"+t+"\r\na=ssrc:"+i+" msid:"+v+"\r\na=ssrc:"+o+" cname:"+t+"\r\na=ssrc:"+o+" msid:"+v+"\r\n"}return c+="a=ssrc-group:SIM "+h.join(" ")+"\r\n",ae.info("Simulcast setted"),ae.debug("Simulcast SDP: ",c),c}catch(w){throw ae.error("Error setting SDP for simulcast: ",w),w}},setStereo(c){return ae.info("Replacing SDP response for support stereo"),c=c.replace(/useinbandfec=1/g,"useinbandfec=1; stereo=1"),ae.info("Replaced SDP response for support stereo"),ae.debug("New SDP value: ",c),c},setDTX(c){return ae.info("Replacing SDP response for support dtx"),c=c.replace("useinbandfec=1","useinbandfec=1; usedtx=1"),ae.info("Replaced SDP response for support dtx"),ae.debug("New SDP value: ",c),c},setAbsoluteCaptureTime(c){const d="a=extmap:"+me.getAvailableHeaderExtensionIdRange(c)[0]+" http://www.webrtc.org/experiments/rtp-hdrext/abs-capture-time\r\n",w=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return c=c.replace(w,(C,b,m)=>b+d+m),ae.info("Replaced SDP response for setting absolute capture time"),ae.debug("New SDP value: ",c),c},setDependencyDescriptor(c){const d="a=extmap:"+me.getAvailableHeaderExtensionIdRange(c)[0]+" https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension\r\n",w=/(m=.*\r\n(?:.*\r\n)*?)(a=extmap.*\r\n)/gm;return c=c.replace(w,(C,b,m)=>b+d+m),ae.info("Replaced SDP response for setting depency descriptor"),ae.debug("New SDP value: ",c),c},setVideoBitrate(c,e){if(e<1)ae.info("Remove bitrate restrictions"),c=c.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");else{const d=ut.parse(c),w=d.getMedia("video");ae.info("Setting video bitrate"),w.setBitrate(e),c=d.toString()}return c},removeSdpLine(c,e){return ae.debug("SDP before trimming: ",c),c=c.split("\n").filter(d=>d.trim()!==e).join("\n"),ae.debug("SDP trimmed result: ",c),c},adaptCodecName(c,e,d){if(!c)return c;const w=new RegExp("".concat(e),"i");return c.replace(w,d)},setMultiopus(c,e){if(!new It().isFirefox()&&(!e||Li(e)))if(c.includes("multiopus/48000/6"))ae.info("Multiopus already setted");else{ae.info("Setting multiopus");const C=/m=audio 9 UDP\/TLS\/RTP\/SAVPF (.*)\r\n/.exec(c)[0],b=me.getAvailablePayloadTypeRange(c)[0],m=C.replace("\r\n"," ")+b+"\r\na=rtpmap:"+b+" multiopus/48000/6\r\na=fmtp:"+b+" channel_mapping=0,4,1,2,3,5;coupled_streams=2;minptime=10;num_streams=4;useinbandfec=1\r\n";c=c.replace(C,m),ae.info("Multiopus offer created"),ae.debug("SDP parsed for multioups: ",c)}return c},getAvailablePayloadTypeRange(c){const e=/m=(?:.*) (?:.*) UDP\/TLS\/RTP\/SAVPF (.*)\r\n/gm,d=c.matchAll(e);let w=Ri.concat(Ci);for(const C of d){const b=C[1].split(" ").map(m=>parseInt(m));w=w.filter(m=>!b.includes(m))}return w},getAvailableHeaderExtensionIdRange(c){const e=/a=extmap:(\d+)(?:.*)\r\n/gm,d=c.matchAll(e);let w=Ei.concat(Ti);for(const C of d){const b=C[1].split(" ").map(m=>parseInt(m));w=w.filter(m=>!b.includes(m))}return w},renegotiate(c,e){const d=ut.parse(c),w=ut.parse(e);for(const C of d.getMedias()){let b=w.getMediaById(C.getId());if(!b){b=new yi(C.getId(),C.getType()),b.setDirection(bi.reverse(C.getDirection()));const m=w.getMedia(C.getType());if(m){b.setCodecs(m.getCodecs());for(const[t,v]of m.getExtensions())b.addExtension(t,v)}w.addMedia(b)}}return w.toString()},updateMissingVideoExtensions(c,e){var b;const d=ut.parse(c),C=(b=ut.parse(e).getMediasByType("video")[0])==null?void 0:b.getExtensions();if(!(!C&&!C.length)){for(const m of d.getMediasByType("video")){const t=m.getExtensions();C.forEach((v,y)=>{if(!t.get(y)){const h=m.getId(),n="a=extmap:"+y+" "+v+"\r\n",i=new RegExp("(a=mid:"+h+"\r\n(?:.*\r\n)*?)","g");c=c.replace(i,(o,s,r)=>s+n)}})}return c}},getCodecPayloadType(c){const e=/a=rtpmap:(\d+) (\w+)\/\d+/g,d=c.matchAll(e),w={};for(const C of d)w[C[1]]=C[2];return w}},Li=c=>c.getAudioTracks().some(e=>e.getSettings().channelCount>2),Se={VP8:"vp8",VP9:"vp9",H264:"h264",AV1:"av1",H265:"h265"},Ai={OPUS:"opus",MULTIOPUS:"multiopus"},Pi="d40e38ea-d419-4c62-94ed-20ac37b4e4fa",J=Oe.get("PeerConnection"),Gt={Publisher:"Publisher",Viewer:"Viewer"},Le={track:"track",connectionStateChange:"connectionStateChange"},qr={stereo:!1,mediaStream:null,codec:"h264",simulcast:!1,scalabilityMode:null,disableAudio:!1,disableVideo:!1,setSDPToPeer:!0};class je extends Ht{constructor(){super(),this.mode=null,this.sessionDescription=null,this.peer=null,this.peerConnectionStats=null}async createRTCPeer(e={autoInitStats:!0,statsIntervalMs:1e3},d=Gt.Viewer){J.info("Creating new RTCPeerConnection"),J.debug("RTC configuration provided by user: ",e),this.peer=Oi(this,e),this.mode=d,e.autoInitStats&&this.initStats(e)}getRTCPeer(){return J.info("Getting RTC Peer"),this.peer}async closeRTCPeer(){var e;J.info("Closing RTCPeerConnection"),(e=this.peer)==null||e.close(),this.peer=null,this.stopStats(),this.emit(Le.connectionStateChange,"closed")}async setRTCRemoteSDP(e){J.info("Setting RTC Remote SDP");const d={type:"answer",sdp:e};try{await this.peer.setRemoteDescription(d),J.info("RTC Remote SDP was set successfully."),J.debug("RTC Remote SDP new value: ",e)}catch(w){throw J.error("Error while setting RTC Remote SDP: ",w),w}}async getRTCLocalSDP(e=qr){J.info("Getting RTC Local SDP"),e=q(q({},qr),e),J.debug("Options: ",e);const d=Mi(e.mediaStream);d?Ni(this.peer,d,e):ji(this.peer,e),J.info("Creating peer offer");const w=await this.peer.createOffer();return J.info("Peer offer created"),J.debug("Peer offer response: ",w.sdp),this.sessionDescription=w,e.disableAudio||(e.stereo&&(this.sessionDescription.sdp=me.setStereo(this.sessionDescription.sdp)),e.dtx&&(this.sessionDescription.sdp=me.setDTX(this.sessionDescription.sdp)),this.sessionDescription.sdp=me.setMultiopus(this.sessionDescription.sdp,d)),!e.disableVideo&&e.simulcast&&(this.sessionDescription.sdp=me.setSimulcast(this.sessionDescription.sdp,e.codec)),e.absCaptureTime&&(this.sessionDescription.sdp=me.setAbsoluteCaptureTime(this.sessionDescription.sdp)),e.dependencyDescriptor&&(this.sessionDescription.sdp=me.setDependencyDescriptor(this.sessionDescription.sdp)),e.setSDPToPeer&&(await this.peer.setLocalDescription(this.sessionDescription),J.info("Peer local description set")),this.sessionDescription.sdp}async addRemoteTrack(e,d){try{let w=this.peer.addTransceiver(e,{direction:"recvonly",streams:d});return w=await ns(w,d),w}catch(w){throw J.error("Error while adding the remote track: ",w),w}}updateBandwidthRestriction(e,d){if(this.mode===Gt.Viewer)throw J.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");return J.info("Updating bandwidth restriction, bitrate value: ",d),J.debug("SDP value: ",e),me.setVideoBitrate(e,d)}async updateBitrate(e=0){if(this.mode===Gt.Viewer)throw J.error("Viewer attempting to update bitrate, this is not allowed"),new Error("It is not possible for a viewer to update the bitrate.");if(!this.peer)throw J.error("Cannot update bitrate. No peer found."),new Error("Cannot update bitrate. No peer found.");J.info("Updating bitrate to value: ",e),this.sessionDescription=await this.peer.createOffer(),await this.peer.setLocalDescription(this.sessionDescription);const d=this.updateBandwidthRestriction(this.peer.remoteDescription.sdp,e);await this.setRTCRemoteSDP(d),J.info("Bitrate restrictions updated: ","".concat(e>0?e:"unlimited"," kbps"))}getRTCPeerStatus(){if(J.info("Getting RTC peer status"),!this.peer)return null;const e=Di(this.peer);return J.info("RTC peer status getted, value: ",e),e}replaceTrack(e){if(!this.peer){J.error("Could not change track if there is not an active connection.");return}const d=this.peer.getSenders().find(w=>w.track.kind===e.kind);d?d.replaceTrack(e):J.error("There is no ".concat(e.kind," track in active broadcast."))}static getCapabilities(e){const d=new It,w=RTCRtpSender.getCapabilities(e);if(w){const C={};let b=new RegExp("^video/(".concat(Object.values(Se).join("|"),")x?$"),"i");e==="audio"&&(b=new RegExp("^audio/(".concat(Object.values(Ai).join("|"),")$"),"i"),d.isChrome()&&(C.multiopus={mimeType:"audio/multiopus",channels:6}));for(const m of w.codecs){const t=m.mimeType.match(b);if(t){const v=t[1].toLowerCase();if(C[v]=be(q({},C[v]),{mimeType:m.mimeType}),m.scalabilityModes){let y=C[v].scalabilityModes||[];y=[...y,...m.scalabilityModes],C[v].scalabilityModes=[...new Set(y)]}m.channels&&(C[v].channels=m.channels)}}w.codecs=Object.keys(C).map(m=>q({codec:m},C[m]))}return w}getTracks(){var e,d;return(d=(e=this.peer)==null?void 0:e.getSenders())==null?void 0:d.map(w=>w.track)}initStats(e){this.peerConnectionStats?J.warn("PeerConnection.initStats() has already been called. Automatic initialization occurs via View.connect(), Publish.connect() or this.createRTCPeer(). See options"):this.peer?(this.peerConnectionStats=new As(this.peer,e),ft(this.peerConnectionStats,this,[Rn.stats])):J.warn("Cannot init peer stats: RTCPeerConnection not initialized")}stopStats(){var e;(e=this.peerConnectionStats)==null||e.stop(),this.peerConnectionStats=null}}const en=c=>(c==null?void 0:c.getAudioTracks().length)<=1&&(c==null?void 0:c.getVideoTracks().length)<=1,Mi=c=>{if(!c)return null;if(c instanceof MediaStream&&en(c))return c;if(!(c instanceof MediaStream)){J.info("Creating MediaStream to add received tracks.");const e=new MediaStream;for(const d of c)e.addTrack(d);if(en(e))return e}throw J.error("MediaStream must have 1 audio track and 1 video track, or at least one of them."),new Error("MediaStream must have 1 audio track and 1 video track, or at least one of them.")},Oi=(c,e)=>{const d=new RTCPeerConnection(e);return $i(c,d),d},$i=(c,e)=>{e.ontrack=d=>{J.info("New track from peer."),J.debug("Track event value: ",d),c.emit(Le.track,d)},e.connectionState?e.onconnectionstatechange=d=>{J.info("Peer connection state change: ",e.connectionState),c.emit(Le.connectionStateChange,e.connectionState)}:e.oniceconnectionstatechange=d=>{J.info("Peer ICE connection state change: ",e.iceConnectionState),c.emit(Le.connectionStateChange,e.iceConnectionState)},e.onnegotiationneeded=async d=>{if(!e.remoteDescription)return;J.info("Peer onnegotiationneeded, updating local description");const w=await e.createOffer();J.info("Peer onnegotiationneeded, got local offer",w.sdp),w.sdp=me.updateMissingVideoExtensions(w.sdp,e.remoteDescription.sdp),await e.setLocalDescription(w);const C=me.renegotiate(w.sdp,e.remoteDescription.sdp);J.info("Peer onnegotiationneeded, updating remote description",C),await e.setRemoteDescription({type:"answer",sdp:C}),J.info("Peer onnegotiationneeded, renegotiation done")}},Ni=(c,e,d)=>{J.info("Adding mediaStream tracks to RTCPeerConnection");for(const w of e.getTracks()){const C={streams:[e]};w.kind==="audio"&&(C.direction=d.disableAudio?"inactive":"sendonly"),w.kind==="video"&&(C.direction=d.disableVideo?"inactive":"sendonly",d.scalabilityMode&&new It().isChrome()?(J.debug("Video track with scalability mode: ".concat(d.scalabilityMode,".")),C.sendEncodings=[{scalabilityMode:d.scalabilityMode}]):d.scalabilityMode&&J.warn("SVC is only supported in Google Chrome")),c.addTransceiver(w,C),J.info("Track '".concat(w.label,"' added: "),"id: ".concat(w.id),"kind: ".concat(w.kind))}},ji=(c,e)=>{const d=new It;if(!e.disableVideo){const w=c.addTransceiver("video",{direction:"recvonly"});d.isOpera()&&w.setCodecPreferences(RTCRtpReceiver.getCapabilities("video").codecs.filter(C=>C.mimeType!=="video/H264"||C.sdpFmtpLine.includes("profile-level-id=4")))}e.disableAudio||c.addTransceiver("audio",{direction:"recvonly"});for(let w=0;w<e.multiplexedAudioTracks;w++)c.addTransceiver("audio",{direction:"recvonly"})},ns=async(c,e,d=0)=>new Promise((w,C)=>{if(c.mid){for(const b of e)b.addTrack(c.receiver.track);w(c)}else d>=10?C(new Error("Error, maximum number of retries has been reached")):(d++,setTimeout(()=>{ns(c,e,d).then(w).catch(C)},50))}),Di=c=>{var d;const e=(d=c.connectionState)!=null?d:c.iceConnectionState;switch(e){case"checking":return"connecting";case"completed":return"connected";default:return e}};var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.TypedEmitter=wr.EventEmitter;const{TypedEmitter:ss}=Nr;class Fi extends ss{constructor(e,d){super(),this.namespace=e,this.tm=d}cmd(e,d){return this.tm.cmd(e,d,this.namespace)}event(e,d){return this.tm.event(e,d,this.namespace)}close(){return this.tm.namespaces.delete(this.namespace)}}class Vi extends ss{constructor(e){super(),this.maxId=0,this.namespaces=new Map,this.transactions=new Map,this.transport=e,this.listener=d=>{let w;try{w=JSON.parse(d.utf8Data||d.data||d)}catch(b){return}switch(w.type){case"cmd":const{transId:b}=w,m={name:w.name,data:w.data,namespace:w.namespace,accept:v=>{this._send({type:"response",transId:b,data:v})},reject:v=>{this._send({type:"error",transId:b,data:v})}};if(m.namespace){const v=this.namespaces.get(m.namespace);v?v.emit("cmd",m):this.emit("cmd",m)}else this.emit("cmd",m);break;case"response":{const v=this.transactions.get(w.transId);if(!v)return;this.transactions.delete(w.transId),v.resolve(w.data);break}case"error":{const v=this.transactions.get(w.transId);if(!v)return;this.transactions.delete(w.transId),v.reject(w.data);break}case"event":const t={name:w.name,data:w.data,namespace:w.namespace};if(t.namespace){var C=this.namespaces.get(t.namespace);C?C.emit("event",t):this.emit("event",t)}else this.emit("event",t);break}},this.transport.addListener?this.transport.addListener("message",this.listener):this.transport.addEventListener("message",this.listener)}_send(e){this.transport.send(JSON.stringify(e))}cmd(e,d,w=void 0){return new Promise((C,b)=>{if(!e||e.length===0)throw new Error("Bad command name");const m={type:"cmd",transId:this.maxId++,name:e,data:d};w&&(m.namespace=w),this.transactions.set(m.transId,be(q({},m),{resolve:C,reject:b}));try{this._send(m)}catch(t){throw this.transactions.delete(m.transId),t}})}event(e,d,w=void 0){if(!e||e.length===0)throw new Error("Bad event name");const C={type:"event",name:e,data:d};w&&(C.namespace=w),this._send(C)}namespace(e){let d=this.namespaces.get(e);return d||(d=new Fi(e,this),this.namespaces.set(e,d),d)}close(){for(const e of this.namespaces.values())e.close();this.transport.removeListener?this.transport.removeListener("message",this.listener):this.transport.removeEventListener("message",this.listener)}}var Zi=Vi;const Wi=st(Zi),ce=Oe.get("Signaling"),Ne={connectionSuccess:"wsConnectionSuccess",connectionError:"wsConnectionError",connectionClose:"wsConnectionClose",broadcastEvent:"broadcastEvent"};class jr extends Ht{constructor(e={streamName:null,url:"ws://localhost:8080/"}){super(),this.streamName=e.streamName,this.wsUrl=e.url,this.webSocket=null,this.transactionManager=null,this.serverId=null,this.clusterId=null,this.streamViewId=null}async connect(){var e;return ce.info("Connecting to Signaling Server"),this.transactionManager&&((e=this.webSocket)==null?void 0:e.readyState)===WebSocket.OPEN?(ce.info("Connected to server: ",this.webSocket.url),ce.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(Ne.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),this.webSocket):new Promise((d,w)=>{this.webSocket=new WebSocket(this.wsUrl),this.transactionManager=new Wi(this.webSocket),this.webSocket.onopen=()=>{ce.info("WebSocket opened"),this.transactionManager.on("event",C=>{this.emit(Ne.broadcastEvent,C)}),ce.info("Connected to server: ",this.webSocket.url),ce.debug("WebSocket value: ",{url:this.webSocket.url,protocol:this.webSocket.protocol,readyState:this.webSocket.readyState,binaryType:this.webSocket.binaryType,extensions:this.webSocket.extensions}),this.emit(Ne.connectionSuccess,{ws:this.webSocket,tm:this.transactionManager}),d(this.webSocket)},this.webSocket.onerror=()=>{ce.error("WebSocket not connected: ",this.webSocket.url),this.emit(Ne.connectionError,this.webSocket.url),w(this.webSocket.url)},this.webSocket.onclose=()=>{this.webSocket=null,this.transactionManager=null,ce.info("Connection closed with Signaling Server."),this.emit(Ne.connectionClose)}})}close(){var e;ce.info("Closing connection with Signaling Server."),(e=this.webSocket)==null||e.close()}async subscribe(e,d,w=null,C=null){var t,v,y,h;ce.info("Starting subscription to streamName: ",this.streamName),ce.debug("Subcription local description: ",e);const b=Ui(d,w,C);e=me.adaptCodecName(e,"AV1X",Se.AV1);const m={sdp:e,streamId:this.streamName,pinnedSourceId:b.pinnedSourceId,excludedSourceIds:b.excludedSourceIds};b.vad&&(m.vad=!0),Array.isArray(b.events)&&(m.events=b.events),b.forcePlayoutDelay&&(m.forcePlayoutDelay=b.forcePlayoutDelay),b.layer&&(m.layer=b.layer);try{await this.connect(),ce.info("Sending view command");const n=await this.transactionManager.cmd("view",m),i=(h=(y=(v=(t=RTCRtpReceiver.getCapabilities)==null?void 0:t.call(RTCRtpReceiver,"video"))==null?void 0:v.codecs)==null?void 0:y.find)==null?void 0:h.call(y,o=>o.mimeType==="video/AV1X");return n.sdp=i?me.adaptCodecName(n.sdp,Se.AV1,"AV1X"):n.sdp,ce.info("Command sent, subscriberId: ",n.subscriberId),ce.debug("Command result: ",n),this.serverId=n.subscriberId,this.clusterId=n.clusterId,this.streamViewId=n.streamViewId,ve.initStreamName(this.streamName),ve.initSubscriberId(this.serverId),ve.initStreamViewId(n.streamViewId),ve.setClusterId(this.clusterId),n.sdp}catch(n){throw ce.error("Error sending view command, error: ",n),n}}async publish(e,d,w=null,C=null){var y,h,n,i,o,s,r,l;const b=Gi(d,w,C);ce.info("Starting publishing to streamName: ".concat(this.streamName,", codec: ").concat(b.codec)),ce.debug("Publishing local description: ",e);const m=(i=(n=(h=(y=je.getCapabilities)==null?void 0:y.call(je,"video"))==null?void 0:h.codecs)==null?void 0:n.map(a=>a.codec))!=null?i:[],t=Object.values(Se);if(t.indexOf(b.codec)===-1)throw ce.error("Invalid codec ".concat(b.codec,". Possible values are: "),t),new Error("Invalid codec ".concat(b.codec,". Possible values are: ").concat(t));if(m.length>0&&m.indexOf(b.codec)===-1)throw ce.error("Unsupported codec ".concat(b.codec,". Possible values are: "),m),new Error("Unsupported codec ".concat(b.codec,". Possible values are: ").concat(m));b.codec===Se.AV1&&(e=me.adaptCodecName(e,"AV1X",Se.AV1));const v={name:this.streamName,sdp:e,codec:b.codec,sourceId:b.sourceId};if(b.priority)if(Number.isInteger(b.priority)&&b.priority>=-2147483648&&b.priority<=2147483647)v.priority=b.priority;else throw new Error("Invalid value for priority option. It should be a decimal integer between the range [-2^31, +2^31 - 1]");b.record!==null&&(v.record=b.record),Array.isArray(b.events)&&(v.events=b.events);try{await this.connect(),ce.info("Sending publish command");const a=await this.transactionManager.cmd("publish",v);if(b.codec===Se.AV1){const u=(l=(r=(s=(o=RTCRtpSender.getCapabilities)==null?void 0:o.call(RTCRtpSender,"video"))==null?void 0:s.codecs)==null?void 0:r.find)==null?void 0:l.call(r,f=>f.mimeType==="video/AV1X");a.sdp=u?me.adaptCodecName(a.sdp,Se.AV1,"AV1X"):a.sdp}return ce.info("Command sent, publisherId: ",a.publisherId),ce.debug("Command result: ",a),this.serverId=a.publisherId,this.clusterId=a.clusterId,ve.initStreamName(this.streamName),ve.initSubscriberId(this.serverId),ve.initFeedId(a.feedId),ve.setClusterId(this.clusterId),a.sdp}catch(a){throw ce.error("Error sending publish command, error: ",a),a}}async cmd(e,d){return ce.info("Sending cmd: ".concat(e)),this.transactionManager.cmd(e,d)}}const Ui=(c,e,d)=>{let w=typeof c=="object"?c:{};return Object.keys(w).length===0&&(w={vad:c,pinnedSourceId:e,excludedSourceIds:d}),w},Gi=(c,e,d)=>{let w=typeof c=="object"?c:{};if(Object.keys(w).length===0){const C=Se.H264;w={codec:c!=null?c:C,record:e,sourceId:d}}return w};class zt extends Error{constructor(e,d){super(e),this.name="FetchError",this.status=d}}const Ye=Oe.get("Director"),Bi={WEBRTC:"WebRtc",RTMP:"Rtmp"};let tn="";const Xi="https://director.millicast.com";let rn=Xi;const kt={setEndpoint:c=>{rn=c.replace(/\/$/,"")},getEndpoint:()=>rn,setLiveDomain:c=>{tn=c.replace(/\/$/,"")},getLiveDomain:()=>tn,getPublisher:async(c,e=null,d=Bi.WEBRTC)=>{const w=zi(c,e,d);Ye.info("Getting publisher connection path for stream name: ",w.streamName);const C={streamName:w.streamName,streamType:w.streamType},b={"Content-Type":"application/json",Authorization:"Bearer ".concat(w.token)},m="".concat(kt.getEndpoint(),"/api/director/publish");try{const t=await fetch(m,{method:"POST",headers:b,body:JSON.stringify(C)});let v=await t.json();if(v.status==="fail")throw new zt(v.data.message,t.status);return v=nn(v),Ye.debug("Getting publisher response: ",v),ve.initAccountId(v.data.streamAccountId),v.data}catch(t){throw Ye.error("Error while getting publisher connection path. ",t),t}},getSubscriber:async(c,e=null,d=null)=>{const w=Ki(c,e,d);ve.initAccountId(w.streamAccountId),Ye.info("Getting subscriber connection data for stream name: ".concat(w.streamName," and account id: ").concat(w.streamAccountId));const C={streamAccountId:w.streamAccountId,streamName:w.streamName};let b={"Content-Type":"application/json"};w.subscriberToken&&(b=be(q({},b),{Authorization:"Bearer ".concat(w.subscriberToken)}));const m="".concat(kt.getEndpoint(),"/api/director/subscribe");try{const t=await fetch(m,{method:"POST",headers:b,body:JSON.stringify(C)});let v=await t.json();if(v.status==="fail")throw new zt(v.data.message,t.status);return v=nn(v),Ye.debug("Getting subscriber response: ",v),v.data}catch(t){throw Ye.error("Error while getting subscriber connection path. ",t),t}}},zi=(c,e,d)=>{let w=typeof c=="object"?c:{};return Object.keys(w).length===0&&(w={token:c,streamName:e,streamType:d}),w},Ki=(c,e,d)=>{let w=typeof c=="object"?c:{};return Object.keys(w).length===0&&(w={streamName:c,streamAccountId:e,subscriberToken:d}),w},nn=c=>{if(kt.getLiveDomain()){const e=/\/\/(.*?)\//,d=c.data.urls.map(w=>{const C=e.exec(w);return w.replace(C[1],kt.getLiveDomain())});c.data.urls=d}return c};function gr(c){this.message=c}gr.prototype=new Error,gr.prototype.name="InvalidCharacterError";var sn=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(c){var e=String(c).replace(/=+$/,"");if(e.length%4==1)throw new gr("'atob' failed: The string to be decoded is not correctly encoded.");for(var d,w,C=0,b=0,m="";w=e.charAt(b++);~w&&(d=C%4?64*d+w:w,C++%4)?m+=String.fromCharCode(255&d>>(-2*C&6)):0)w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(w);return m};function Yi(c){var e=c.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(d){return decodeURIComponent(sn(d).replace(/(.)/g,function(w,C){var b=C.charCodeAt(0).toString(16).toUpperCase();return b.length<2&&(b="0"+b),"%"+b}))}(e)}catch(d){return sn(e)}}function Kt(c){this.message=c}function is(c,e){if(typeof c!="string")throw new Kt("Invalid token specified");var d=(e=e||{}).header===!0?0:1;try{return JSON.parse(Yi(c.split(".")[d]))}catch(w){throw new Kt("Invalid token specified: "+w.message)}}Kt.prototype=new Error,Kt.prototype.name="InvalidTokenError";var yr={exports:{}};(function(c,e){(function(d){if(e!=null&&typeof e.nodeType!="number")c.exports=d();else{var w=d(),C=typeof self<"u"?self:$.global;typeof C.btoa!="function"&&(C.btoa=w.btoa),typeof C.atob!="function"&&(C.atob=w.atob)}})(function(){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function w(m){this.message=m}w.prototype=new Error,w.prototype.name="InvalidCharacterError";function C(m){for(var t=String(m),v,y,h,n,i=0,o="";i<t.length;){if(v=t.charCodeAt(i++),y=t.charCodeAt(i++),h=t.charCodeAt(i++),v>255||y>255||h>255)throw new w("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=v<<16|y<<8|h,o+=d.charAt(n>>18&63)+d.charAt(n>>12&63)+d.charAt(n>>6&63)+d.charAt(n&63)}switch(t.length%3){case 0:return o;case 1:return o.slice(0,-2)+"==";case 2:return o.slice(0,-1)+"="}}function b(m){var t=String(m).replace(/[=]+$/,"");if(t.length%4===1)throw new w("'atob' failed: The string to be decoded is not correctly encoded.");for(var v=0,y,h,n=0,i="";h=t.charAt(n++);~h&&(y=v%4?y*64+h:h,v++%4)?i+=String.fromCharCode(255&y>>(-2*v&6)):0)h=d.indexOf(h);return i}return{btoa:C,atob:b}})})(yr,yr.exports);var Hi=yr.exports,os={exports:{}};(function(c,e){(function(d,w){c.exports=w()})(self,()=>{return d={7629:(C,b,m)=>{const t=m(375),v=m(8571),y=m(9474),h=m(1687),n=m(8652),i=m(8160),o=m(3292),s=m(6354),r=m(8901),l=m(9708),a=m(6914),u=m(2294),f=m(6133),p=m(1152),_=m(8863),k=m(2036),E={Base:class{constructor(g){this.type=g,this.$_root=null,this._definition={},this._reset()}_reset(){this._ids=new u.Ids,this._preferences=null,this._refs=new f.Manager,this._cache=null,this._valids=null,this._invalids=null,this._flags={},this._rules=[],this._singleRules=new Map,this.$_terms={},this.$_temp={ruleset:null,whens:{}}}describe(){return t(typeof l.describe=="function","Manifest functionality disabled"),l.describe(this)}allow(...g){return i.verifyFlat(g,"allow"),this._values(g,"_valids")}alter(g){t(g&&typeof g=="object"&&!Array.isArray(g),"Invalid targets argument"),t(!this._inRuleset(),"Cannot set alterations inside a ruleset");const R=this.clone();R.$_terms.alterations=R.$_terms.alterations||[];for(const I in g){const A=g[I];t(typeof A=="function","Alteration adjuster for",I,"must be a function"),R.$_terms.alterations.push({target:I,adjuster:A})}return R.$_temp.ruleset=!1,R}artifact(g){return t(g!==void 0,"Artifact cannot be undefined"),t(!this._cache,"Cannot set an artifact with a rule cache"),this.$_setFlag("artifact",g)}cast(g){return t(g===!1||typeof g=="string","Invalid to value"),t(g===!1||this._definition.cast[g],"Type",this.type,"does not support casting to",g),this.$_setFlag("cast",g===!1?void 0:g)}default(g,R){return this._default("default",g,R)}description(g){return t(g&&typeof g=="string","Description must be a non-empty string"),this.$_setFlag("description",g)}empty(g){const R=this.clone();return g!==void 0&&(g=R.$_compile(g,{override:!1})),R.$_setFlag("empty",g,{clone:!1})}error(g){return t(g,"Missing error"),t(g instanceof Error||typeof g=="function","Must provide a valid Error object or a function"),this.$_setFlag("error",g)}example(g,R={}){return t(g!==void 0,"Missing example"),i.assertOptions(R,["override"]),this._inner("examples",g,{single:!0,override:R.override})}external(g,R){return typeof g=="object"&&(t(!R,"Cannot combine options with description"),R=g.description,g=g.method),t(typeof g=="function","Method must be a function"),t(R===void 0||R&&typeof R=="string","Description must be a non-empty string"),this._inner("externals",{method:g,description:R},{single:!0})}failover(g,R){return this._default("failover",g,R)}forbidden(){return this.presence("forbidden")}id(g){return g?(t(typeof g=="string","id must be a non-empty string"),t(/^[^\.]+$/.test(g),"id cannot contain period character"),this.$_setFlag("id",g)):this.$_setFlag("id",void 0)}invalid(...g){return this._values(g,"_invalids")}label(g){return t(g&&typeof g=="string","Label name must be a non-empty string"),this.$_setFlag("label",g)}meta(g){return t(g!==void 0,"Meta cannot be undefined"),this._inner("metas",g,{single:!0})}note(...g){t(g.length,"Missing notes");for(const R of g)t(R&&typeof R=="string","Notes must be non-empty strings");return this._inner("notes",g)}only(g=!0){return t(typeof g=="boolean","Invalid mode:",g),this.$_setFlag("only",g)}optional(){return this.presence("optional")}prefs(g){t(g,"Missing preferences"),t(g.context===void 0,"Cannot override context"),t(g.externals===void 0,"Cannot override externals"),t(g.warnings===void 0,"Cannot override warnings"),t(g.debug===void 0,"Cannot override debug"),i.checkPreferences(g);const R=this.clone();return R._preferences=i.preferences(R._preferences,g),R}presence(g){return t(["optional","required","forbidden"].includes(g),"Unknown presence mode",g),this.$_setFlag("presence",g)}raw(g=!0){return this.$_setFlag("result",g?"raw":void 0)}result(g){return t(["raw","strip"].includes(g),"Unknown result mode",g),this.$_setFlag("result",g)}required(){return this.presence("required")}strict(g){const R=this.clone(),I=g!==void 0&&!g;return R._preferences=i.preferences(R._preferences,{convert:I}),R}strip(g=!0){return this.$_setFlag("result",g?"strip":void 0)}tag(...g){t(g.length,"Missing tags");for(const R of g)t(R&&typeof R=="string","Tags must be non-empty strings");return this._inner("tags",g)}unit(g){return t(g&&typeof g=="string","Unit name must be a non-empty string"),this.$_setFlag("unit",g)}valid(...g){i.verifyFlat(g,"valid");const R=this.allow(...g);return R.$_setFlag("only",!!R._valids,{clone:!1}),R}when(g,R){const I=this.clone();I.$_terms.whens||(I.$_terms.whens=[]);const A=o.when(I,g,R);if(!["any","link"].includes(I.type)){const O=A.is?[A]:A.switch;for(const N of O)t(!N.then||N.then.type==="any"||N.then.type===I.type,"Cannot combine",I.type,"with",N.then&&N.then.type),t(!N.otherwise||N.otherwise.type==="any"||N.otherwise.type===I.type,"Cannot combine",I.type,"with",N.otherwise&&N.otherwise.type)}return I.$_terms.whens.push(A),I.$_mutateRebuild()}cache(g){t(!this._inRuleset(),"Cannot set caching inside a ruleset"),t(!this._cache,"Cannot override schema cache"),t(this._flags.artifact===void 0,"Cannot cache a rule with an artifact");const R=this.clone();return R._cache=g||n.provider.provision(),R.$_temp.ruleset=!1,R}clone(){const g=Object.create(Object.getPrototypeOf(this));return this._assign(g)}concat(g){t(i.isSchema(g),"Invalid schema object"),t(this.type==="any"||g.type==="any"||g.type===this.type,"Cannot merge type",this.type,"with another type:",g.type),t(!this._inRuleset(),"Cannot concatenate onto a schema with open ruleset"),t(!g._inRuleset(),"Cannot concatenate a schema with open ruleset");let R=this.clone();if(this.type==="any"&&g.type!=="any"){const I=g.clone();for(const A of Object.keys(R))A!=="type"&&(I[A]=R[A]);R=I}R._ids.concat(g._ids),R._refs.register(g,f.toSibling),R._preferences=R._preferences?i.preferences(R._preferences,g._preferences):g._preferences,R._valids=k.merge(R._valids,g._valids,g._invalids),R._invalids=k.merge(R._invalids,g._invalids,g._valids);for(const I of g._singleRules.keys())R._singleRules.has(I)&&(R._rules=R._rules.filter(A=>A.keep||A.name!==I),R._singleRules.delete(I));for(const I of g._rules)g._definition.rules[I.method].multi||R._singleRules.set(I.name,I),R._rules.push(I);if(R._flags.empty&&g._flags.empty){R._flags.empty=R._flags.empty.concat(g._flags.empty);const I=Object.assign({},g._flags);delete I.empty,h(R._flags,I)}else if(g._flags.empty){R._flags.empty=g._flags.empty;const I=Object.assign({},g._flags);delete I.empty,h(R._flags,I)}else h(R._flags,g._flags);for(const I in g.$_terms){const A=g.$_terms[I];A?R.$_terms[I]?R.$_terms[I]=R.$_terms[I].concat(A):R.$_terms[I]=A.slice():R.$_terms[I]||(R.$_terms[I]=A)}return this.$_root._tracer&&this.$_root._tracer._combine(R,[this,g]),R.$_mutateRebuild()}extend(g){return t(!g.base,"Cannot extend type with another base"),r.type(this,g)}extract(g){return g=Array.isArray(g)?g:g.split("."),this._ids.reach(g)}fork(g,R){t(!this._inRuleset(),"Cannot fork inside a ruleset");let I=this;for(let A of[].concat(g))A=Array.isArray(A)?A:A.split("."),I=I._ids.fork(A,R,I);return I.$_temp.ruleset=!1,I}rule(g){const R=this._definition;i.assertOptions(g,Object.keys(R.modifiers)),t(this.$_temp.ruleset!==!1,"Cannot apply rules to empty ruleset or the last rule added does not support rule properties");const I=this.$_temp.ruleset===null?this._rules.length-1:this.$_temp.ruleset;t(I>=0&&I<this._rules.length,"Cannot apply rules to empty ruleset");const A=this.clone();for(let O=I;O<A._rules.length;++O){const N=A._rules[O],V=v(N);for(const B in g)R.modifiers[B](V,g[B]),t(V.name===N.name,"Cannot change rule name");A._rules[O]=V,A._singleRules.get(V.name)===N&&A._singleRules.set(V.name,V)}return A.$_temp.ruleset=!1,A.$_mutateRebuild()}get ruleset(){t(!this._inRuleset(),"Cannot start a new ruleset without closing the previous one");const g=this.clone();return g.$_temp.ruleset=g._rules.length,g}get $(){return this.ruleset}tailor(g){g=[].concat(g),t(!this._inRuleset(),"Cannot tailor inside a ruleset");let R=this;if(this.$_terms.alterations)for(const{target:I,adjuster:A}of this.$_terms.alterations)g.includes(I)&&(R=A(R),t(i.isSchema(R),"Alteration adjuster for",I,"failed to return a schema object"));return R=R.$_modify({each:I=>I.tailor(g),ref:!1}),R.$_temp.ruleset=!1,R.$_mutateRebuild()}tracer(){return p.location?p.location(this):this}validate(g,R){return _.entry(g,this,R)}validateAsync(g,R){return _.entryAsync(g,this,R)}$_addRule(g){typeof g=="string"&&(g={name:g}),t(g&&typeof g=="object","Invalid options"),t(g.name&&typeof g.name=="string","Invalid rule name");for(const N in g)t(N[0]!=="_","Cannot set private rule properties");const R=Object.assign({},g);R._resolve=[],R.method=R.method||R.name;const I=this._definition.rules[R.method],A=R.args;t(I,"Unknown rule",R.method);const O=this.clone();if(A){t(Object.keys(A).length===1||Object.keys(A).length===this._definition.rules[R.name].args.length,"Invalid rule definition for",this.type,R.name);for(const N in A){let V=A[N];if(I.argsByName){const B=I.argsByName.get(N);if(B.ref&&i.isResolvable(V))R._resolve.push(N),O.$_mutateRegister(V);else if(B.normalize&&(V=B.normalize(V),A[N]=V),B.assert){const Z=i.validateArg(V,N,B);t(!Z,Z,"or reference")}}V!==void 0?A[N]=V:delete A[N]}}return I.multi||(O._ruleRemove(R.name,{clone:!1}),O._singleRules.set(R.name,R)),O.$_temp.ruleset===!1&&(O.$_temp.ruleset=null),I.priority?O._rules.unshift(R):O._rules.push(R),O}$_compile(g,R){return o.schema(this.$_root,g,R)}$_createError(g,R,I,A,O,N={}){const V=N.flags!==!1?this._flags:{},B=N.messages?a.merge(this._definition.messages,N.messages):this._definition.messages;return new s.Report(g,R,I,V,B,A,O)}$_getFlag(g){return this._flags[g]}$_getRule(g){return this._singleRules.get(g)}$_mapLabels(g){return g=Array.isArray(g)?g:g.split("."),this._ids.labels(g)}$_match(g,R,I,A){(I=Object.assign({},I)).abortEarly=!0,I._externals=!1,R.snapshot();const O=!_.validate(g,this,R,I,A).errors;return R.restore(),O}$_modify(g){return i.assertOptions(g,["each","once","ref","schema"]),u.schema(this,g)||this}$_mutateRebuild(){return t(!this._inRuleset(),"Cannot add this rule inside a ruleset"),this._refs.reset(),this._ids.reset(),this.$_modify({each:(g,{source:R,name:I,path:A,key:O})=>{const N=this._definition[R][I]&&this._definition[R][I].register;N!==!1&&this.$_mutateRegister(g,{family:N,key:O})}}),this._definition.rebuild&&this._definition.rebuild(this),this.$_temp.ruleset=!1,this}$_mutateRegister(g,{family:R,key:I}={}){this._refs.register(g,R),this._ids.register(g,{key:I})}$_property(g){return this._definition.properties[g]}$_reach(g){return this._ids.reach(g)}$_rootReferences(){return this._refs.roots()}$_setFlag(g,R,I={}){t(g[0]==="_"||!this._inRuleset(),"Cannot set flag inside a ruleset");const A=this._definition.flags[g]||{};if(y(R,A.default)&&(R=void 0),y(R,this._flags[g]))return this;const O=I.clone!==!1?this.clone():this;return R!==void 0?(O._flags[g]=R,O.$_mutateRegister(R)):delete O._flags[g],g[0]!=="_"&&(O.$_temp.ruleset=!1),O}$_parent(g,...R){return this[g][i.symbols.parent].call(this,...R)}$_validate(g,R,I){return _.validate(g,this,R,I)}_assign(g){g.type=this.type,g.$_root=this.$_root,g.$_temp=Object.assign({},this.$_temp),g.$_temp.whens={},g._ids=this._ids.clone(),g._preferences=this._preferences,g._valids=this._valids&&this._valids.clone(),g._invalids=this._invalids&&this._invalids.clone(),g._rules=this._rules.slice(),g._singleRules=v(this._singleRules,{shallow:!0}),g._refs=this._refs.clone(),g._flags=Object.assign({},this._flags),g._cache=null,g.$_terms={};for(const R in this.$_terms)g.$_terms[R]=this.$_terms[R]?this.$_terms[R].slice():null;g.$_super={};for(const R in this.$_super)g.$_super[R]=this._super[R].bind(g);return g}_bare(){const g=this.clone();g._reset();const R=g._definition.terms;for(const I in R){const A=R[I];g.$_terms[I]=A.init}return g.$_mutateRebuild()}_default(g,R,I={}){return i.assertOptions(I,"literal"),t(R!==void 0,"Missing",g,"value"),t(typeof R=="function"||!I.literal,"Only function value supports literal option"),typeof R=="function"&&I.literal&&(R={[i.symbols.literal]:!0,literal:R}),this.$_setFlag(g,R)}_generate(g,R,I){if(!this.$_terms.whens)return{schema:this};const A=[],O=[];for(let B=0;B<this.$_terms.whens.length;++B){const Z=this.$_terms.whens[B];if(Z.concat){A.push(Z.concat),O.push("".concat(B,".concat"));continue}const M=Z.ref?Z.ref.resolve(g,R,I):g,F=Z.is?[Z]:Z.switch,X=O.length;for(let U=0;U<F.length;++U){const{is:W,then:K,otherwise:ee}=F[U],se="".concat(B).concat(Z.switch?"."+U:"");if(W.$_match(M,R.nest(W,"".concat(se,".is")),I)){if(K){const ie=R.localize([...R.path,"".concat(se,".then")],R.ancestors,R.schemas),{schema:le,id:ge}=K._generate(g,ie,I);A.push(le),O.push("".concat(se,".then").concat(ge?"(".concat(ge,")"):""));break}}else if(ee){const ie=R.localize([...R.path,"".concat(se,".otherwise")],R.ancestors,R.schemas),{schema:le,id:ge}=ee._generate(g,ie,I);A.push(le),O.push("".concat(se,".otherwise").concat(ge?"(".concat(ge,")"):""));break}}if(Z.break&&O.length>X)break}const N=O.join(", ");if(R.mainstay.tracer.debug(R,"rule","when",N),!N)return{schema:this};if(!R.mainstay.tracer.active&&this.$_temp.whens[N])return{schema:this.$_temp.whens[N],id:N};let V=this;this._definition.generate&&(V=this._definition.generate(this,g,R,I));for(const B of A)V=V.concat(B);return this.$_root._tracer&&this.$_root._tracer._combine(V,[this,...A]),this.$_temp.whens[N]=V,{schema:V,id:N}}_inner(g,R,I={}){t(!this._inRuleset(),"Cannot set ".concat(g," inside a ruleset"));const A=this.clone();return A.$_terms[g]&&!I.override||(A.$_terms[g]=[]),I.single?A.$_terms[g].push(R):A.$_terms[g].push(...R),A.$_temp.ruleset=!1,A}_inRuleset(){return this.$_temp.ruleset!==null&&this.$_temp.ruleset!==!1}_ruleRemove(g,R={}){if(!this._singleRules.has(g))return this;const I=R.clone!==!1?this.clone():this;I._singleRules.delete(g);const A=[];for(let O=0;O<I._rules.length;++O){const N=I._rules[O];N.name!==g||N.keep?A.push(N):I._inRuleset()&&O<I.$_temp.ruleset&&--I.$_temp.ruleset}return I._rules=A,I}_values(g,R){i.verifyFlat(g,R.slice(1,-1));const I=this.clone(),A=g[0]===i.symbols.override;if(A&&(g=g.slice(1)),!I[R]&&g.length?I[R]=new k:A&&(I[R]=g.length?new k:null,I.$_mutateRebuild()),!I[R])return I;A&&I[R].override();for(const O of g){t(O!==void 0,"Cannot call allow/valid/invalid with undefined"),t(O!==i.symbols.override,"Override must be the first value");const N=R==="_invalids"?"_valids":"_invalids";I[N]&&(I[N].remove(O),I[N].length||(t(R==="_valids"||!I._flags.only,"Setting invalid value",O,"leaves schema rejecting all values due to previous valid rule"),I[N]=null)),I[R].add(O,I._refs)}return I}}};E.Base.prototype[i.symbols.any]={version:i.version,compile:o.compile,root:"$_root"},E.Base.prototype.isImmutable=!0,E.Base.prototype.deny=E.Base.prototype.invalid,E.Base.prototype.disallow=E.Base.prototype.invalid,E.Base.prototype.equal=E.Base.prototype.valid,E.Base.prototype.exist=E.Base.prototype.required,E.Base.prototype.not=E.Base.prototype.invalid,E.Base.prototype.options=E.Base.prototype.prefs,E.Base.prototype.preferences=E.Base.prototype.prefs,C.exports=new E.Base},8652:(C,b,m)=>{const t=m(375),v=m(8571),y=m(8160),h={max:1e3,supported:new Set(["undefined","boolean","number","string"])};b.provider={provision:n=>new h.Cache(n)},h.Cache=class{constructor(n={}){y.assertOptions(n,["max"]),t(n.max===void 0||n.max&&n.max>0&&isFinite(n.max),"Invalid max cache size"),this._max=n.max||h.max,this._map=new Map,this._list=new h.List}get length(){return this._map.size}set(n,i){if(n!==null&&!h.supported.has(typeof n))return;let o=this._map.get(n);if(o)return o.value=i,void this._list.first(o);o=this._list.unshift({key:n,value:i}),this._map.set(n,o),this._compact()}get(n){const i=this._map.get(n);if(i)return this._list.first(i),v(i.value)}_compact(){if(this._map.size>this._max){const n=this._list.pop();this._map.delete(n.key)}}},h.List=class{constructor(){this.tail=null,this.head=null}unshift(n){return n.next=null,n.prev=this.head,this.head&&(this.head.next=n),this.head=n,this.tail||(this.tail=n),n}first(n){n!==this.head&&(this._remove(n),this.unshift(n))}pop(){return this._remove(this.tail)}_remove(n){const{next:i,prev:o}=n;return i.prev=o,o&&(o.next=i),n===this.tail&&(this.tail=i),n.prev=null,n.next=null,n}}},8160:(C,b,m)=>{const t=m(375),v=m(7916),y=m(5934);let h,n;const i={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};b.version=y.version,b.defaults={abortEarly:!0,allowUnknown:!1,artifacts:!1,cache:!0,context:null,convert:!0,dateFormat:"iso",errors:{escapeHtml:!1,label:"path",language:null,render:!0,stack:!1,wrap:{label:'"',array:"[]"}},externals:!0,messages:{},nonEnumerables:!1,noDefaults:!1,presence:"optional",skipFunctions:!1,stripUnknown:!1,warnings:!1},b.symbols={any:Symbol.for("@hapi/joi/schema"),arraySingle:Symbol("arraySingle"),deepDefault:Symbol("deepDefault"),errors:Symbol("errors"),literal:Symbol("literal"),override:Symbol("override"),parent:Symbol("parent"),prefs:Symbol("prefs"),ref:Symbol("ref"),template:Symbol("template"),values:Symbol("values")},b.assertOptions=function(o,s,r="Options"){t(o&&typeof o=="object"&&!Array.isArray(o),"Options must be of type object");const l=Object.keys(o).filter(a=>!s.includes(a));t(l.length===0,"".concat(r," contain unknown keys: ").concat(l))},b.checkPreferences=function(o){n=n||m(3378);const s=n.preferences.validate(o);if(s.error)throw new v([s.error.details[0].message])},b.compare=function(o,s,r){switch(r){case"=":return o===s;case">":return o>s;case"<":return o<s;case">=":return o>=s;case"<=":return o<=s}},b.default=function(o,s){return o===void 0?s:o},b.isIsoDate=function(o){return i.isoDate.test(o)},b.isNumber=function(o){return typeof o=="number"&&!isNaN(o)},b.isResolvable=function(o){return!!o&&(o[b.symbols.ref]||o[b.symbols.template])},b.isSchema=function(o,s={}){const r=o&&o[b.symbols.any];return!!r&&(t(s.legacy||r.version===b.version,"Cannot mix different versions of joi schemas"),!0)},b.isValues=function(o){return o[b.symbols.values]},b.limit=function(o){return Number.isSafeInteger(o)&&o>=0},b.preferences=function(o,s){h=h||m(6914),o=o||{},s=s||{};const r=Object.assign({},o,s);return s.errors&&o.errors&&(r.errors=Object.assign({},o.errors,s.errors),r.errors.wrap=Object.assign({},o.errors.wrap,s.errors.wrap)),s.messages&&(r.messages=h.compile(s.messages,o.messages)),delete r[b.symbols.prefs],r},b.tryWithPath=function(o,s,r={}){try{return o()}catch(l){throw l.path!==void 0?l.path=s+"."+l.path:l.path=s,r.append&&(l.message="".concat(l.message," (").concat(l.path,")")),l}},b.validateArg=function(o,s,{assert:r,message:l}){if(b.isSchema(r)){const a=r.validate(o);return a.error?a.error.message:void 0}if(!r(o))return s?"".concat(s," ").concat(l):l},b.verifyFlat=function(o,s){for(const r of o)t(!Array.isArray(r),"Method no longer accepts array arguments:",s)}},3292:(C,b,m)=>{const t=m(375),v=m(8160),y=m(6133),h={};b.schema=function(n,i,o={}){v.assertOptions(o,["appendPath","override"]);try{return h.schema(n,i,o)}catch(s){throw o.appendPath&&s.path!==void 0&&(s.message="".concat(s.message," (").concat(s.path,")")),s}},h.schema=function(n,i,o){t(i!==void 0,"Invalid undefined schema"),Array.isArray(i)&&(t(i.length,"Invalid empty array schema"),i.length===1&&(i=i[0]));const s=(r,...l)=>o.override!==!1?r.valid(n.override,...l):r.valid(...l);if(h.simple(i))return s(n,i);if(typeof i=="function")return n.custom(i);if(t(typeof i=="object","Invalid schema content:",typeof i),v.isResolvable(i))return s(n,i);if(v.isSchema(i))return i;if(Array.isArray(i)){for(const r of i)if(!h.simple(r))return n.alternatives().try(...i);return s(n,...i)}return i instanceof RegExp?n.string().regex(i):i instanceof Date?s(n.date(),i):(t(Object.getPrototypeOf(i)===Object.getPrototypeOf({}),"Schema can only contain plain objects"),n.object().keys(i))},b.ref=function(n,i){return y.isRef(n)?n:y.create(n,i)},b.compile=function(n,i,o={}){v.assertOptions(o,["legacy"]);const s=i&&i[v.symbols.any];if(s)return t(o.legacy||s.version===v.version,"Cannot mix different versions of joi schemas:",s.version,v.version),i;if(typeof i!="object"||!o.legacy)return b.schema(n,i,{appendPath:!0});const r=h.walk(i);return r?r.compile(r.root,i):b.schema(n,i,{appendPath:!0})},h.walk=function(n){if(typeof n!="object")return null;if(Array.isArray(n)){for(const o of n){const s=h.walk(o);if(s)return s}return null}const i=n[v.symbols.any];if(i)return{root:n[i.root],compile:i.compile};t(Object.getPrototypeOf(n)===Object.getPrototypeOf({}),"Schema can only contain plain objects");for(const o in n){const s=h.walk(n[o]);if(s)return s}return null},h.simple=function(n){return n===null||["boolean","string","number"].includes(typeof n)},b.when=function(n,i,o){if(o===void 0&&(t(i&&typeof i=="object","Missing options"),o=i,i=y.create(".")),Array.isArray(o)&&(o={switch:o}),v.assertOptions(o,["is","not","then","otherwise","switch","break"]),v.isSchema(i))return t(o.is===void 0,'"is" can not be used with a schema condition'),t(o.not===void 0,'"not" can not be used with a schema condition'),t(o.switch===void 0,'"switch" can not be used with a schema condition'),h.condition(n,{is:i,then:o.then,otherwise:o.otherwise,break:o.break});if(t(y.isRef(i)||typeof i=="string","Invalid condition:",i),t(o.not===void 0||o.is===void 0,'Cannot combine "is" with "not"'),o.switch===void 0){let r=o;o.not!==void 0&&(r={is:o.not,then:o.otherwise,otherwise:o.then,break:o.break});let l=r.is!==void 0?n.$_compile(r.is):n.$_root.invalid(null,!1,0,"").required();return t(r.then!==void 0||r.otherwise!==void 0,'options must have at least one of "then", "otherwise", or "switch"'),t(r.break===void 0||r.then===void 0||r.otherwise===void 0,"Cannot specify then, otherwise, and break all together"),o.is===void 0||y.isRef(o.is)||v.isSchema(o.is)||(l=l.required()),h.condition(n,{ref:b.ref(i),is:l,then:r.then,otherwise:r.otherwise,break:r.break})}t(Array.isArray(o.switch),'"switch" must be an array'),t(o.is===void 0,'Cannot combine "switch" with "is"'),t(o.not===void 0,'Cannot combine "switch" with "not"'),t(o.then===void 0,'Cannot combine "switch" with "then"');const s={ref:b.ref(i),switch:[],break:o.break};for(let r=0;r<o.switch.length;++r){const l=o.switch[r],a=r===o.switch.length-1;v.assertOptions(l,a?["is","then","otherwise"]:["is","then"]),t(l.is!==void 0,'Switch statement missing "is"'),t(l.then!==void 0,'Switch statement missing "then"');const u={is:n.$_compile(l.is),then:n.$_compile(l.then)};if(y.isRef(l.is)||v.isSchema(l.is)||(u.is=u.is.required()),a){t(o.otherwise===void 0||l.otherwise===void 0,'Cannot specify "otherwise" inside and outside a "switch"');const f=o.otherwise!==void 0?o.otherwise:l.otherwise;f!==void 0&&(t(s.break===void 0,"Cannot specify both otherwise and break"),u.otherwise=n.$_compile(f))}s.switch.push(u)}return s},h.condition=function(n,i){for(const o of["then","otherwise"])i[o]===void 0?delete i[o]:i[o]=n.$_compile(i[o]);return i}},6354:(C,b,m)=>{const t=m(5688),v=m(8160),y=m(3328);b.Report=class{constructor(h,n,i,o,s,r,l){if(this.code=h,this.flags=o,this.messages=s,this.path=r.path,this.prefs=l,this.state=r,this.value=n,this.message=null,this.template=null,this.local=i||{},this.local.label=b.label(this.flags,this.state,this.prefs,this.messages),this.value===void 0||this.local.hasOwnProperty("value")||(this.local.value=this.value),this.path.length){const a=this.path[this.path.length-1];typeof a!="object"&&(this.local.key=a)}}_setTemplate(h){if(this.template=h,!this.flags.label&&this.path.length===0){const n=this._template(this.template,"root");n&&(this.local.label=n)}}toString(){if(this.message)return this.message;const h=this.code;if(!this.prefs.errors.render)return this.code;const n=this._template(this.template)||this._template(this.prefs.messages)||this._template(this.messages);return n===void 0?'Error code "'.concat(h,'" is not defined, your custom type is missing the correct messages definition'):(this.message=n.render(this.value,this.state,this.prefs,this.local,{errors:this.prefs.errors,messages:[this.prefs.messages,this.messages]}),this.prefs.errors.label||(this.message=this.message.replace(/^"" /,"").trim()),this.message)}_template(h,n){return b.template(this.value,h,n||this.code,this.state,this.prefs)}},b.path=function(h){let n="";for(const i of h)typeof i!="object"&&(typeof i=="string"?(n&&(n+="."),n+=i):n+="[".concat(i,"]"));return n},b.template=function(h,n,i,o,s){if(!n)return;if(y.isTemplate(n))return i!=="root"?n:null;let r=s.errors.language;if(v.isResolvable(r)&&(r=r.resolve(h,o,s)),r&&n[r]){if(n[r][i]!==void 0)return n[r][i];if(n[r]["*"]!==void 0)return n[r]["*"]}return n[i]?n[i]:n["*"]},b.label=function(h,n,i,o){if(h.label)return h.label;if(!i.errors.label)return"";let s=n.path;return i.errors.label==="key"&&n.path.length>1&&(s=n.path.slice(-1)),b.path(s)||b.template(null,i.messages,"root",n,i)||o&&b.template(null,o,"root",n,i)||"value"},b.process=function(h,n,i){if(!h)return null;const{override:o,message:s,details:r}=b.details(h);if(o)return o;if(i.errors.stack)return new b.ValidationError(s,r,n);const l=Error.stackTraceLimit;Error.stackTraceLimit=0;const a=new b.ValidationError(s,r,n);return Error.stackTraceLimit=l,a},b.details=function(h,n={}){let i=[];const o=[];for(const s of h){if(s instanceof Error){if(n.override!==!1)return{override:s};const l=s.toString();i.push(l),o.push({message:l,type:"override",context:{error:s}});continue}const r=s.toString();i.push(r),o.push({message:r,path:s.path.filter(l=>typeof l!="object"),type:s.code,context:s.local})}return i.length>1&&(i=[...new Set(i)]),{message:i.join(". "),details:o}},b.ValidationError=class extends Error{constructor(h,n,i){super(h),this._original=i,this.details=n}static isError(h){return h instanceof b.ValidationError}},b.ValidationError.prototype.isJoi=!0,b.ValidationError.prototype.name="ValidationError",b.ValidationError.prototype.annotate=t.error},8901:(C,b,m)=>{const t=m(375),v=m(8571),y=m(8160),h=m(6914),n={};b.type=function(i,o){const s=Object.getPrototypeOf(i),r=v(s),l=i._assign(Object.create(r)),a=Object.assign({},o);delete a.base,r._definition=a;const u=s._definition||{};a.messages=h.merge(u.messages,a.messages),a.properties=Object.assign({},u.properties,a.properties),l.type=a.type,a.flags=Object.assign({},u.flags,a.flags);const f=Object.assign({},u.terms);if(a.terms)for(const E in a.terms){const g=a.terms[E];t(l.$_terms[E]===void 0,"Invalid term override for",a.type,E),l.$_terms[E]=g.init,f[E]=g}a.terms=f,a.args||(a.args=u.args),a.prepare=n.prepare(a.prepare,u.prepare),a.coerce&&(typeof a.coerce=="function"&&(a.coerce={method:a.coerce}),a.coerce.from&&!Array.isArray(a.coerce.from)&&(a.coerce={method:a.coerce.method,from:[].concat(a.coerce.from)})),a.coerce=n.coerce(a.coerce,u.coerce),a.validate=n.validate(a.validate,u.validate);const p=Object.assign({},u.rules);if(a.rules)for(const E in a.rules){const g=a.rules[E];t(typeof g=="object","Invalid rule definition for",a.type,E);let R=g.method;if(R===void 0&&(R=function(){return this.$_addRule(E)}),R&&(t(!r[E],"Rule conflict in",a.type,E),r[E]=R),t(!p[E],"Rule conflict in",a.type,E),p[E]=g,g.alias){const I=[].concat(g.alias);for(const A of I)r[A]=g.method}g.args&&(g.argsByName=new Map,g.args=g.args.map(I=>(typeof I=="string"&&(I={name:I}),t(!g.argsByName.has(I.name),"Duplicated argument name",I.name),y.isSchema(I.assert)&&(I.assert=I.assert.strict().label(I.name)),g.argsByName.set(I.name,I),I)))}a.rules=p;const _=Object.assign({},u.modifiers);if(a.modifiers)for(const E in a.modifiers){t(!r[E],"Rule conflict in",a.type,E);const g=a.modifiers[E];t(typeof g=="function","Invalid modifier definition for",a.type,E);const R=function(I){return this.rule({[E]:I})};r[E]=R,_[E]=g}if(a.modifiers=_,a.overrides){r._super=s,l.$_super={};for(const E in a.overrides)t(s[E],"Cannot override missing",E),a.overrides[E][y.symbols.parent]=s[E],l.$_super[E]=s[E].bind(l);Object.assign(r,a.overrides)}a.cast=Object.assign({},u.cast,a.cast);const k=Object.assign({},u.manifest,a.manifest);return k.build=n.build(a.manifest&&a.manifest.build,u.manifest&&u.manifest.build),a.manifest=k,a.rebuild=n.rebuild(a.rebuild,u.rebuild),l},n.build=function(i,o){return i&&o?function(s,r){return o(i(s,r),r)}:i||o},n.coerce=function(i,o){return i&&o?{from:i.from&&o.from?[...new Set([...i.from,...o.from])]:null,method(s,r){let l;if((!o.from||o.from.includes(typeof s))&&(l=o.method(s,r),l)){if(l.errors||l.value===void 0)return l;s=l.value}if(!i.from||i.from.includes(typeof s)){const a=i.method(s,r);if(a)return a}return l}}:i||o},n.prepare=function(i,o){return i&&o?function(s,r){const l=i(s,r);if(l){if(l.errors||l.value===void 0)return l;s=l.value}return o(s,r)||l}:i||o},n.rebuild=function(i,o){return i&&o?function(s){o(s),i(s)}:i||o},n.validate=function(i,o){return i&&o?function(s,r){const l=o(s,r);if(l){if(l.errors&&(!Array.isArray(l.errors)||l.errors.length))return l;s=l.value}return i(s,r)||l}:i||o}},5107:(C,b,m)=>{const t=m(375),v=m(8571),y=m(8652),h=m(8160),n=m(3292),i=m(6354),o=m(8901),s=m(9708),r=m(6133),l=m(3328),a=m(1152);let u;const f={types:{alternatives:m(4946),any:m(8068),array:m(546),boolean:m(4937),date:m(7500),function:m(390),link:m(8785),number:m(3832),object:m(8966),string:m(7417),symbol:m(8826)},aliases:{alt:"alternatives",bool:"boolean",func:"function"},root:function(){const p={_types:new Set(Object.keys(f.types))};for(const _ of p._types)p[_]=function(...k){return t(!k.length||["alternatives","link","object"].includes(_),"The",_,"type does not allow arguments"),f.generate(this,f.types[_],k)};for(const _ of["allow","custom","disallow","equal","exist","forbidden","invalid","not","only","optional","options","prefs","preferences","required","strip","valid","when"])p[_]=function(...k){return this.any()[_](...k)};Object.assign(p,f.methods);for(const _ in f.aliases){const k=f.aliases[_];p[_]=p[k]}return p.x=p.expression,a.setup&&a.setup(p),p}};f.methods={ValidationError:i.ValidationError,version:h.version,cache:y.provider,assert(p,_,...k){f.assert(p,_,!0,k)},attempt:(p,_,...k)=>f.assert(p,_,!1,k),build(p){return t(typeof s.build=="function","Manifest functionality disabled"),s.build(this,p)},checkPreferences(p){h.checkPreferences(p)},compile(p,_){return n.compile(this,p,_)},defaults(p){t(typeof p=="function","modifier must be a function");const _=Object.assign({},this);for(const k of _._types){const E=p(_[k]());t(h.isSchema(E),"modifier must return a valid schema object"),_[k]=function(...g){return f.generate(this,E,g)}}return _},expression:(...p)=>new l(...p),extend(...p){h.verifyFlat(p,"extend"),u=u||m(3378),t(p.length,"You need to provide at least one extension"),this.assert(p,u.extensions);const _=Object.assign({},this);_._types=new Set(_._types);for(let k of p){typeof k=="function"&&(k=k(_)),this.assert(k,u.extension);const E=f.expandExtension(k,_);for(const g of E){t(_[g.type]===void 0||_._types.has(g.type),"Cannot override name",g.type);const R=g.base||this.any(),I=o.type(R,g);_._types.add(g.type),_[g.type]=function(...A){return f.generate(this,I,A)}}}return _},isError:i.ValidationError.isError,isExpression:l.isTemplate,isRef:r.isRef,isSchema:h.isSchema,in:(...p)=>r.in(...p),override:h.symbols.override,ref:(...p)=>r.create(...p),types(){const p={};for(const _ of this._types)p[_]=this[_]();for(const _ in f.aliases)p[_]=this[_]();return p}},f.assert=function(p,_,k,E){const g=E[0]instanceof Error||typeof E[0]=="string"?E[0]:null,R=g!==null?E[1]:E[0],I=_.validate(p,h.preferences({errors:{stack:!0}},R||{}));let A=I.error;if(!A)return I.value;if(g instanceof Error)throw g;const O=k&&typeof A.annotate=="function"?A.annotate():A.message;throw A instanceof i.ValidationError==0&&(A=v(A)),A.message=g?"".concat(g," ").concat(O):O,A},f.generate=function(p,_,k){return t(p,"Must be invoked on a Joi instance."),_.$_root=p,_._definition.args&&k.length?_._definition.args(_,...k):_},f.expandExtension=function(p,_){if(typeof p.type=="string")return[p];const k=[];for(const E of _._types)if(p.type.test(E)){const g=Object.assign({},p);g.type=E,g.base=_[E](),k.push(g)}return k},C.exports=f.root()},6914:(C,b,m)=>{const t=m(375),v=m(8571),y=m(3328);b.compile=function(h,n){if(typeof h=="string")return t(!n,"Cannot set single message string"),new y(h);if(y.isTemplate(h))return t(!n,"Cannot set single message template"),h;t(typeof h=="object"&&!Array.isArray(h),"Invalid message options"),n=n?v(n):{};for(let i in h){const o=h[i];if(i==="root"||y.isTemplate(o)){n[i]=o;continue}if(typeof o=="string"){n[i]=new y(o);continue}t(typeof o=="object"&&!Array.isArray(o),"Invalid message for",i);const s=i;for(i in n[s]=n[s]||{},o){const r=o[i];i==="root"||y.isTemplate(r)?n[s][i]=r:(t(typeof r=="string","Invalid message for",i,"in",s),n[s][i]=new y(r))}}return n},b.decompile=function(h){const n={};for(let i in h){const o=h[i];if(i==="root"){n.root=o;continue}if(y.isTemplate(o)){n[i]=o.describe({compact:!0});continue}const s=i;for(i in n[s]={},o){const r=o[i];i!=="root"?n[s][i]=r.describe({compact:!0}):n[s].root=r}}return n},b.merge=function(h,n){if(!h)return b.compile(n);if(!n)return h;if(typeof n=="string")return new y(n);if(y.isTemplate(n))return n;const i=v(h);for(let o in n){const s=n[o];if(o==="root"||y.isTemplate(s)){i[o]=s;continue}if(typeof s=="string"){i[o]=new y(s);continue}t(typeof s=="object"&&!Array.isArray(s),"Invalid message for",o);const r=o;for(o in i[r]=i[r]||{},s){const l=s[o];o==="root"||y.isTemplate(l)?i[r][o]=l:(t(typeof l=="string","Invalid message for",o,"in",r),i[r][o]=new y(l))}}return i}},2294:(C,b,m)=>{const t=m(375),v=m(8160),y=m(6133),h={};b.Ids=h.Ids=class{constructor(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}clone(){const n=new h.Ids;return n._byId=new Map(this._byId),n._byKey=new Map(this._byKey),n._schemaChain=this._schemaChain,n}concat(n){n._schemaChain&&(this._schemaChain=!0);for(const[i,o]of n._byId.entries())t(!this._byKey.has(i),"Schema id conflicts with existing key:",i),this._byId.set(i,o);for(const[i,o]of n._byKey.entries())t(!this._byId.has(i),"Schema key conflicts with existing id:",i),this._byKey.set(i,o)}fork(n,i,o){const s=this._collect(n);s.push({schema:o});const r=s.shift();let l={id:r.id,schema:i(r.schema)};t(v.isSchema(l.schema),"adjuster function failed to return a joi schema type");for(const a of s)l={id:a.id,schema:h.fork(a.schema,l.id,l.schema)};return l.schema}labels(n,i=[]){const o=n[0],s=this._get(o);if(!s)return[...i,...n].join(".");const r=n.slice(1);return i=[...i,s.schema._flags.label||o],r.length?s.schema._ids.labels(r,i):i.join(".")}reach(n,i=[]){const o=n[0],s=this._get(o);t(s,"Schema does not contain path",[...i,...n].join("."));const r=n.slice(1);return r.length?s.schema._ids.reach(r,[...i,o]):s.schema}register(n,{key:i}={}){if(!n||!v.isSchema(n))return;(n.$_property("schemaChain")||n._ids._schemaChain)&&(this._schemaChain=!0);const o=n._flags.id;if(o){const s=this._byId.get(o);t(!s||s.schema===n,"Cannot add different schemas with the same id:",o),t(!this._byKey.has(o),"Schema id conflicts with existing key:",o),this._byId.set(o,{schema:n,id:o})}i&&(t(!this._byKey.has(i),"Schema already contains key:",i),t(!this._byId.has(i),"Schema key conflicts with existing id:",i),this._byKey.set(i,{schema:n,id:i}))}reset(){this._byId=new Map,this._byKey=new Map,this._schemaChain=!1}_collect(n,i=[],o=[]){const s=n[0],r=this._get(s);t(r,"Schema does not contain path",[...i,...n].join(".")),o=[r,...o];const l=n.slice(1);return l.length?r.schema._ids._collect(l,[...i,s],o):o}_get(n){return this._byId.get(n)||this._byKey.get(n)}},h.fork=function(n,i,o){const s=b.schema(n,{each:(r,{key:l})=>{if(i===(r._flags.id||l))return o},ref:!1});return s?s.$_mutateRebuild():n},b.schema=function(n,i){let o;for(const s in n._flags){if(s[0]==="_")continue;const r=h.scan(n._flags[s],{source:"flags",name:s},i);r!==void 0&&(o=o||n.clone(),o._flags[s]=r)}for(let s=0;s<n._rules.length;++s){const r=n._rules[s],l=h.scan(r.args,{source:"rules",name:r.name},i);if(l!==void 0){o=o||n.clone();const a=Object.assign({},r);a.args=l,o._rules[s]=a,o._singleRules.get(r.name)===r&&o._singleRules.set(r.name,a)}}for(const s in n.$_terms){if(s[0]==="_")continue;const r=h.scan(n.$_terms[s],{source:"terms",name:s},i);r!==void 0&&(o=o||n.clone(),o.$_terms[s]=r)}return o},h.scan=function(n,i,o,s,r){const l=s||[];if(n===null||typeof n!="object")return;let a;if(Array.isArray(n)){for(let u=0;u<n.length;++u){const f=i.source==="terms"&&i.name==="keys"&&n[u].key,p=h.scan(n[u],i,o,[u,...l],f);p!==void 0&&(a=a||n.slice(),a[u]=p)}return a}if(o.schema!==!1&&v.isSchema(n)||o.ref!==!1&&y.isRef(n)){const u=o.each(n,be(q({},i),{path:l,key:r}));return u===n?void 0:u}for(const u in n){if(u[0]==="_")continue;const f=h.scan(n[u],i,o,[u,...l],r);f!==void 0&&(a=a||Object.assign({},n),a[u]=f)}return a}},6133:(C,b,m)=>{const t=m(375),v=m(8571),y=m(9621),h=m(8160);let n;const i={symbol:Symbol("ref"),defaults:{adjust:null,in:!1,iterables:null,map:null,separator:".",type:"value"}};b.create=function(o,s={}){t(typeof o=="string","Invalid reference key:",o),h.assertOptions(s,["adjust","ancestor","in","iterables","map","prefix","render","separator"]),t(!s.prefix||typeof s.prefix=="object","options.prefix must be of type object");const r=Object.assign({},i.defaults,s);delete r.prefix;const l=r.separator,a=i.context(o,l,s.prefix);if(r.type=a.type,o=a.key,r.type==="value")if(a.root&&(t(!l||o[0]!==l,"Cannot specify relative path with root prefix"),r.ancestor="root",o||(o=null)),l&&l===o)o=null,r.ancestor=0;else if(r.ancestor!==void 0)t(!l||!o||o[0]!==l,"Cannot combine prefix with ancestor option");else{const[u,f]=i.ancestor(o,l);f&&(o=o.slice(f))===""&&(o=null),r.ancestor=u}return r.path=l?o===null?[]:o.split(l):[o],new i.Ref(r)},b.in=function(o,s={}){return b.create(o,be(q({},s),{in:!0}))},b.isRef=function(o){return!!o&&!!o[h.symbols.ref]},i.Ref=class{constructor(o){t(typeof o=="object","Invalid reference construction"),h.assertOptions(o,["adjust","ancestor","in","iterables","map","path","render","separator","type","depth","key","root","display"]),t([!1,void 0].includes(o.separator)||typeof o.separator=="string"&&o.separator.length===1,"Invalid separator"),t(!o.adjust||typeof o.adjust=="function","options.adjust must be a function"),t(!o.map||Array.isArray(o.map),"options.map must be an array"),t(!o.map||!o.adjust,"Cannot set both map and adjust options"),Object.assign(this,i.defaults,o),t(this.type==="value"||this.ancestor===void 0,"Non-value references cannot reference ancestors"),Array.isArray(this.map)&&(this.map=new Map(this.map)),this.depth=this.path.length,this.key=this.path.length?this.path.join(this.separator):null,this.root=this.path[0],this.updateDisplay()}resolve(o,s,r,l,a={}){return t(!this.in||a.in,"Invalid in() reference usage"),this.type==="global"?this._resolve(r.context,s,a):this.type==="local"?this._resolve(l,s,a):this.ancestor?this.ancestor==="root"?this._resolve(s.ancestors[s.ancestors.length-1],s,a):(t(this.ancestor<=s.ancestors.length,"Invalid reference exceeds the schema root:",this.display),this._resolve(s.ancestors[this.ancestor-1],s,a)):this._resolve(o,s,a)}_resolve(o,s,r){let l;if(this.type==="value"&&s.mainstay.shadow&&r.shadow!==!1&&(l=s.mainstay.shadow.get(this.absolute(s))),l===void 0&&(l=y(o,this.path,{iterables:this.iterables,functions:!0})),this.adjust&&(l=this.adjust(l)),this.map){const a=this.map.get(l);a!==void 0&&(l=a)}return s.mainstay&&s.mainstay.tracer.resolve(s,this,l),l}toString(){return this.display}absolute(o){return[...o.path.slice(0,-this.ancestor),...this.path]}clone(){return new i.Ref(this)}describe(){const o={path:this.path};this.type!=="value"&&(o.type=this.type),this.separator!=="."&&(o.separator=this.separator),this.type==="value"&&this.ancestor!==1&&(o.ancestor=this.ancestor),this.map&&(o.map=[...this.map]);for(const s of["adjust","iterables","render"])this[s]!==null&&this[s]!==void 0&&(o[s]=this[s]);return this.in!==!1&&(o.in=!0),{ref:o}}updateDisplay(){const o=this.key!==null?this.key:"";if(this.type!=="value")return void(this.display="ref:".concat(this.type,":").concat(o));if(!this.separator)return void(this.display="ref:".concat(o));if(!this.ancestor)return void(this.display="ref:".concat(this.separator).concat(o));if(this.ancestor==="root")return void(this.display="ref:root:".concat(o));if(this.ancestor===1)return void(this.display="ref:".concat(o||".."));const s=new Array(this.ancestor+1).fill(this.separator).join("");this.display="ref:".concat(s).concat(o||"")}},i.Ref.prototype[h.symbols.ref]=!0,b.build=function(o){return(o=Object.assign({},i.defaults,o)).type==="value"&&o.ancestor===void 0&&(o.ancestor=1),new i.Ref(o)},i.context=function(o,s,r={}){if(o=o.trim(),r){const l=r.global===void 0?"$":r.global;if(l!==s&&o.startsWith(l))return{key:o.slice(l.length),type:"global"};const a=r.local===void 0?"#":r.local;if(a!==s&&o.startsWith(a))return{key:o.slice(a.length),type:"local"};const u=r.root===void 0?"/":r.root;if(u!==s&&o.startsWith(u))return{key:o.slice(u.length),type:"value",root:!0}}return{key:o,type:"value"}},i.ancestor=function(o,s){if(!s)return[1,0];if(o[0]!==s)return[1,0];if(o[1]!==s)return[0,1];let r=2;for(;o[r]===s;)++r;return[r-1,r]},b.toSibling=0,b.toParent=1,b.Manager=class{constructor(){this.refs=[]}register(o,s){if(o)if(s=s===void 0?b.toParent:s,Array.isArray(o))for(const r of o)this.register(r,s);else if(h.isSchema(o))for(const r of o._refs.refs)r.ancestor-s>=0&&this.refs.push({ancestor:r.ancestor-s,root:r.root});else b.isRef(o)&&o.type==="value"&&o.ancestor-s>=0&&this.refs.push({ancestor:o.ancestor-s,root:o.root}),n=n||m(3328),n.isTemplate(o)&&this.register(o.refs(),s)}get length(){return this.refs.length}clone(){const o=new b.Manager;return o.refs=v(this.refs),o}reset(){this.refs=[]}roots(){return this.refs.filter(o=>!o.ancestor).map(o=>o.root)}}},3378:(C,b,m)=>{const t=m(5107),v={};v.wrap=t.string().min(1).max(2).allow(!1),b.preferences=t.object({allowUnknown:t.boolean(),abortEarly:t.boolean(),artifacts:t.boolean(),cache:t.boolean(),context:t.object(),convert:t.boolean(),dateFormat:t.valid("date","iso","string","time","utc"),debug:t.boolean(),errors:{escapeHtml:t.boolean(),label:t.valid("path","key",!1),language:[t.string(),t.object().ref()],render:t.boolean(),stack:t.boolean(),wrap:{label:v.wrap,array:v.wrap,string:v.wrap}},externals:t.boolean(),messages:t.object(),noDefaults:t.boolean(),nonEnumerables:t.boolean(),presence:t.valid("required","optional","forbidden"),skipFunctions:t.boolean(),stripUnknown:t.object({arrays:t.boolean(),objects:t.boolean()}).or("arrays","objects").allow(!0,!1),warnings:t.boolean()}).strict(),v.nameRx=/^[a-zA-Z0-9]\w*$/,v.rule=t.object({alias:t.array().items(t.string().pattern(v.nameRx)).single(),args:t.array().items(t.string(),t.object({name:t.string().pattern(v.nameRx).required(),ref:t.boolean(),assert:t.alternatives([t.function(),t.object().schema()]).conditional("ref",{is:!0,then:t.required()}),normalize:t.function(),message:t.string().when("assert",{is:t.function(),then:t.required()})})),convert:t.boolean(),manifest:t.boolean(),method:t.function().allow(!1),multi:t.boolean(),validate:t.function()}),b.extension=t.object({type:t.alternatives([t.string(),t.object().regex()]).required(),args:t.function(),cast:t.object().pattern(v.nameRx,t.object({from:t.function().maxArity(1).required(),to:t.function().minArity(1).maxArity(2).required()})),base:t.object().schema().when("type",{is:t.object().regex(),then:t.forbidden()}),coerce:[t.function().maxArity(3),t.object({method:t.function().maxArity(3).required(),from:t.array().items(t.string()).single()})],flags:t.object().pattern(v.nameRx,t.object({setter:t.string(),default:t.any()})),manifest:{build:t.function().arity(2)},messages:[t.object(),t.string()],modifiers:t.object().pattern(v.nameRx,t.function().minArity(1).maxArity(2)),overrides:t.object().pattern(v.nameRx,t.function()),prepare:t.function().maxArity(3),rebuild:t.function().arity(1),rules:t.object().pattern(v.nameRx,v.rule),terms:t.object().pattern(v.nameRx,t.object({init:t.array().allow(null).required(),manifest:t.object().pattern(/.+/,[t.valid("schema","single"),t.object({mapped:t.object({from:t.string().required(),to:t.string().required()}).required()})])})),validate:t.function().maxArity(3)}).strict(),b.extensions=t.array().items(t.object(),t.function().arity(1)).strict(),v.desc={buffer:t.object({buffer:t.string()}),func:t.object({function:t.function().required(),options:{literal:!0}}),override:t.object({override:!0}),ref:t.object({ref:t.object({type:t.valid("value","global","local"),path:t.array().required(),separator:t.string().length(1).allow(!1),ancestor:t.number().min(0).integer().allow("root"),map:t.array().items(t.array().length(2)).min(1),adjust:t.function(),iterables:t.boolean(),in:t.boolean(),render:t.boolean()}).required()}),regex:t.object({regex:t.string().min(3)}),special:t.object({special:t.valid("deep").required()}),template:t.object({template:t.string().required(),options:t.object()}),value:t.object({value:t.alternatives([t.object(),t.array()]).required()})},v.desc.entity=t.alternatives([t.array().items(t.link("...")),t.boolean(),t.function(),t.number(),t.string(),v.desc.buffer,v.desc.func,v.desc.ref,v.desc.regex,v.desc.special,v.desc.template,v.desc.value,t.link("/")]),v.desc.values=t.array().items(null,t.boolean(),t.function(),t.number().allow(1/0,-1/0),t.string().allow(""),t.symbol(),v.desc.buffer,v.desc.func,v.desc.override,v.desc.ref,v.desc.regex,v.desc.template,v.desc.value),v.desc.messages=t.object().pattern(/.+/,[t.string(),v.desc.template,t.object().pattern(/.+/,[t.string(),v.desc.template])]),b.description=t.object({type:t.string().required(),flags:t.object({cast:t.string(),default:t.any(),description:t.string(),empty:t.link("/"),failover:v.desc.entity,id:t.string(),label:t.string(),only:!0,presence:["optional","required","forbidden"],result:["raw","strip"],strip:t.boolean(),unit:t.string()}).unknown(),preferences:{allowUnknown:t.boolean(),abortEarly:t.boolean(),artifacts:t.boolean(),cache:t.boolean(),convert:t.boolean(),dateFormat:["date","iso","string","time","utc"],errors:{escapeHtml:t.boolean(),label:["path","key"],language:[t.string(),v.desc.ref],wrap:{label:v.wrap,array:v.wrap}},externals:t.boolean(),messages:v.desc.messages,noDefaults:t.boolean(),nonEnumerables:t.boolean(),presence:["required","optional","forbidden"],skipFunctions:t.boolean(),stripUnknown:t.object({arrays:t.boolean(),objects:t.boolean()}).or("arrays","objects").allow(!0,!1),warnings:t.boolean()},allow:v.desc.values,invalid:v.desc.values,rules:t.array().min(1).items({name:t.string().required(),args:t.object().min(1),keep:t.boolean(),message:[t.string(),v.desc.messages],warn:t.boolean()}),keys:t.object().pattern(/.*/,t.link("/")),link:v.desc.ref}).pattern(/^[a-z]\w*$/,t.any())},493:(C,b,m)=>{const t=m(8571),v=m(9621),y=m(8160),h={value:Symbol("value")};C.exports=h.State=class{constructor(n,i,o){this.path=n,this.ancestors=i,this.mainstay=o.mainstay,this.schemas=o.schemas,this.debug=null}localize(n,i=null,o=null){const s=new h.State(n,i,this);return o&&s.schemas&&(s.schemas=[h.schemas(o),...s.schemas]),s}nest(n,i){const o=new h.State(this.path,this.ancestors,this);return o.schemas=o.schemas&&[h.schemas(n),...o.schemas],o.debug=i,o}shadow(n,i){this.mainstay.shadow=this.mainstay.shadow||new h.Shadow,this.mainstay.shadow.set(this.path,n,i)}snapshot(){this.mainstay.shadow&&(this._snapshot=t(this.mainstay.shadow.node(this.path))),this.mainstay.snapshot()}restore(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.restore()}commit(){this.mainstay.shadow&&(this.mainstay.shadow.override(this.path,this._snapshot),this._snapshot=void 0),this.mainstay.commit()}},h.schemas=function(n){return y.isSchema(n)?{schema:n}:n},h.Shadow=class{constructor(){this._values=null}set(n,i,o){if(!n.length||o==="strip"&&typeof n[n.length-1]=="number")return;this._values=this._values||new Map;let s=this._values;for(let r=0;r<n.length;++r){const l=n[r];let a=s.get(l);a||(a=new Map,s.set(l,a)),s=a}s[h.value]=i}get(n){const i=this.node(n);if(i)return i[h.value]}node(n){if(this._values)return v(this._values,n,{iterables:!0})}override(n,i){if(!this._values)return;const o=n.slice(0,-1),s=n[n.length-1],r=v(this._values,o,{iterables:!0});i?r.set(s,i):r&&r.delete(s)}}},3328:(C,b,m)=>{const t=m(375),v=m(8571),y=m(5277),h=m(1447),n=m(8160),i=m(6354),o=m(6133),s={symbol:Symbol("template"),opens:new Array(1e3).join("\0"),closes:new Array(1e3).join(""),dateFormat:{date:Date.prototype.toDateString,iso:Date.prototype.toISOString,string:Date.prototype.toString,time:Date.prototype.toTimeString,utc:Date.prototype.toUTCString}};C.exports=s.Template=class{constructor(r,l){if(t(typeof r=="string","Template source must be a string"),t(!r.includes("\0")&&!r.includes(""),"Template source cannot contain reserved control characters"),this.source=r,this.rendered=r,this._template=null,l){const a=l,{functions:u}=a,f=De(a,["functions"]);this._settings=Object.keys(f).length?v(f):void 0,this._functions=u,this._functions&&(t(Object.keys(this._functions).every(p=>typeof p=="string"),"Functions keys must be strings"),t(Object.values(this._functions).every(p=>typeof p=="function"),"Functions values must be functions"))}else this._settings=void 0,this._functions=void 0;this._parse()}_parse(){if(!this.source.includes("{"))return;const r=s.encode(this.source),l=s.split(r);let a=!1;const u=[],f=l.shift();f&&u.push(f);for(const p of l){const _=p[0]!=="{",k=_?"}":"}}",E=p.indexOf(k);if(E===-1||p[1]==="{"){u.push("{".concat(s.decode(p)));continue}let g=p.slice(_?0:1,E);const R=g[0]===":";R&&(g=g.slice(1));const I=this._ref(s.decode(g),{raw:_,wrapped:R});u.push(I),typeof I!="string"&&(a=!0);const A=p.slice(E+k.length);A&&u.push(s.decode(A))}a?this._template=u:this.rendered=u.join("")}static date(r,l){return s.dateFormat[l.dateFormat].call(r)}describe(r={}){if(!this._settings&&r.compact)return this.source;const l={template:this.source};return this._settings&&(l.options=this._settings),this._functions&&(l.functions=this._functions),l}static build(r){return new s.Template(r.template,r.options||r.functions?be(q({},r.options),{functions:r.functions}):void 0)}isDynamic(){return!!this._template}static isTemplate(r){return!!r&&!!r[n.symbols.template]}refs(){if(!this._template)return;const r=[];for(const l of this._template)typeof l!="string"&&r.push(...l.refs);return r}resolve(r,l,a,u){return this._template&&this._template.length===1?this._part(this._template[0],r,l,a,u,{}):this.render(r,l,a,u)}_part(r,...l){return r.ref?r.ref.resolve(...l):r.formula.evaluate(l)}render(r,l,a,u,f={}){if(!this.isDynamic())return this.rendered;const p=[];for(const _ of this._template)if(typeof _=="string")p.push(_);else{const k=this._part(_,r,l,a,u,f),E=s.stringify(k,r,l,a,u,f);if(E!==void 0){const g=_.raw||(f.errors&&f.errors.escapeHtml)===!1?E:y(E);p.push(s.wrap(g,_.wrapped&&a.errors.wrap.label))}}return p.join("")}_ref(r,{raw:l,wrapped:a}){const u=[],f=_=>{const k=o.create(_,this._settings);return u.push(k),E=>{const g=k.resolve(...E);return g!==void 0?g:null}};try{const _=this._functions?q(q({},s.functions),this._functions):s.functions;var p=new h.Parser(r,{reference:f,functions:_,constants:s.constants})}catch(_){throw _.message='Invalid template variable "'.concat(r,'" fails due to: ').concat(_.message),_}if(p.single){if(p.single.type==="reference"){const _=u[0];return{ref:_,raw:l,refs:u,wrapped:a||_.type==="local"&&_.key==="label"}}return s.stringify(p.single.value)}return{formula:p,raw:l,refs:u}}toString(){return this.source}},s.Template.prototype[n.symbols.template]=!0,s.Template.prototype.isImmutable=!0,s.encode=function(r){return r.replace(/\\(\{+)/g,(l,a)=>s.opens.slice(0,a.length)).replace(/\\(\}+)/g,(l,a)=>s.closes.slice(0,a.length))},s.decode=function(r){return r.replace(/\u0000/g,"{").replace(/\u0001/g,"}")},s.split=function(r){const l=[];let a="";for(let u=0;u<r.length;++u){const f=r[u];if(f==="{"){let p="";for(;u+1<r.length&&r[u+1]==="{";)p+="{",++u;l.push(a),a=p}else a+=f}return l.push(a),l},s.wrap=function(r,l){return l?l.length===1?"".concat(l).concat(r).concat(l):"".concat(l[0]).concat(r).concat(l[1]):r},s.stringify=function(r,l,a,u,f,p={}){const _=typeof r,k=u&&u.errors&&u.errors.wrap||{};let E=!1;if(o.isRef(r)&&r.render&&(E=r.in,r=r.resolve(l,a,u,f,q({in:r.in},p))),r===null)return"null";if(_==="string")return s.wrap(r,p.arrayItems&&k.string);if(_==="number"||_==="function"||_==="symbol")return r.toString();if(_!=="object")return JSON.stringify(r);if(r instanceof Date)return s.Template.date(r,u);if(r instanceof Map){const R=[];for(const[I,A]of r.entries())R.push("".concat(I.toString()," -> ").concat(A.toString()));r=R}if(!Array.isArray(r))return r.toString();const g=[];for(const R of r)g.push(s.stringify(R,l,a,u,f,q({arrayItems:!0},p)));return s.wrap(g.join(", "),!E&&k.array)},s.constants={true:!0,false:!1,null:null,second:1e3,minute:6e4,hour:36e5,day:864e5},s.functions={if:(r,l,a)=>r?l:a,length:r=>typeof r=="string"?r.length:r&&typeof r=="object"?Array.isArray(r)?r.length:Object.keys(r).length:null,msg(r){const[l,a,u,f,p]=this,_=p.messages;if(!_)return"";const k=i.template(l,_[0],r,a,u)||i.template(l,_[1],r,a,u);return k?k.render(l,a,u,f,p):""},number:r=>typeof r=="number"?r:typeof r=="string"?parseFloat(r):typeof r=="boolean"?r?1:0:r instanceof Date?r.getTime():null}},4946:(C,b,m)=>{const t=m(375),v=m(1687),y=m(8068),h=m(8160),n=m(3292),i=m(6354),o=m(6133),s={};C.exports=y.extend({type:"alternatives",flags:{match:{default:"any"}},terms:{matches:{init:[],register:o.toSibling}},args:(r,...l)=>l.length===1&&Array.isArray(l[0])?r.try(...l[0]):r.try(...l),validate(r,l){const{schema:a,error:u,state:f,prefs:p}=l;if(a._flags.match){const k=[],E=[];for(let R=0;R<a.$_terms.matches.length;++R){const I=a.$_terms.matches[R],A=f.nest(I.schema,"match.".concat(R));A.snapshot();const O=I.schema.$_validate(r,A,p);O.errors?(E.push(O.errors),A.restore()):(k.push(O.value),A.commit())}if(k.length===0)return{errors:u("alternatives.any",{details:E.map(R=>i.details(R,{override:!1}))})};if(a._flags.match==="one")return k.length===1?{value:k[0]}:{errors:u("alternatives.one")};if(k.length!==a.$_terms.matches.length)return{errors:u("alternatives.all",{details:E.map(R=>i.details(R,{override:!1}))})};const g=R=>R.$_terms.matches.some(I=>I.schema.type==="object"||I.schema.type==="alternatives"&&g(I.schema));return g(a)?{value:k.reduce((R,I)=>v(R,I,{mergeArrays:!1}))}:{value:k[k.length-1]}}const _=[];for(let k=0;k<a.$_terms.matches.length;++k){const E=a.$_terms.matches[k];if(E.schema){const I=f.nest(E.schema,"match.".concat(k));I.snapshot();const A=E.schema.$_validate(r,I,p);if(!A.errors)return I.commit(),A;I.restore(),_.push({schema:E.schema,reports:A.errors});continue}const g=E.ref?E.ref.resolve(r,f,p):r,R=E.is?[E]:E.switch;for(let I=0;I<R.length;++I){const A=R[I],{is:O,then:N,otherwise:V}=A,B="match.".concat(k).concat(E.switch?"."+I:"");if(O.$_match(g,f.nest(O,"".concat(B,".is")),p)){if(N)return N.$_validate(r,f.nest(N,"".concat(B,".then")),p)}else if(V)return V.$_validate(r,f.nest(V,"".concat(B,".otherwise")),p)}}return s.errors(_,l)},rules:{conditional:{method(r,l){t(!this._flags._endedSwitch,"Unreachable condition"),t(!this._flags.match,"Cannot combine match mode",this._flags.match,"with conditional rule"),t(l.break===void 0,"Cannot use break option with alternatives conditional");const a=this.clone(),u=n.when(a,r,l),f=u.is?[u]:u.switch;for(const p of f)if(p.then&&p.otherwise){a.$_setFlag("_endedSwitch",!0,{clone:!1});break}return a.$_terms.matches.push(u),a.$_mutateRebuild()}},match:{method(r){if(t(["any","one","all"].includes(r),"Invalid alternatives match mode",r),r!=="any")for(const l of this.$_terms.matches)t(l.schema,"Cannot combine match mode",r,"with conditional rules");return this.$_setFlag("match",r)}},try:{method(...r){t(r.length,"Missing alternative schemas"),h.verifyFlat(r,"try"),t(!this._flags._endedSwitch,"Unreachable condition");const l=this.clone();for(const a of r)l.$_terms.matches.push({schema:l.$_compile(a)});return l.$_mutateRebuild()}}},overrides:{label(r){return this.$_parent("label",r).$_modify({each:(l,a)=>a.path[0]!=="is"&&typeof l._flags.label!="string"?l.label(r):void 0,ref:!1})}},rebuild(r){r.$_modify({each:l=>{h.isSchema(l)&&l.type==="array"&&r.$_setFlag("_arrayItems",!0,{clone:!1})}})},manifest:{build(r,l){if(l.matches)for(const a of l.matches){const{schema:u,ref:f,is:p,not:_,then:k,otherwise:E}=a;r=u?r.try(u):f?r.conditional(f,{is:p,then:k,not:_,otherwise:E,switch:a.switch}):r.conditional(p,{then:k,otherwise:E})}return r}},messages:{"alternatives.all":"{{#label}} does not match all of the required types","alternatives.any":"{{#label}} does not match any of the allowed types","alternatives.match":"{{#label}} does not match any of the allowed types","alternatives.one":"{{#label}} matches more than one allowed type","alternatives.types":"{{#label}} must be one of {{#types}}"}}),s.errors=function(r,{error:l,state:a}){if(!r.length)return{errors:l("alternatives.any")};if(r.length===1)return{errors:r[0].reports};const u=new Set,f=[];for(const{reports:p,schema:_}of r){if(p.length>1)return s.unmatched(r,l);const k=p[0];if(k instanceof i.Report==0)return s.unmatched(r,l);if(k.state.path.length!==a.path.length){f.push({type:_.type,report:k});continue}if(k.code==="any.only"){for(const R of k.local.valids)u.add(R);continue}const[E,g]=k.code.split(".");g==="base"?u.add(E):f.push({type:_.type,report:k})}return f.length?f.length===1?{errors:f[0].report}:s.unmatched(r,l):{errors:l("alternatives.types",{types:[...u]})}},s.unmatched=function(r,l){const a=[];for(const u of r)a.push(...u.reports);return{errors:l("alternatives.match",i.details(a,{override:!1}))}}},8068:(C,b,m)=>{const t=m(375),v=m(7629),y=m(8160),h=m(6914);C.exports=v.extend({type:"any",flags:{only:{default:!1}},terms:{alterations:{init:null},examples:{init:null},externals:{init:null},metas:{init:[]},notes:{init:[]},shared:{init:null},tags:{init:[]},whens:{init:null}},rules:{custom:{method(n,i){return t(typeof n=="function","Method must be a function"),t(i===void 0||i&&typeof i=="string","Description must be a non-empty string"),this.$_addRule({name:"custom",args:{method:n,description:i}})},validate(n,i,{method:o}){try{return o(n,i)}catch(s){return i.error("any.custom",{error:s})}},args:["method","description"],multi:!0},messages:{method(n){return this.prefs({messages:n})}},shared:{method(n){t(y.isSchema(n)&&n._flags.id,"Schema must be a schema with an id");const i=this.clone();return i.$_terms.shared=i.$_terms.shared||[],i.$_terms.shared.push(n),i.$_mutateRegister(n),i}},warning:{method(n,i){return t(n&&typeof n=="string","Invalid warning code"),this.$_addRule({name:"warning",args:{code:n,local:i},warn:!0})},validate:(n,i,{code:o,local:s})=>i.error(o,s),args:["code","local"],multi:!0}},modifiers:{keep(n,i=!0){n.keep=i},message(n,i){n.message=h.compile(i)},warn(n,i=!0){n.warn=i}},manifest:{build(n,i){for(const o in i){const s=i[o];if(["examples","externals","metas","notes","tags"].includes(o))for(const r of s)n=n[o.slice(0,-1)](r);else if(o!=="alterations")if(o!=="whens"){if(o==="shared")for(const r of s)n=n.shared(r)}else for(const r of s){const{ref:l,is:a,not:u,then:f,otherwise:p,concat:_}=r;n=_?n.concat(_):l?n.when(l,{is:a,not:u,then:f,otherwise:p,switch:r.switch,break:r.break}):n.when(a,{then:f,otherwise:p,break:r.break})}else{const r={};for(const{target:l,adjuster:a}of s)r[l]=a;n=n.alter(r)}}return n}},messages:{"any.custom":"{{#label}} failed custom validation because {{#error.message}}","any.default":"{{#label}} threw an error when running default method","any.failover":"{{#label}} threw an error when running failover method","any.invalid":"{{#label}} contains an invalid value","any.only":'{{#label}} must be {if(#valids.length == 1, "", "one of ")}{{#valids}}',"any.ref":"{{#label}} {{#arg}} references {{:#ref}} which {{#reason}}","any.required":"{{#label}} is required","any.unknown":"{{#label}} is not allowed"}})},546:(C,b,m)=>{const t=m(375),v=m(9474),y=m(9621),h=m(8068),n=m(8160),i=m(3292),o={};C.exports=h.extend({type:"array",flags:{single:{default:!1},sparse:{default:!1}},terms:{items:{init:[],manifest:"schema"},ordered:{init:[],manifest:"schema"},_exclusions:{init:[]},_inclusions:{init:[]},_requireds:{init:[]}},coerce:{from:"object",method(s,{schema:r,state:l,prefs:a}){if(!Array.isArray(s))return;const u=r.$_getRule("sort");return u?o.sort(r,s,u.args.options,l,a):void 0}},validate(s,{schema:r,error:l}){if(!Array.isArray(s)){if(r._flags.single){const a=[s];return a[n.symbols.arraySingle]=!0,{value:a}}return{errors:l("array.base")}}if(r.$_getRule("items")||r.$_terms.externals)return{value:s.slice()}},rules:{has:{method(s){s=this.$_compile(s,{appendPath:!0});const r=this.$_addRule({name:"has",args:{schema:s}});return r.$_mutateRegister(s),r},validate(s,{state:r,prefs:l,error:a},{schema:u}){const f=[s,...r.ancestors];for(let _=0;_<s.length;++_){const k=r.localize([...r.path,_],f,u);if(u.$_match(s[_],k,l))return s}const p=u._flags.label;return p?a("array.hasKnown",{patternLabel:p}):a("array.hasUnknown",null)},multi:!0},items:{method(...s){n.verifyFlat(s,"items");const r=this.$_addRule("items");for(let l=0;l<s.length;++l){const a=n.tryWithPath(()=>this.$_compile(s[l]),l,{append:!0});r.$_terms.items.push(a)}return r.$_mutateRebuild()},validate(s,{schema:r,error:l,state:a,prefs:u,errorsArray:f}){const p=r.$_terms._requireds.slice(),_=r.$_terms.ordered.slice(),k=[...r.$_terms._inclusions,...p],E=!s[n.symbols.arraySingle];delete s[n.symbols.arraySingle];const g=f();let R=s.length;for(let I=0;I<R;++I){const A=s[I];let O=!1,N=!1;const V=E?I:new Number(I),B=[...a.path,V];if(!r._flags.sparse&&A===void 0){if(g.push(l("array.sparse",{key:V,path:B,pos:I,value:void 0},a.localize(B))),u.abortEarly)return g;_.shift();continue}const Z=[s,...a.ancestors];for(const U of r.$_terms._exclusions)if(U.$_match(A,a.localize(B,Z,U),u,{presence:"ignore"})){if(g.push(l("array.excludes",{pos:I,value:A},a.localize(B))),u.abortEarly)return g;O=!0,_.shift();break}if(O)continue;if(r.$_terms.ordered.length){if(_.length){const U=_.shift(),W=U.$_validate(A,a.localize(B,Z,U),u);if(W.errors){if(g.push(...W.errors),u.abortEarly)return g}else if(U._flags.result==="strip")o.fastSplice(s,I),--I,--R;else{if(!r._flags.sparse&&W.value===void 0){if(g.push(l("array.sparse",{key:V,path:B,pos:I,value:void 0},a.localize(B))),u.abortEarly)return g;continue}s[I]=W.value}continue}if(!r.$_terms.items.length){if(g.push(l("array.orderedLength",{pos:I,limit:r.$_terms.ordered.length})),u.abortEarly)return g;break}}const M=[];let F=p.length;for(let U=0;U<F;++U){const W=a.localize(B,Z,p[U]);W.snapshot();const K=p[U].$_validate(A,W,u);if(M[U]=K,!K.errors){if(W.commit(),s[I]=K.value,N=!0,o.fastSplice(p,U),--U,--F,!r._flags.sparse&&K.value===void 0&&(g.push(l("array.sparse",{key:V,path:B,pos:I,value:void 0},a.localize(B))),u.abortEarly))return g;break}W.restore()}if(N)continue;const X=u.stripUnknown&&!!u.stripUnknown.arrays||!1;F=k.length;for(const U of k){let W;const K=p.indexOf(U);if(K!==-1)W=M[K];else{const ee=a.localize(B,Z,U);if(ee.snapshot(),W=U.$_validate(A,ee,u),!W.errors){ee.commit(),U._flags.result==="strip"?(o.fastSplice(s,I),--I,--R):r._flags.sparse||W.value!==void 0?s[I]=W.value:(g.push(l("array.sparse",{key:V,path:B,pos:I,value:void 0},a.localize(B))),O=!0),N=!0;break}ee.restore()}if(F===1){if(X){o.fastSplice(s,I),--I,--R,N=!0;break}if(g.push(...W.errors),u.abortEarly)return g;O=!0;break}}if(!O&&(r.$_terms._inclusions.length||r.$_terms._requireds.length)&&!N){if(X){o.fastSplice(s,I),--I,--R;continue}if(g.push(l("array.includes",{pos:I,value:A},a.localize(B))),u.abortEarly)return g}}return p.length&&o.fillMissedErrors(r,g,p,s,a,u),_.length&&(o.fillOrderedErrors(r,g,_,s,a,u),g.length||o.fillDefault(_,s,a,u)),g.length?g:s},priority:!0,manifest:!1},length:{method(s){return this.$_addRule({name:"length",args:{limit:s},operator:"="})},validate:(s,r,{limit:l},{name:a,operator:u,args:f})=>n.compare(s.length,l,u)?s:r.error("array."+a,{limit:f.limit,value:s}),args:[{name:"limit",ref:!0,assert:n.limit,message:"must be a positive integer"}]},max:{method(s){return this.$_addRule({name:"max",method:"length",args:{limit:s},operator:"<="})}},min:{method(s){return this.$_addRule({name:"min",method:"length",args:{limit:s},operator:">="})}},ordered:{method(...s){n.verifyFlat(s,"ordered");const r=this.$_addRule("items");for(let l=0;l<s.length;++l){const a=n.tryWithPath(()=>this.$_compile(s[l]),l,{append:!0});o.validateSingle(a,r),r.$_mutateRegister(a),r.$_terms.ordered.push(a)}return r.$_mutateRebuild()}},single:{method(s){const r=s===void 0||!!s;return t(!r||!this._flags._arrayItems,"Cannot specify single rule when array has array items"),this.$_setFlag("single",r)}},sort:{method(s={}){n.assertOptions(s,["by","order"]);const r={order:s.order||"ascending"};return s.by&&(r.by=i.ref(s.by,{ancestor:0}),t(!r.by.ancestor,"Cannot sort by ancestor")),this.$_addRule({name:"sort",args:{options:r}})},validate(s,{error:r,state:l,prefs:a,schema:u},{options:f}){const{value:p,errors:_}=o.sort(u,s,f,l,a);if(_)return _;for(let k=0;k<s.length;++k)if(s[k]!==p[k])return r("array.sort",{order:f.order,by:f.by?f.by.key:"value"});return s},convert:!0},sparse:{method(s){const r=s===void 0||!!s;return this._flags.sparse===r?this:(r?this.clone():this.$_addRule("items")).$_setFlag("sparse",r,{clone:!1})}},unique:{method(s,r={}){t(!s||typeof s=="function"||typeof s=="string","comparator must be a function or a string"),n.assertOptions(r,["ignoreUndefined","separator"]);const l={name:"unique",args:{options:r,comparator:s}};if(s)if(typeof s=="string"){const a=n.default(r.separator,".");l.path=a?s.split(a):[s]}else l.comparator=s;return this.$_addRule(l)},validate(s,{state:r,error:l,schema:a},{comparator:u,options:f},{comparator:p,path:_}){const k={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),bigint:Object.create(null),object:new Map,function:new Map,custom:new Map},E=p||v,g=f.ignoreUndefined;for(let R=0;R<s.length;++R){const I=_?y(s[R],_):s[R],A=p?k.custom:k[typeof I];if(t(A,"Failed to find unique map container for type",typeof I),A instanceof Map){const O=A.entries();let N;for(;!(N=O.next()).done;)if(E(N.value[0],I)){const V=r.localize([...r.path,R],[s,...r.ancestors]),B={pos:R,value:s[R],dupePos:N.value[1],dupeValue:s[N.value[1]]};return _&&(B.path=u),l("array.unique",B,V)}A.set(I,R)}else{if((!g||I!==void 0)&&A[I]!==void 0){const O={pos:R,value:s[R],dupePos:A[I],dupeValue:s[A[I]]};return _&&(O.path=u),l("array.unique",O,r.localize([...r.path,R],[s,...r.ancestors]))}A[I]=R}}return s},args:["comparator","options"],multi:!0}},cast:{set:{from:Array.isArray,to:(s,r)=>new Set(s)}},rebuild(s){s.$_terms._inclusions=[],s.$_terms._exclusions=[],s.$_terms._requireds=[];for(const r of s.$_terms.items)o.validateSingle(r,s),r._flags.presence==="required"?s.$_terms._requireds.push(r):r._flags.presence==="forbidden"?s.$_terms._exclusions.push(r):s.$_terms._inclusions.push(r);for(const r of s.$_terms.ordered)o.validateSingle(r,s)},manifest:{build:(s,r)=>(r.items&&(s=s.items(...r.items)),r.ordered&&(s=s.ordered(...r.ordered)),s)},messages:{"array.base":"{{#label}} must be an array","array.excludes":"{{#label}} contains an excluded value","array.hasKnown":"{{#label}} does not contain at least one required match for type {:#patternLabel}","array.hasUnknown":"{{#label}} does not contain at least one required match","array.includes":"{{#label}} does not match any of the allowed types","array.includesRequiredBoth":"{{#label}} does not contain {{#knownMisses}} and {{#unknownMisses}} other required value(s)","array.includesRequiredKnowns":"{{#label}} does not contain {{#knownMisses}}","array.includesRequiredUnknowns":"{{#label}} does not contain {{#unknownMisses}} required value(s)","array.length":"{{#label}} must contain {{#limit}} items","array.max":"{{#label}} must contain less than or equal to {{#limit}} items","array.min":"{{#label}} must contain at least {{#limit}} items","array.orderedLength":"{{#label}} must contain at most {{#limit}} items","array.sort":"{{#label}} must be sorted in {#order} order by {{#by}}","array.sort.mismatching":"{{#label}} cannot be sorted due to mismatching types","array.sort.unsupported":"{{#label}} cannot be sorted due to unsupported type {#type}","array.sparse":"{{#label}} must not be a sparse array item","array.unique":"{{#label}} contains a duplicate value"}}),o.fillMissedErrors=function(s,r,l,a,u,f){const p=[];let _=0;for(const k of l){const E=k._flags.label;E?p.push(E):++_}p.length?_?r.push(s.$_createError("array.includesRequiredBoth",a,{knownMisses:p,unknownMisses:_},u,f)):r.push(s.$_createError("array.includesRequiredKnowns",a,{knownMisses:p},u,f)):r.push(s.$_createError("array.includesRequiredUnknowns",a,{unknownMisses:_},u,f))},o.fillOrderedErrors=function(s,r,l,a,u,f){const p=[];for(const _ of l)_._flags.presence==="required"&&p.push(_);p.length&&o.fillMissedErrors(s,r,p,a,u,f)},o.fillDefault=function(s,r,l,a){const u=[];let f=!0;for(let p=s.length-1;p>=0;--p){const _=s[p],k=[r,...l.ancestors],E=_.$_validate(void 0,l.localize(l.path,k,_),a).value;if(f){if(E===void 0)continue;f=!1}u.unshift(E)}u.length&&r.push(...u)},o.fastSplice=function(s,r){let l=r;for(;l<s.length;)s[l++]=s[l];--s.length},o.validateSingle=function(s,r){(s.type==="array"||s._flags._arrayItems)&&(t(!r._flags.single,"Cannot specify array item with single rule enabled"),r.$_setFlag("_arrayItems",!0,{clone:!1}))},o.sort=function(s,r,l,a,u){const f=l.order==="ascending"?1:-1,p=-1*f,_=f,k=(E,g)=>{let R=o.compare(E,g,p,_);if(R!==null||(l.by&&(E=l.by.resolve(E,a,u),g=l.by.resolve(g,a,u)),R=o.compare(E,g,p,_),R!==null))return R;const I=typeof E;if(I!==typeof g)throw s.$_createError("array.sort.mismatching",r,null,a,u);if(I!=="number"&&I!=="string")throw s.$_createError("array.sort.unsupported",r,{type:I},a,u);return I==="number"?(E-g)*f:E<g?p:_};try{return{value:r.slice().sort(k)}}catch(E){return{errors:E}}},o.compare=function(s,r,l,a){return s===r?0:s===void 0?1:r===void 0?-1:s===null?a:r===null?l:null}},4937:(C,b,m)=>{const t=m(375),v=m(8068),y=m(8160),h=m(2036),n={isBool:function(i){return typeof i=="boolean"}};C.exports=v.extend({type:"boolean",flags:{sensitive:{default:!1}},terms:{falsy:{init:null,manifest:"values"},truthy:{init:null,manifest:"values"}},coerce(i,{schema:o}){if(typeof i!="boolean"){if(typeof i=="string"){const s=o._flags.sensitive?i:i.toLowerCase();i=s==="true"||s!=="false"&&i}return typeof i!="boolean"&&(i=o.$_terms.truthy&&o.$_terms.truthy.has(i,null,null,!o._flags.sensitive)||(!o.$_terms.falsy||!o.$_terms.falsy.has(i,null,null,!o._flags.sensitive))&&i),{value:i}}},validate(i,{error:o}){if(typeof i!="boolean")return{value:i,errors:o("boolean.base")}},rules:{truthy:{method(...i){y.verifyFlat(i,"truthy");const o=this.clone();o.$_terms.truthy=o.$_terms.truthy||new h;for(let s=0;s<i.length;++s){const r=i[s];t(r!==void 0,"Cannot call truthy with undefined"),o.$_terms.truthy.add(r)}return o}},falsy:{method(...i){y.verifyFlat(i,"falsy");const o=this.clone();o.$_terms.falsy=o.$_terms.falsy||new h;for(let s=0;s<i.length;++s){const r=i[s];t(r!==void 0,"Cannot call falsy with undefined"),o.$_terms.falsy.add(r)}return o}},sensitive:{method(i=!0){return this.$_setFlag("sensitive",i)}}},cast:{number:{from:n.isBool,to:(i,o)=>i?1:0},string:{from:n.isBool,to:(i,o)=>i?"true":"false"}},manifest:{build:(i,o)=>(o.truthy&&(i=i.truthy(...o.truthy)),o.falsy&&(i=i.falsy(...o.falsy)),i)},messages:{"boolean.base":"{{#label}} must be a boolean"}})},7500:(C,b,m)=>{const t=m(375),v=m(8068),y=m(8160),h=m(3328),n={isDate:function(i){return i instanceof Date}};C.exports=v.extend({type:"date",coerce:{from:["number","string"],method:(i,{schema:o})=>({value:n.parse(i,o._flags.format)||i})},validate(i,{schema:o,error:s,prefs:r}){if(i instanceof Date&&!isNaN(i.getTime()))return;const l=o._flags.format;return r.convert&&l&&typeof i=="string"?{value:i,errors:s("date.format",{format:l})}:{value:i,errors:s("date.base")}},rules:{compare:{method:!1,validate(i,o,{date:s},{name:r,operator:l,args:a}){const u=s==="now"?Date.now():s.getTime();return y.compare(i.getTime(),u,l)?i:o.error("date."+r,{limit:a.date,value:i})},args:[{name:"date",ref:!0,normalize:i=>i==="now"?i:n.parse(i),assert:i=>i!==null,message:"must have a valid date format"}]},format:{method(i){return t(["iso","javascript","unix"].includes(i),"Unknown date format",i),this.$_setFlag("format",i)}},greater:{method(i){return this.$_addRule({name:"greater",method:"compare",args:{date:i},operator:">"})}},iso:{method(){return this.format("iso")}},less:{method(i){return this.$_addRule({name:"less",method:"compare",args:{date:i},operator:"<"})}},max:{method(i){return this.$_addRule({name:"max",method:"compare",args:{date:i},operator:"<="})}},min:{method(i){return this.$_addRule({name:"min",method:"compare",args:{date:i},operator:">="})}},timestamp:{method(i="javascript"){return t(["javascript","unix"].includes(i),'"type" must be one of "javascript, unix"'),this.format(i)}}},cast:{number:{from:n.isDate,to:(i,o)=>i.getTime()},string:{from:n.isDate,to:(i,{prefs:o})=>h.date(i,o)}},messages:{"date.base":"{{#label}} must be a valid date","date.format":'{{#label}} must be in {msg("date.format." + #format) || #format} format',"date.greater":"{{#label}} must be greater than {{:#limit}}","date.less":"{{#label}} must be less than {{:#limit}}","date.max":"{{#label}} must be less than or equal to {{:#limit}}","date.min":"{{#label}} must be greater than or equal to {{:#limit}}","date.format.iso":"ISO 8601 date","date.format.javascript":"timestamp or number of milliseconds","date.format.unix":"timestamp or number of seconds"}}),n.parse=function(i,o){if(i instanceof Date)return i;if(typeof i!="string"&&(isNaN(i)||!isFinite(i))||/^\s*$/.test(i))return null;if(o==="iso")return y.isIsoDate(i)?n.date(i.toString()):null;const s=i;if(typeof i=="string"&&/^[+-]?\d+(\.\d+)?$/.test(i)&&(i=parseFloat(i)),o){if(o==="javascript")return n.date(1*i);if(o==="unix")return n.date(1e3*i);if(typeof s=="string")return null}return n.date(i)},n.date=function(i){const o=new Date(i);return isNaN(o.getTime())?null:o}},390:(C,b,m)=>{const t=m(375),v=m(7824);C.exports=v.extend({type:"function",properties:{typeof:"function"},rules:{arity:{method(y){return t(Number.isSafeInteger(y)&&y>=0,"n must be a positive integer"),this.$_addRule({name:"arity",args:{n:y}})},validate:(y,h,{n})=>y.length===n?y:h.error("function.arity",{n})},class:{method(){return this.$_addRule("class")},validate:(y,h)=>/^\s*class\s/.test(y.toString())?y:h.error("function.class",{value:y})},minArity:{method(y){return t(Number.isSafeInteger(y)&&y>0,"n must be a strict positive integer"),this.$_addRule({name:"minArity",args:{n:y}})},validate:(y,h,{n})=>y.length>=n?y:h.error("function.minArity",{n})},maxArity:{method(y){return t(Number.isSafeInteger(y)&&y>=0,"n must be a positive integer"),this.$_addRule({name:"maxArity",args:{n:y}})},validate:(y,h,{n})=>y.length<=n?y:h.error("function.maxArity",{n})}},messages:{"function.arity":"{{#label}} must have an arity of {{#n}}","function.class":"{{#label}} must be a class","function.maxArity":"{{#label}} must have an arity lesser or equal to {{#n}}","function.minArity":"{{#label}} must have an arity greater or equal to {{#n}}"}})},7824:(C,b,m)=>{const t=m(978),v=m(375),y=m(8571),h=m(3652),n=m(8068),i=m(8160),o=m(3292),s=m(6354),r=m(6133),l=m(3328),a={renameDefaults:{alias:!1,multiple:!1,override:!1}};C.exports=n.extend({type:"_keys",properties:{typeof:"object"},flags:{unknown:{default:!1}},terms:{dependencies:{init:null},keys:{init:null,manifest:{mapped:{from:"schema",to:"key"}}},patterns:{init:null},renames:{init:null}},args:(u,f)=>u.keys(f),validate(u,{schema:f,error:p,state:_,prefs:k}){if(!u||typeof u!==f.$_property("typeof")||Array.isArray(u))return{value:u,errors:p("object.base",{type:f.$_property("typeof")})};if(!(f.$_terms.renames||f.$_terms.dependencies||f.$_terms.keys||f.$_terms.patterns||f.$_terms.externals))return;u=a.clone(u,k);const E=[];if(f.$_terms.renames&&!a.rename(f,u,_,k,E))return{value:u,errors:E};if(!f.$_terms.keys&&!f.$_terms.patterns&&!f.$_terms.dependencies)return{value:u,errors:E};const g=new Set(Object.keys(u));if(f.$_terms.keys){const R=[u,..._.ancestors];for(const I of f.$_terms.keys){const A=I.key,O=u[A];g.delete(A);const N=_.localize([..._.path,A],R,I),V=I.schema.$_validate(O,N,k);if(V.errors){if(k.abortEarly)return{value:u,errors:V.errors};V.value!==void 0&&(u[A]=V.value),E.push(...V.errors)}else I.schema._flags.result==="strip"||V.value===void 0&&O!==void 0?delete u[A]:V.value!==void 0&&(u[A]=V.value)}}if(g.size||f._flags._hasPatternMatch){const R=a.unknown(f,u,g,E,_,k);if(R)return R}if(f.$_terms.dependencies)for(const R of f.$_terms.dependencies){if(R.key!==null&&a.isPresent(R.options)(R.key.resolve(u,_,k,null,{shadow:!1}))===!1)continue;const I=a.dependencies[R.rel](f,R,u,_,k);if(I){const A=f.$_createError(I.code,u,I.context,_,k);if(k.abortEarly)return{value:u,errors:A};E.push(A)}}return{value:u,errors:E}},rules:{and:{method(...u){return i.verifyFlat(u,"and"),a.dependency(this,"and",null,u)}},append:{method(u){return u==null||Object.keys(u).length===0?this:this.keys(u)}},assert:{method(u,f,p){l.isTemplate(u)||(u=o.ref(u)),v(p===void 0||typeof p=="string","Message must be a string"),f=this.$_compile(f,{appendPath:!0});const _=this.$_addRule({name:"assert",args:{subject:u,schema:f,message:p}});return _.$_mutateRegister(u),_.$_mutateRegister(f),_},validate(u,{error:f,prefs:p,state:_},{subject:k,schema:E,message:g}){const R=k.resolve(u,_,p),I=r.isRef(k)?k.absolute(_):[];return E.$_match(R,_.localize(I,[u,..._.ancestors],E),p)?u:f("object.assert",{subject:k,message:g})},args:["subject","schema","message"],multi:!0},instance:{method(u,f){return v(typeof u=="function","constructor must be a function"),f=f||u.name,this.$_addRule({name:"instance",args:{constructor:u,name:f}})},validate:(u,f,{constructor:p,name:_})=>u instanceof p?u:f.error("object.instance",{type:_,value:u}),args:["constructor","name"]},keys:{method(u){v(u===void 0||typeof u=="object","Object schema must be a valid object"),v(!i.isSchema(u),"Object schema cannot be a joi schema");const f=this.clone();if(u)if(Object.keys(u).length){f.$_terms.keys=f.$_terms.keys?f.$_terms.keys.filter(p=>!u.hasOwnProperty(p.key)):new a.Keys;for(const p in u)i.tryWithPath(()=>f.$_terms.keys.push({key:p,schema:this.$_compile(u[p])}),p)}else f.$_terms.keys=new a.Keys;else f.$_terms.keys=null;return f.$_mutateRebuild()}},length:{method(u){return this.$_addRule({name:"length",args:{limit:u},operator:"="})},validate:(u,f,{limit:p},{name:_,operator:k,args:E})=>i.compare(Object.keys(u).length,p,k)?u:f.error("object."+_,{limit:E.limit,value:u}),args:[{name:"limit",ref:!0,assert:i.limit,message:"must be a positive integer"}]},max:{method(u){return this.$_addRule({name:"max",method:"length",args:{limit:u},operator:"<="})}},min:{method(u){return this.$_addRule({name:"min",method:"length",args:{limit:u},operator:">="})}},nand:{method(...u){return i.verifyFlat(u,"nand"),a.dependency(this,"nand",null,u)}},or:{method(...u){return i.verifyFlat(u,"or"),a.dependency(this,"or",null,u)}},oxor:{method(...u){return a.dependency(this,"oxor",null,u)}},pattern:{method(u,f,p={}){const _=u instanceof RegExp;_||(u=this.$_compile(u,{appendPath:!0})),v(f!==void 0,"Invalid rule"),i.assertOptions(p,["fallthrough","matches"]),_&&v(!u.flags.includes("g")&&!u.flags.includes("y"),"pattern should not use global or sticky mode"),f=this.$_compile(f,{appendPath:!0});const k=this.clone();k.$_terms.patterns=k.$_terms.patterns||[];const E={[_?"regex":"schema"]:u,rule:f};return p.matches&&(E.matches=this.$_compile(p.matches),E.matches.type!=="array"&&(E.matches=E.matches.$_root.array().items(E.matches)),k.$_mutateRegister(E.matches),k.$_setFlag("_hasPatternMatch",!0,{clone:!1})),p.fallthrough&&(E.fallthrough=!0),k.$_terms.patterns.push(E),k.$_mutateRegister(f),k}},ref:{method(){return this.$_addRule("ref")},validate:(u,f)=>r.isRef(u)?u:f.error("object.refType",{value:u})},regex:{method(){return this.$_addRule("regex")},validate:(u,f)=>u instanceof RegExp?u:f.error("object.regex",{value:u})},rename:{method(u,f,p={}){v(typeof u=="string"||u instanceof RegExp,"Rename missing the from argument"),v(typeof f=="string"||f instanceof l,"Invalid rename to argument"),v(f!==u,"Cannot rename key to same name:",u),i.assertOptions(p,["alias","ignoreUndefined","override","multiple"]);const _=this.clone();_.$_terms.renames=_.$_terms.renames||[];for(const k of _.$_terms.renames)v(k.from!==u,"Cannot rename the same key multiple times");return f instanceof l&&_.$_mutateRegister(f),_.$_terms.renames.push({from:u,to:f,options:t(a.renameDefaults,p)}),_}},schema:{method(u="any"){return this.$_addRule({name:"schema",args:{type:u}})},validate:(u,f,{type:p})=>!i.isSchema(u)||p!=="any"&&u.type!==p?f.error("object.schema",{type:p}):u},unknown:{method(u){return this.$_setFlag("unknown",u!==!1)}},with:{method(u,f,p={}){return a.dependency(this,"with",u,f,p)}},without:{method(u,f,p={}){return a.dependency(this,"without",u,f,p)}},xor:{method(...u){return i.verifyFlat(u,"xor"),a.dependency(this,"xor",null,u)}}},overrides:{default(u,f){return u===void 0&&(u=i.symbols.deepDefault),this.$_parent("default",u,f)}},rebuild(u){if(u.$_terms.keys){const f=new h.Sorter;for(const p of u.$_terms.keys)i.tryWithPath(()=>f.add(p,{after:p.schema.$_rootReferences(),group:p.key}),p.key);u.$_terms.keys=new a.Keys(...f.nodes)}},manifest:{build(u,f){if(f.keys&&(u=u.keys(f.keys)),f.dependencies)for(const{rel:p,key:_=null,peers:k,options:E}of f.dependencies)u=a.dependency(u,p,_,k,E);if(f.patterns)for(const{regex:p,schema:_,rule:k,fallthrough:E,matches:g}of f.patterns)u=u.pattern(p||_,k,{fallthrough:E,matches:g});if(f.renames)for(const{from:p,to:_,options:k}of f.renames)u=u.rename(p,_,k);return u}},messages:{"object.and":"{{#label}} contains {{#presentWithLabels}} without its required peers {{#missingWithLabels}}","object.assert":'{{#label}} is invalid because {if(#subject.key, `"` + #subject.key + `" failed to ` + (#message || "pass the assertion test"), #message || "the assertion failed")}',"object.base":"{{#label}} must be of type {{#type}}","object.instance":"{{#label}} must be an instance of {{:#type}}","object.length":'{{#label}} must have {{#limit}} key{if(#limit == 1, "", "s")}',"object.max":'{{#label}} must have less than or equal to {{#limit}} key{if(#limit == 1, "", "s")}',"object.min":'{{#label}} must have at least {{#limit}} key{if(#limit == 1, "", "s")}',"object.missing":"{{#label}} must contain at least one of {{#peersWithLabels}}","object.nand":"{{:#mainWithLabel}} must not exist simultaneously with {{#peersWithLabels}}","object.oxor":"{{#label}} contains a conflict between optional exclusive peers {{#peersWithLabels}}","object.pattern.match":"{{#label}} keys failed to match pattern requirements","object.refType":"{{#label}} must be a Joi reference","object.regex":"{{#label}} must be a RegExp object","object.rename.multiple":"{{#label}} cannot rename {{:#from}} because multiple renames are disabled and another key was already renamed to {{:#to}}","object.rename.override":"{{#label}} cannot rename {{:#from}} because override is disabled and target {{:#to}} exists","object.schema":"{{#label}} must be a Joi schema of {{#type}} type","object.unknown":"{{#label}} is not allowed","object.with":"{{:#mainWithLabel}} missing required peer {{:#peerWithLabel}}","object.without":"{{:#mainWithLabel}} conflict with forbidden peer {{:#peerWithLabel}}","object.xor":"{{#label}} contains a conflict between exclusive peers {{#peersWithLabels}}"}}),a.clone=function(u,f){if(typeof u=="object"){if(f.nonEnumerables)return y(u,{shallow:!0});const _=Object.create(Object.getPrototypeOf(u));return Object.assign(_,u),_}const p=function(..._){return u.apply(this,_)};return p.prototype=y(u.prototype),Object.defineProperty(p,"name",{value:u.name,writable:!1}),Object.defineProperty(p,"length",{value:u.length,writable:!1}),Object.assign(p,u),p},a.dependency=function(u,f,p,_,k){v(p===null||typeof p=="string",f,"key must be a strings"),k||(k=_.length>1&&typeof _[_.length-1]=="object"?_.pop():{}),i.assertOptions(k,["separator","isPresent"]),_=[].concat(_);const E=i.default(k.separator,"."),g=[];for(const I of _)v(typeof I=="string",f,"peers must be strings"),g.push(o.ref(I,{separator:E,ancestor:0,prefix:!1}));p!==null&&(p=o.ref(p,{separator:E,ancestor:0,prefix:!1}));const R=u.clone();return R.$_terms.dependencies=R.$_terms.dependencies||[],R.$_terms.dependencies.push(new a.Dependency(f,p,g,_,k)),R},a.dependencies={and(u,f,p,_,k){const E=[],g=[],R=f.peers.length,I=a.isPresent(f.options);for(const A of f.peers)I(A.resolve(p,_,k,null,{shadow:!1}))===!1?E.push(A.key):g.push(A.key);if(E.length!==R&&g.length!==R)return{code:"object.and",context:{present:g,presentWithLabels:a.keysToLabels(u,g),missing:E,missingWithLabels:a.keysToLabels(u,E)}}},nand(u,f,p,_,k){const E=[],g=a.isPresent(f.options);for(const A of f.peers)g(A.resolve(p,_,k,null,{shadow:!1}))&&E.push(A.key);if(E.length!==f.peers.length)return;const R=f.paths[0],I=f.paths.slice(1);return{code:"object.nand",context:{main:R,mainWithLabel:a.keysToLabels(u,R),peers:I,peersWithLabels:a.keysToLabels(u,I)}}},or(u,f,p,_,k){const E=a.isPresent(f.options);for(const g of f.peers)if(E(g.resolve(p,_,k,null,{shadow:!1})))return;return{code:"object.missing",context:{peers:f.paths,peersWithLabels:a.keysToLabels(u,f.paths)}}},oxor(u,f,p,_,k){const E=[],g=a.isPresent(f.options);for(const I of f.peers)g(I.resolve(p,_,k,null,{shadow:!1}))&&E.push(I.key);if(!E.length||E.length===1)return;const R={peers:f.paths,peersWithLabels:a.keysToLabels(u,f.paths)};return R.present=E,R.presentWithLabels=a.keysToLabels(u,E),{code:"object.oxor",context:R}},with(u,f,p,_,k){const E=a.isPresent(f.options);for(const g of f.peers)if(E(g.resolve(p,_,k,null,{shadow:!1}))===!1)return{code:"object.with",context:{main:f.key.key,mainWithLabel:a.keysToLabels(u,f.key.key),peer:g.key,peerWithLabel:a.keysToLabels(u,g.key)}}},without(u,f,p,_,k){const E=a.isPresent(f.options);for(const g of f.peers)if(E(g.resolve(p,_,k,null,{shadow:!1})))return{code:"object.without",context:{main:f.key.key,mainWithLabel:a.keysToLabels(u,f.key.key),peer:g.key,peerWithLabel:a.keysToLabels(u,g.key)}}},xor(u,f,p,_,k){const E=[],g=a.isPresent(f.options);for(const I of f.peers)g(I.resolve(p,_,k,null,{shadow:!1}))&&E.push(I.key);if(E.length===1)return;const R={peers:f.paths,peersWithLabels:a.keysToLabels(u,f.paths)};return E.length===0?{code:"object.missing",context:R}:(R.present=E,R.presentWithLabels=a.keysToLabels(u,E),{code:"object.xor",context:R})}},a.keysToLabels=function(u,f){return Array.isArray(f)?f.map(p=>u.$_mapLabels(p)):u.$_mapLabels(f)},a.isPresent=function(u){return typeof u.isPresent=="function"?u.isPresent:f=>f!==void 0},a.rename=function(u,f,p,_,k){const E={};for(const g of u.$_terms.renames){const R=[],I=typeof g.from!="string";if(I)for(const A in f){if(f[A]===void 0&&g.options.ignoreUndefined||A===g.to)continue;const O=g.from.exec(A);O&&R.push({from:A,to:g.to,match:O})}else!Object.prototype.hasOwnProperty.call(f,g.from)||f[g.from]===void 0&&g.options.ignoreUndefined||R.push(g);for(const A of R){const O=A.from;let N=A.to;if(N instanceof l&&(N=N.render(f,p,_,A.match)),O!==N){if(!g.options.multiple&&E[N]&&(k.push(u.$_createError("object.rename.multiple",f,{from:O,to:N,pattern:I},p,_)),_.abortEarly)||Object.prototype.hasOwnProperty.call(f,N)&&!g.options.override&&!E[N]&&(k.push(u.$_createError("object.rename.override",f,{from:O,to:N,pattern:I},p,_)),_.abortEarly))return!1;f[O]===void 0?delete f[N]:f[N]=f[O],E[N]=!0,g.options.alias||delete f[O]}}}return!0},a.unknown=function(u,f,p,_,k,E){if(u.$_terms.patterns){let g=!1;const R=u.$_terms.patterns.map(A=>{if(A.matches)return g=!0,[]}),I=[f,...k.ancestors];for(const A of p){const O=f[A],N=[...k.path,A];for(let V=0;V<u.$_terms.patterns.length;++V){const B=u.$_terms.patterns[V];if(B.regex){const F=B.regex.test(A);if(k.mainstay.tracer.debug(k,"rule","pattern.".concat(V),F?"pass":"error"),!F)continue}else if(!B.schema.$_match(A,k.nest(B.schema,"pattern.".concat(V)),E))continue;p.delete(A);const Z=k.localize(N,I,{schema:B.rule,key:A}),M=B.rule.$_validate(O,Z,E);if(M.errors){if(E.abortEarly)return{value:f,errors:M.errors};_.push(...M.errors)}if(B.matches&&R[V].push(A),f[A]=M.value,!B.fallthrough)break}}if(g)for(let A=0;A<R.length;++A){const O=R[A];if(!O)continue;const N=u.$_terms.patterns[A].matches,V=k.localize(k.path,I,N),B=N.$_validate(O,V,E);if(B.errors){const Z=s.details(B.errors,{override:!1});Z.matches=O;const M=u.$_createError("object.pattern.match",f,Z,k,E);if(E.abortEarly)return{value:f,errors:M};_.push(M)}}}if(p.size&&(u.$_terms.keys||u.$_terms.patterns)){if(E.stripUnknown&&!u._flags.unknown||E.skipFunctions){const g=!(!E.stripUnknown||E.stripUnknown!==!0&&!E.stripUnknown.objects);for(const R of p)g?(delete f[R],p.delete(R)):typeof f[R]=="function"&&p.delete(R)}if(!i.default(u._flags.unknown,E.allowUnknown))for(const g of p){const R=k.localize([...k.path,g],[]),I=u.$_createError("object.unknown",f[g],{child:g},R,E,{flags:!1});if(E.abortEarly)return{value:f,errors:I};_.push(I)}}},a.Dependency=class{constructor(u,f,p,_,k){this.rel=u,this.key=f,this.peers=p,this.paths=_,this.options=k}describe(){const u={rel:this.rel,peers:this.paths};return this.key!==null&&(u.key=this.key.key),this.peers[0].separator!=="."&&(u.options=be(q({},u.options),{separator:this.peers[0].separator})),this.options.isPresent&&(u.options=be(q({},u.options),{isPresent:this.options.isPresent})),u}},a.Keys=class extends Array{concat(u){const f=this.slice(),p=new Map;for(let _=0;_<f.length;++_)p.set(f[_].key,_);for(const _ of u){const k=_.key,E=p.get(k);E!==void 0?f[E]={key:k,schema:f[E].schema.concat(_.schema)}:f.push(_)}return f}}},8785:(C,b,m)=>{const t=m(375),v=m(8068),y=m(8160),h=m(3292),n=m(6354),i={};C.exports=v.extend({type:"link",properties:{schemaChain:!0},terms:{link:{init:null,manifest:"single",register:!1}},args:(o,s)=>o.ref(s),validate(o,{schema:s,state:r,prefs:l}){t(s.$_terms.link,"Uninitialized link schema");const a=i.generate(s,o,r,l),u=s.$_terms.link[0].ref;return a.$_validate(o,r.nest(a,"link:".concat(u.display,":").concat(a.type)),l)},generate:(o,s,r,l)=>i.generate(o,s,r,l),rules:{ref:{method(o){t(!this.$_terms.link,"Cannot reinitialize schema"),o=h.ref(o),t(o.type==="value"||o.type==="local","Invalid reference type:",o.type),t(o.type==="local"||o.ancestor==="root"||o.ancestor>0,"Link cannot reference itself");const s=this.clone();return s.$_terms.link=[{ref:o}],s}},relative:{method(o=!0){return this.$_setFlag("relative",o)}}},overrides:{concat(o){t(this.$_terms.link,"Uninitialized link schema"),t(y.isSchema(o),"Invalid schema object"),t(o.type!=="link","Cannot merge type link with another link");const s=this.clone();return s.$_terms.whens||(s.$_terms.whens=[]),s.$_terms.whens.push({concat:o}),s.$_mutateRebuild()}},manifest:{build:(o,s)=>(t(s.link,"Invalid link description missing link"),o.ref(s.link))}}),i.generate=function(o,s,r,l){let a=r.mainstay.links.get(o);if(a)return a._generate(s,r,l).schema;const u=o.$_terms.link[0].ref,{perspective:f,path:p}=i.perspective(u,r);i.assert(f,"which is outside of schema boundaries",u,o,r,l);try{a=p.length?f.$_reach(p):f}catch(_){i.assert(!1,"to non-existing schema",u,o,r,l)}return i.assert(a.type!=="link","which is another link",u,o,r,l),o._flags.relative||r.mainstay.links.set(o,a),a._generate(s,r,l).schema},i.perspective=function(o,s){if(o.type==="local"){for(const{schema:r,key:l}of s.schemas){if((r._flags.id||l)===o.path[0])return{perspective:r,path:o.path.slice(1)};if(r.$_terms.shared){for(const a of r.$_terms.shared)if(a._flags.id===o.path[0])return{perspective:a,path:o.path.slice(1)}}}return{perspective:null,path:null}}return o.ancestor==="root"?{perspective:s.schemas[s.schemas.length-1].schema,path:o.path}:{perspective:s.schemas[o.ancestor]&&s.schemas[o.ancestor].schema,path:o.path}},i.assert=function(o,s,r,l,a,u){o||t(!1,'"'.concat(n.label(l._flags,a,u),'" contains link reference "').concat(r.display,'" ').concat(s))}},3832:(C,b,m)=>{const t=m(375),v=m(8068),y=m(8160),h={numberRx:/^\s*[+-]?(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:e([+-]?\d+))?\s*$/i,precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/,exponentialPartRegex:/[eE][+-]?\d+$/,leadingSignAndZerosRegex:/^[+-]?(0*)?/,dotRegex:/\./,trailingZerosRegex:/0+$/,decimalPlaces(n){const i=n.toString(),o=i.indexOf("."),s=i.indexOf("e");return(o<0?0:(s<0?i.length:s)-o-1)+(s<0?0:Math.max(0,-parseInt(i.slice(s+1))))}};C.exports=v.extend({type:"number",flags:{unsafe:{default:!1}},coerce:{from:"string",method(n,{schema:i,error:o}){if(!n.match(h.numberRx))return;n=n.trim();const s={value:parseFloat(n)};if(s.value===0&&(s.value=0),!i._flags.unsafe)if(n.match(/e/i)){if(h.extractSignificantDigits(n)!==h.extractSignificantDigits(String(s.value)))return s.errors=o("number.unsafe"),s}else{const r=s.value.toString();if(r.match(/e/i))return s;if(r!==h.normalizeDecimal(n))return s.errors=o("number.unsafe"),s}return s}},validate(n,{schema:i,error:o,prefs:s}){if(n===1/0||n===-1/0)return{value:n,errors:o("number.infinity")};if(!y.isNumber(n))return{value:n,errors:o("number.base")};const r={value:n};if(s.convert){const l=i.$_getRule("precision");if(l){const a=Math.pow(10,l.args.limit);r.value=Math.round(r.value*a)/a}}return r.value===0&&(r.value=0),!i._flags.unsafe&&(n>Number.MAX_SAFE_INTEGER||n<Number.MIN_SAFE_INTEGER)&&(r.errors=o("number.unsafe")),r},rules:{compare:{method:!1,validate:(n,i,{limit:o},{name:s,operator:r,args:l})=>y.compare(n,o,r)?n:i.error("number."+s,{limit:l.limit,value:n}),args:[{name:"limit",ref:!0,assert:y.isNumber,message:"must be a number"}]},greater:{method(n){return this.$_addRule({name:"greater",method:"compare",args:{limit:n},operator:">"})}},integer:{method(){return this.$_addRule("integer")},validate:(n,i)=>Math.trunc(n)-n==0?n:i.error("number.integer")},less:{method(n){return this.$_addRule({name:"less",method:"compare",args:{limit:n},operator:"<"})}},max:{method(n){return this.$_addRule({name:"max",method:"compare",args:{limit:n},operator:"<="})}},min:{method(n){return this.$_addRule({name:"min",method:"compare",args:{limit:n},operator:">="})}},multiple:{method(n){const i=typeof n=="number"?h.decimalPlaces(n):null,o=Math.pow(10,i);return this.$_addRule({name:"multiple",args:{base:n,baseDecimalPlace:i,pfactor:o}})},validate:(n,i,{base:o,baseDecimalPlace:s,pfactor:r},l)=>h.decimalPlaces(n)>s?i.error("number.multiple",{multiple:l.args.base,value:n}):Math.round(r*n)%Math.round(r*o)==0?n:i.error("number.multiple",{multiple:l.args.base,value:n}),args:[{name:"base",ref:!0,assert:n=>typeof n=="number"&&isFinite(n)&&n>0,message:"must be a positive number"},"baseDecimalPlace","pfactor"],multi:!0},negative:{method(){return this.sign("negative")}},port:{method(){return this.$_addRule("port")},validate:(n,i)=>Number.isSafeInteger(n)&&n>=0&&n<=65535?n:i.error("number.port")},positive:{method(){return this.sign("positive")}},precision:{method(n){return t(Number.isSafeInteger(n),"limit must be an integer"),this.$_addRule({name:"precision",args:{limit:n}})},validate(n,i,{limit:o}){const s=n.toString().match(h.precisionRx);return Math.max((s[1]?s[1].length:0)-(s[2]?parseInt(s[2],10):0),0)<=o?n:i.error("number.precision",{limit:o,value:n})},convert:!0},sign:{method(n){return t(["negative","positive"].includes(n),"Invalid sign",n),this.$_addRule({name:"sign",args:{sign:n}})},validate:(n,i,{sign:o})=>o==="negative"&&n<0||o==="positive"&&n>0?n:i.error("number.".concat(o))},unsafe:{method(n=!0){return t(typeof n=="boolean","enabled must be a boolean"),this.$_setFlag("unsafe",n)}}},cast:{string:{from:n=>typeof n=="number",to:(n,i)=>n.toString()}},messages:{"number.base":"{{#label}} must be a number","number.greater":"{{#label}} must be greater than {{#limit}}","number.infinity":"{{#label}} cannot be infinity","number.integer":"{{#label}} must be an integer","number.less":"{{#label}} must be less than {{#limit}}","number.max":"{{#label}} must be less than or equal to {{#limit}}","number.min":"{{#label}} must be greater than or equal to {{#limit}}","number.multiple":"{{#label}} must be a multiple of {{#multiple}}","number.negative":"{{#label}} must be a negative number","number.port":"{{#label}} must be a valid port","number.positive":"{{#label}} must be a positive number","number.precision":"{{#label}} must have no more than {{#limit}} decimal places","number.unsafe":"{{#label}} must be a safe number"}}),h.extractSignificantDigits=function(n){return n.replace(h.exponentialPartRegex,"").replace(h.dotRegex,"").replace(h.trailingZerosRegex,"").replace(h.leadingSignAndZerosRegex,"")},h.normalizeDecimal=function(n){return(n=n.replace(/^\+/,"").replace(/\.0*$/,"").replace(/^(-?)\.([^\.]*)$/,"$10.$2").replace(/^(-?)0+([0-9])/,"$1$2")).includes(".")&&n.endsWith("0")&&(n=n.replace(/0+$/,"")),n==="-0"?"0":n}},8966:(C,b,m)=>{const t=m(7824);C.exports=t.extend({type:"object",cast:{map:{from:v=>v&&typeof v=="object",to:(v,y)=>new Map(Object.entries(v))}}})},7417:(C,b,m)=>{const t=m(375),v=m(5380),y=m(1745),h=m(9959),n=m(6064),i=m(9926),o=m(5752),s=m(8068),r=m(8160),l={tlds:i instanceof Set&&{tlds:{allow:i,deny:null}},base64Regex:{true:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}==|[\w\-]{3}=)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/},false:{true:/^(?:[\w\-]{2}[\w\-]{2})*(?:[\w\-]{2}(==)?|[\w\-]{3}=?)?$/,false:/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/}},dataUriRegex:/^data:[\w+.-]+\/[\w+.-]+;((charset=[\w-]+|base64),)?(.*)$/,hexRegex:{withPrefix:/^0x[0-9a-f]+$/i,withOptionalPrefix:/^(?:0x)?[0-9a-f]+$/i,withoutPrefix:/^[0-9a-f]+$/i},ipRegex:h.regex({cidr:"forbidden"}).regex,isoDurationRegex:/^P(?!$)(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5",uuidv6:"6",uuidv7:"7",uuidv8:"8"},guidSeparators:new Set([void 0,!0,!1,"-",":"]),normalizationForms:["NFC","NFD","NFKC","NFKD"]};C.exports=s.extend({type:"string",flags:{insensitive:{default:!1},truncate:{default:!1}},terms:{replacements:{init:null}},coerce:{from:"string",method(a,{schema:u,state:f,prefs:p}){const _=u.$_getRule("normalize");_&&(a=a.normalize(_.args.form));const k=u.$_getRule("case");k&&(a=k.args.direction==="upper"?a.toLocaleUpperCase():a.toLocaleLowerCase());const E=u.$_getRule("trim");if(E&&E.args.enabled&&(a=a.trim()),u.$_terms.replacements)for(const R of u.$_terms.replacements)a=a.replace(R.pattern,R.replacement);const g=u.$_getRule("hex");if(g&&g.args.options.byteAligned&&a.length%2!=0&&(a="0".concat(a)),u.$_getRule("isoDate")){const R=l.isoDate(a);R&&(a=R)}if(u._flags.truncate){const R=u.$_getRule("max");if(R){let I=R.args.limit;if(r.isResolvable(I)&&(I=I.resolve(a,f,p),!r.limit(I)))return{value:a,errors:u.$_createError("any.ref",I,{ref:R.args.limit,arg:"limit",reason:"must be a positive integer"},f,p)};a=a.slice(0,I)}}return{value:a}}},validate(a,{schema:u,error:f}){if(typeof a!="string")return{value:a,errors:f("string.base")};if(a===""){const p=u.$_getRule("min");return p&&p.args.limit===0?void 0:{value:a,errors:f("string.empty")}}},rules:{alphanum:{method(){return this.$_addRule("alphanum")},validate:(a,u)=>/^[a-zA-Z0-9]+$/.test(a)?a:u.error("string.alphanum")},base64:{method(a={}){return r.assertOptions(a,["paddingRequired","urlSafe"]),a=q({urlSafe:!1,paddingRequired:!0},a),t(typeof a.paddingRequired=="boolean","paddingRequired must be boolean"),t(typeof a.urlSafe=="boolean","urlSafe must be boolean"),this.$_addRule({name:"base64",args:{options:a}})},validate:(a,u,{options:f})=>l.base64Regex[f.paddingRequired][f.urlSafe].test(a)?a:u.error("string.base64")},case:{method(a){return t(["lower","upper"].includes(a),"Invalid case:",a),this.$_addRule({name:"case",args:{direction:a}})},validate:(a,u,{direction:f})=>f==="lower"&&a===a.toLocaleLowerCase()||f==="upper"&&a===a.toLocaleUpperCase()?a:u.error("string.".concat(f,"case")),convert:!0},creditCard:{method(){return this.$_addRule("creditCard")},validate(a,u){let f=a.length,p=0,_=1;for(;f--;){const k=a.charAt(f)*_;p+=k-9*(k>9),_^=3}return p>0&&p%10==0?a:u.error("string.creditCard")}},dataUri:{method(a={}){return r.assertOptions(a,["paddingRequired"]),a=q({paddingRequired:!0},a),t(typeof a.paddingRequired=="boolean","paddingRequired must be boolean"),this.$_addRule({name:"dataUri",args:{options:a}})},validate(a,u,{options:f}){const p=a.match(l.dataUriRegex);return p&&(!p[2]||p[2]!=="base64"||l.base64Regex[f.paddingRequired].false.test(p[3]))?a:u.error("string.dataUri")}},domain:{method(a){a&&r.assertOptions(a,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const u=l.addressOptions(a);return this.$_addRule({name:"domain",args:{options:a},address:u})},validate:(a,u,f,{address:p})=>v.isValid(a,p)?a:u.error("string.domain")},email:{method(a={}){r.assertOptions(a,["allowFullyQualified","allowUnicode","ignoreLength","maxDomainSegments","minDomainSegments","multiple","separator","tlds"]),t(a.multiple===void 0||typeof a.multiple=="boolean","multiple option must be an boolean");const u=l.addressOptions(a),f=new RegExp("\\s*[".concat(a.separator?n(a.separator):",","]\\s*"));return this.$_addRule({name:"email",args:{options:a},regex:f,address:u})},validate(a,u,{options:f},{regex:p,address:_}){const k=f.multiple?a.split(p):[a],E=[];for(const g of k)y.isValid(g,_)||E.push(g);return E.length?u.error("string.email",{value:a,invalids:E}):a}},guid:{alias:"uuid",method(a={}){r.assertOptions(a,["version","separator"]);let u="";if(a.version){const _=[].concat(a.version);t(_.length>=1,"version must have at least 1 valid version specified");const k=new Set;for(let E=0;E<_.length;++E){const g=_[E];t(typeof g=="string","version at position "+E+" must be a string");const R=l.guidVersions[g.toLowerCase()];t(R,"version at position "+E+" must be one of "+Object.keys(l.guidVersions).join(", ")),t(!k.has(R),"version at position "+E+" must not be a duplicate"),u+=R,k.add(R)}}t(l.guidSeparators.has(a.separator),'separator must be one of true, false, "-", or ":"');const f=a.separator===void 0?"[:-]?":a.separator===!0?"[:-]":a.separator===!1?"[]?":"\\".concat(a.separator),p=new RegExp("^([\\[{\\(]?)[0-9A-F]{8}(".concat(f,")[0-9A-F]{4}\\2?[").concat(u||"0-9A-F","][0-9A-F]{3}\\2?[").concat(u?"89AB":"0-9A-F","][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$"),"i");return this.$_addRule({name:"guid",args:{options:a},regex:p})},validate(a,u,f,{regex:p}){const _=p.exec(a);return _?l.guidBrackets[_[1]]!==_[_.length-1]?u.error("string.guid"):a:u.error("string.guid")}},hex:{method(a={}){return r.assertOptions(a,["byteAligned","prefix"]),a=q({byteAligned:!1,prefix:!1},a),t(typeof a.byteAligned=="boolean","byteAligned must be boolean"),t(typeof a.prefix=="boolean"||a.prefix==="optional",'prefix must be boolean or "optional"'),this.$_addRule({name:"hex",args:{options:a}})},validate:(a,u,{options:f})=>(f.prefix==="optional"?l.hexRegex.withOptionalPrefix:f.prefix===!0?l.hexRegex.withPrefix:l.hexRegex.withoutPrefix).test(a)?f.byteAligned&&a.length%2!=0?u.error("string.hexAlign"):a:u.error("string.hex")},hostname:{method(){return this.$_addRule("hostname")},validate:(a,u)=>v.isValid(a,{minDomainSegments:1})||l.ipRegex.test(a)?a:u.error("string.hostname")},insensitive:{method(){return this.$_setFlag("insensitive",!0)}},ip:{method(a={}){r.assertOptions(a,["cidr","version"]);const{cidr:u,versions:f,regex:p}=h.regex(a),_=a.version?f:void 0;return this.$_addRule({name:"ip",args:{options:{cidr:u,version:_}},regex:p})},validate:(a,u,{options:f},{regex:p})=>p.test(a)?a:f.version?u.error("string.ipVersion",{value:a,cidr:f.cidr,version:f.version}):u.error("string.ip",{value:a,cidr:f.cidr})},isoDate:{method(){return this.$_addRule("isoDate")},validate:(a,{error:u})=>l.isoDate(a)?a:u("string.isoDate")},isoDuration:{method(){return this.$_addRule("isoDuration")},validate:(a,u)=>l.isoDurationRegex.test(a)?a:u.error("string.isoDuration")},length:{method(a,u){return l.length(this,"length",a,"=",u)},validate(a,u,{limit:f,encoding:p},{name:_,operator:k,args:E}){const g=!p&&a.length;return r.compare(g,f,k)?a:u.error("string."+_,{limit:E.limit,value:a,encoding:p})},args:[{name:"limit",ref:!0,assert:r.limit,message:"must be a positive integer"},"encoding"]},lowercase:{method(){return this.case("lower")}},max:{method(a,u){return l.length(this,"max",a,"<=",u)},args:["limit","encoding"]},min:{method(a,u){return l.length(this,"min",a,">=",u)},args:["limit","encoding"]},normalize:{method(a="NFC"){return t(l.normalizationForms.includes(a),"normalization form must be one of "+l.normalizationForms.join(", ")),this.$_addRule({name:"normalize",args:{form:a}})},validate:(a,{error:u},{form:f})=>a===a.normalize(f)?a:u("string.normalize",{value:a,form:f}),convert:!0},pattern:{alias:"regex",method(a,u={}){t(a instanceof RegExp,"regex must be a RegExp"),t(!a.flags.includes("g")&&!a.flags.includes("y"),"regex should not use global or sticky mode"),typeof u=="string"&&(u={name:u}),r.assertOptions(u,["invert","name"]);const f=["string.pattern",u.invert?".invert":"",u.name?".name":".base"].join("");return this.$_addRule({name:"pattern",args:{regex:a,options:u},errorCode:f})},validate:(a,u,{regex:f,options:p},{errorCode:_})=>f.test(a)^p.invert?a:u.error(_,{name:p.name,regex:f,value:a}),args:["regex","options"],multi:!0},replace:{method(a,u){typeof a=="string"&&(a=new RegExp(n(a),"g")),t(a instanceof RegExp,"pattern must be a RegExp"),t(typeof u=="string","replacement must be a String");const f=this.clone();return f.$_terms.replacements||(f.$_terms.replacements=[]),f.$_terms.replacements.push({pattern:a,replacement:u}),f}},token:{method(){return this.$_addRule("token")},validate:(a,u)=>/^\w+$/.test(a)?a:u.error("string.token")},trim:{method(a=!0){return t(typeof a=="boolean","enabled must be a boolean"),this.$_addRule({name:"trim",args:{enabled:a}})},validate:(a,u,{enabled:f})=>f&&a!==a.trim()?u.error("string.trim"):a,convert:!0},truncate:{method(a=!0){return t(typeof a=="boolean","enabled must be a boolean"),this.$_setFlag("truncate",a)}},uppercase:{method(){return this.case("upper")}},uri:{method(a={}){r.assertOptions(a,["allowRelative","allowQuerySquareBrackets","domain","relativeOnly","scheme","encodeUri"]),a.domain&&r.assertOptions(a.domain,["allowFullyQualified","allowUnicode","maxDomainSegments","minDomainSegments","tlds"]);const{regex:u,scheme:f}=o.regex(a),p=a.domain?l.addressOptions(a.domain):null;return this.$_addRule({name:"uri",args:{options:a},regex:u,domain:p,scheme:f})},validate(a,u,{options:f},{regex:p,domain:_,scheme:k}){if(["http:/","https:/"].includes(a))return u.error("string.uri");let E=p.exec(a);if(!E&&u.prefs.convert&&f.encodeUri){const g=encodeURI(a);E=p.exec(g),E&&(a=g)}if(E){const g=E[1]||E[2];return!_||f.allowRelative&&!g||v.isValid(g,_)?a:u.error("string.domain",{value:g})}return f.relativeOnly?u.error("string.uriRelativeOnly"):f.scheme?u.error("string.uriCustomScheme",{scheme:k,value:a}):u.error("string.uri")}}},manifest:{build(a,u){if(u.replacements)for(const{pattern:f,replacement:p}of u.replacements)a=a.replace(f,p);return a}},messages:{"string.alphanum":"{{#label}} must only contain alpha-numeric characters","string.base":"{{#label}} must be a string","string.base64":"{{#label}} must be a valid base64 string","string.creditCard":"{{#label}} must be a credit card","string.dataUri":"{{#label}} must be a valid dataUri string","string.domain":"{{#label}} must contain a valid domain name","string.email":"{{#label}} must be a valid email","string.empty":"{{#label}} is not allowed to be empty","string.guid":"{{#label}} must be a valid GUID","string.hex":"{{#label}} must only contain hexadecimal characters","string.hexAlign":"{{#label}} hex decoded representation must be byte aligned","string.hostname":"{{#label}} must be a valid hostname","string.ip":"{{#label}} must be a valid ip address with a {{#cidr}} CIDR","string.ipVersion":"{{#label}} must be a valid ip address of one of the following versions {{#version}} with a {{#cidr}} CIDR","string.isoDate":"{{#label}} must be in iso format","string.isoDuration":"{{#label}} must be a valid ISO 8601 duration","string.length":"{{#label}} length must be {{#limit}} characters long","string.lowercase":"{{#label}} must only contain lowercase characters","string.max":"{{#label}} length must be less than or equal to {{#limit}} characters long","string.min":"{{#label}} length must be at least {{#limit}} characters long","string.normalize":"{{#label}} must be unicode normalized in the {{#form}} form","string.token":"{{#label}} must only contain alpha-numeric and underscore characters","string.pattern.base":"{{#label}} with value {:[.]} fails to match the required pattern: {{#regex}}","string.pattern.name":"{{#label}} with value {:[.]} fails to match the {{#name}} pattern","string.pattern.invert.base":"{{#label}} with value {:[.]} matches the inverted pattern: {{#regex}}","string.pattern.invert.name":"{{#label}} with value {:[.]} matches the inverted {{#name}} pattern","string.trim":"{{#label}} must not have leading or trailing whitespace","string.uri":"{{#label}} must be a valid uri","string.uriCustomScheme":"{{#label}} must be a valid uri with a scheme matching the {{#scheme}} pattern","string.uriRelativeOnly":"{{#label}} must be a valid relative uri","string.uppercase":"{{#label}} must only contain uppercase characters"}}),l.addressOptions=function(a){if(!a)return l.tlds||a;if(t(a.minDomainSegments===void 0||Number.isSafeInteger(a.minDomainSegments)&&a.minDomainSegments>0,"minDomainSegments must be a positive integer"),t(a.maxDomainSegments===void 0||Number.isSafeInteger(a.maxDomainSegments)&&a.maxDomainSegments>0,"maxDomainSegments must be a positive integer"),a.tlds===!1)return a;if(a.tlds===!0||a.tlds===void 0)return t(l.tlds,"Built-in TLD list disabled"),Object.assign({},a,l.tlds);t(typeof a.tlds=="object","tlds must be true, false, or an object");const u=a.tlds.deny;if(u)return Array.isArray(u)&&(a=Object.assign({},a,{tlds:{deny:new Set(u)}})),t(a.tlds.deny instanceof Set,"tlds.deny must be an array, Set, or boolean"),t(!a.tlds.allow,"Cannot specify both tlds.allow and tlds.deny lists"),l.validateTlds(a.tlds.deny,"tlds.deny"),a;const f=a.tlds.allow;return f?f===!0?(t(l.tlds,"Built-in TLD list disabled"),Object.assign({},a,l.tlds)):(Array.isArray(f)&&(a=Object.assign({},a,{tlds:{allow:new Set(f)}})),t(a.tlds.allow instanceof Set,"tlds.allow must be an array, Set, or boolean"),l.validateTlds(a.tlds.allow,"tlds.allow"),a):a},l.validateTlds=function(a,u){for(const f of a)t(v.isValid(f,{minDomainSegments:1,maxDomainSegments:1}),"".concat(u," must contain valid top level domain names"))},l.isoDate=function(a){if(!r.isIsoDate(a))return null;/.*T.*[+-]\d\d$/.test(a)&&(a+="00");const u=new Date(a);return isNaN(u.getTime())?null:u.toISOString()},l.length=function(a,u,f,p,_){return t(!_||!1,"Invalid encoding:",_),a.$_addRule({name:u,method:"length",args:{limit:f,encoding:_},operator:p})}},8826:(C,b,m)=>{const t=m(375),v=m(8068),y={};y.Map=class extends Map{slice(){return new y.Map(this)}},C.exports=v.extend({type:"symbol",terms:{map:{init:new y.Map}},coerce:{method(h,{schema:n,error:i}){const o=n.$_terms.map.get(h);return o&&(h=o),n._flags.only&&typeof h!="symbol"?{value:h,errors:i("symbol.map",{map:n.$_terms.map})}:{value:h}}},validate(h,{error:n}){if(typeof h!="symbol")return{value:h,errors:n("symbol.base")}},rules:{map:{method(h){h&&!h[Symbol.iterator]&&typeof h=="object"&&(h=Object.entries(h)),t(h&&h[Symbol.iterator],"Iterable must be an iterable or object");const n=this.clone(),i=[];for(const o of h){t(o&&o[Symbol.iterator],"Entry must be an iterable");const[s,r]=o;t(typeof s!="object"&&typeof s!="function"&&typeof s!="symbol","Key must not be of type object, function, or Symbol"),t(typeof r=="symbol","Value must be a Symbol"),n.$_terms.map.set(s,r),i.push(r)}return n.valid(...i)}}},manifest:{build:(h,n)=>(n.map&&(h=h.map(n.map)),h)},messages:{"symbol.base":"{{#label}} must be a symbol","symbol.map":"{{#label}} must be one of {{#map}}"}})},8863:(C,b,m)=>{const t=m(375),v=m(8571),y=m(738),h=m(9621),n=m(8160),i=m(6354),o=m(493),s={result:Symbol("result")};b.entry=function(r,l,a){let u=n.defaults;a&&(t(a.warnings===void 0,"Cannot override warnings preference in synchronous validation"),t(a.artifacts===void 0,"Cannot override artifacts preference in synchronous validation"),u=n.preferences(n.defaults,a));const f=s.entry(r,l,u);t(!f.mainstay.externals.length,"Schema with external rules must use validateAsync()");const p={value:f.value};return f.error&&(p.error=f.error),f.mainstay.warnings.length&&(p.warning=i.details(f.mainstay.warnings)),f.mainstay.debug&&(p.debug=f.mainstay.debug),f.mainstay.artifacts&&(p.artifacts=f.mainstay.artifacts),p},b.entryAsync=async function(r,l,a){let u=n.defaults;a&&(u=n.preferences(n.defaults,a));const f=s.entry(r,l,u),p=f.mainstay;if(f.error)throw p.debug&&(f.error.debug=p.debug),f.error;if(p.externals.length){let k=f.value;const E=[];for(const g of p.externals){const R=g.state.path,I=g.schema.type==="link"?p.links.get(g.schema):null;let A,O,N=k;const V=R.length?[k]:[],B=R.length?h(r,R):r;if(R.length){A=R[R.length-1];let Z=k;for(const M of R.slice(0,-1))Z=Z[M],V.unshift(Z);O=V[0],N=O[A]}try{const Z=(F,X)=>(I||g.schema).$_createError(F,N,X,g.state,u),M=await g.method(N,{schema:g.schema,linked:I,state:g.state,prefs:a,original:B,error:Z,errorsArray:s.errorsArray,warn:(F,X)=>p.warnings.push((I||g.schema).$_createError(F,N,X,g.state,u)),message:(F,X)=>(I||g.schema).$_createError("external",N,X,g.state,u,{messages:F})});if(M===void 0||M===N)continue;if(M instanceof i.Report){if(p.tracer.log(g.schema,g.state,"rule","external","error"),E.push(M),u.abortEarly)break;continue}if(Array.isArray(M)&&M[n.symbols.errors]){if(p.tracer.log(g.schema,g.state,"rule","external","error"),E.push(...M),u.abortEarly)break;continue}O?(p.tracer.value(g.state,"rule",N,M,"external"),O[A]=M):(p.tracer.value(g.state,"rule",k,M,"external"),k=M)}catch(Z){throw u.errors.label&&(Z.message+=" (".concat(g.label,")")),Z}}if(f.value=k,E.length)throw f.error=i.process(E,r,u),p.debug&&(f.error.debug=p.debug),f.error}if(!u.warnings&&!u.debug&&!u.artifacts)return f.value;const _={value:f.value};return p.warnings.length&&(_.warning=i.details(p.warnings)),p.debug&&(_.debug=p.debug),p.artifacts&&(_.artifacts=p.artifacts),_},s.Mainstay=class{constructor(r,l,a){this.externals=[],this.warnings=[],this.tracer=r,this.debug=l,this.links=a,this.shadow=null,this.artifacts=null,this._snapshots=[]}snapshot(){this._snapshots.push({externals:this.externals.slice(),warnings:this.warnings.slice()})}restore(){const r=this._snapshots.pop();this.externals=r.externals,this.warnings=r.warnings}commit(){this._snapshots.pop()}},s.entry=function(r,l,a){const{tracer:u,cleanup:f}=s.tracer(l,a),p=a.debug?[]:null,_=l._ids._schemaChain?new Map:null,k=new s.Mainstay(u,p,_),E=l._ids._schemaChain?[{schema:l}]:null,g=new o([],[],{mainstay:k,schemas:E}),R=b.validate(r,l,g,a);f&&l.$_root.untrace();const I=i.process(R.errors,r,a);return{value:R.value,error:I,mainstay:k}},s.tracer=function(r,l){return r.$_root._tracer?{tracer:r.$_root._tracer._register(r)}:l.debug?(t(r.$_root.trace,"Debug mode not supported"),{tracer:r.$_root.trace()._register(r),cleanup:!0}):{tracer:s.ignore}},b.validate=function(r,l,a,u,f={}){if(l.$_terms.whens&&(l=l._generate(r,a,u).schema),l._preferences&&(u=s.prefs(l,u)),l._cache&&u.cache){const I=l._cache.get(r);if(a.mainstay.tracer.debug(a,"validate","cached",!!I),I)return I}const p=(I,A,O)=>l.$_createError(I,r,A,O||a,u),_={original:r,prefs:u,schema:l,state:a,error:p,errorsArray:s.errorsArray,warn:(I,A,O)=>a.mainstay.warnings.push(p(I,A,O)),message:(I,A)=>l.$_createError("custom",r,A,a,u,{messages:I})};a.mainstay.tracer.entry(l,a);const k=l._definition;if(k.prepare&&r!==void 0&&u.convert){const I=k.prepare(r,_);if(I){if(a.mainstay.tracer.value(a,"prepare",r,I.value),I.errors)return s.finalize(I.value,[].concat(I.errors),_);r=I.value}}if(k.coerce&&r!==void 0&&u.convert&&(!k.coerce.from||k.coerce.from.includes(typeof r))){const I=k.coerce.method(r,_);if(I){if(a.mainstay.tracer.value(a,"coerced",r,I.value),I.errors)return s.finalize(I.value,[].concat(I.errors),_);r=I.value}}const E=l._flags.empty;E&&E.$_match(s.trim(r,l),a.nest(E),n.defaults)&&(a.mainstay.tracer.value(a,"empty",r,void 0),r=void 0);const g=f.presence||l._flags.presence||(l._flags._endedSwitch?null:u.presence);if(r===void 0){if(g==="forbidden")return s.finalize(r,null,_);if(g==="required")return s.finalize(r,[l.$_createError("any.required",r,null,a,u)],_);if(g==="optional"){if(l._flags.default!==n.symbols.deepDefault)return s.finalize(r,null,_);a.mainstay.tracer.value(a,"default",r,{}),r={}}}else if(g==="forbidden")return s.finalize(r,[l.$_createError("any.unknown",r,null,a,u)],_);const R=[];if(l._valids){const I=l._valids.get(r,a,u,l._flags.insensitive);if(I)return u.convert&&(a.mainstay.tracer.value(a,"valids",r,I.value),r=I.value),a.mainstay.tracer.filter(l,a,"valid",I),s.finalize(r,null,_);if(l._flags.only){const A=l.$_createError("any.only",r,{valids:l._valids.values({display:!0})},a,u);if(u.abortEarly)return s.finalize(r,[A],_);R.push(A)}}if(l._invalids){const I=l._invalids.get(r,a,u,l._flags.insensitive);if(I){a.mainstay.tracer.filter(l,a,"invalid",I);const A=l.$_createError("any.invalid",r,{invalids:l._invalids.values({display:!0})},a,u);if(u.abortEarly)return s.finalize(r,[A],_);R.push(A)}}if(k.validate){const I=k.validate(r,_);if(I&&(a.mainstay.tracer.value(a,"base",r,I.value),r=I.value,I.errors)){if(!Array.isArray(I.errors))return R.push(I.errors),s.finalize(r,R,_);if(I.errors.length)return R.push(...I.errors),s.finalize(r,R,_)}}return l._rules.length?s.rules(r,R,_):s.finalize(r,R,_)},s.rules=function(r,l,a){const{schema:u,state:f,prefs:p}=a;for(const _ of u._rules){const k=u._definition.rules[_.method];if(k.convert&&p.convert){f.mainstay.tracer.log(u,f,"rule",_.name,"full");continue}let E,g=_.args;if(_._resolve.length){g=Object.assign({},g);for(const I of _._resolve){const A=k.argsByName.get(I),O=g[I].resolve(r,f,p),N=A.normalize?A.normalize(O):O,V=n.validateArg(N,null,A);if(V){E=u.$_createError("any.ref",O,{arg:I,ref:g[I],reason:V},f,p);break}g[I]=N}}E=E||k.validate(r,a,g,_);const R=s.rule(E,_);if(R.errors){if(f.mainstay.tracer.log(u,f,"rule",_.name,"error"),_.warn){f.mainstay.warnings.push(...R.errors);continue}if(p.abortEarly)return s.finalize(r,R.errors,a);l.push(...R.errors)}else f.mainstay.tracer.log(u,f,"rule",_.name,"pass"),f.mainstay.tracer.value(f,"rule",r,R.value,_.name),r=R.value}return s.finalize(r,l,a)},s.rule=function(r,l){return r instanceof i.Report?(s.error(r,l),{errors:[r],value:null}):Array.isArray(r)&&r[n.symbols.errors]?(r.forEach(a=>s.error(a,l)),{errors:r,value:null}):{errors:null,value:r}},s.error=function(r,l){return l.message&&r._setTemplate(l.message),r},s.finalize=function(r,l,a){l=l||[];const{schema:u,state:f,prefs:p}=a;if(l.length){const k=s.default("failover",void 0,l,a);k!==void 0&&(f.mainstay.tracer.value(f,"failover",r,k),r=k,l=[])}if(l.length&&u._flags.error)if(typeof u._flags.error=="function"){l=u._flags.error(l),Array.isArray(l)||(l=[l]);for(const k of l)t(k instanceof Error||k instanceof i.Report,"error() must return an Error object")}else l=[u._flags.error];if(r===void 0){const k=s.default("default",r,l,a);f.mainstay.tracer.value(f,"default",r,k),r=k}if(u._flags.cast&&r!==void 0){const k=u._definition.cast[u._flags.cast];if(k.from(r)){const E=k.to(r,a);f.mainstay.tracer.value(f,"cast",r,E,u._flags.cast),r=E}}if(u.$_terms.externals&&p.externals&&p._externals!==!1)for(const{method:k}of u.$_terms.externals)f.mainstay.externals.push({method:k,schema:u,state:f,label:i.label(u._flags,f,p)});const _={value:r,errors:l.length?l:null};return u._flags.result&&(_.value=u._flags.result==="strip"?void 0:a.original,f.mainstay.tracer.value(f,u._flags.result,r,_.value),f.shadow(r,u._flags.result)),u._cache&&p.cache!==!1&&!u._refs.length&&u._cache.set(a.original,_),r===void 0||_.errors||u._flags.artifact===void 0||(f.mainstay.artifacts=f.mainstay.artifacts||new Map,f.mainstay.artifacts.has(u._flags.artifact)||f.mainstay.artifacts.set(u._flags.artifact,[]),f.mainstay.artifacts.get(u._flags.artifact).push(f.path)),_},s.prefs=function(r,l){const a=l===n.defaults;return a&&r._preferences[n.symbols.prefs]?r._preferences[n.symbols.prefs]:(l=n.preferences(l,r._preferences),a&&(r._preferences[n.symbols.prefs]=l),l)},s.default=function(r,l,a,u){const{schema:f,state:p,prefs:_}=u,k=f._flags[r];if(_.noDefaults||k===void 0)return l;if(p.mainstay.tracer.log(f,p,"rule",r,"full"),!k)return k;if(typeof k=="function"){const E=k.length?[v(p.ancestors[0]),u]:[];try{return k(...E)}catch(g){return void a.push(f.$_createError("any.".concat(r),null,{error:g},p,_))}}return typeof k!="object"?k:k[n.symbols.literal]?k.literal:n.isResolvable(k)?k.resolve(l,p,_):v(k)},s.trim=function(r,l){if(typeof r!="string")return r;const a=l.$_getRule("trim");return a&&a.args.enabled?r.trim():r},s.ignore={active:!1,debug:y,entry:y,filter:y,log:y,resolve:y,value:y},s.errorsArray=function(){const r=[];return r[n.symbols.errors]=!0,r}},2036:(C,b,m)=>{const t=m(375),v=m(9474),y=m(8160),h={};C.exports=h.Values=class{constructor(n,i){this._values=new Set(n),this._refs=new Set(i),this._lowercase=h.lowercases(n),this._override=!1}get length(){return this._values.size+this._refs.size}add(n,i){y.isResolvable(n)?this._refs.has(n)||(this._refs.add(n),i&&i.register(n)):this.has(n,null,null,!1)||(this._values.add(n),typeof n=="string"&&this._lowercase.set(n.toLowerCase(),n))}static merge(n,i,o){if(n=n||new h.Values,i){if(i._override)return i.clone();for(const s of[...i._values,...i._refs])n.add(s)}if(o)for(const s of[...o._values,...o._refs])n.remove(s);return n.length?n:null}remove(n){y.isResolvable(n)?this._refs.delete(n):(this._values.delete(n),typeof n=="string"&&this._lowercase.delete(n.toLowerCase()))}has(n,i,o,s){return!!this.get(n,i,o,s)}get(n,i,o,s){if(!this.length)return!1;if(this._values.has(n))return{value:n};if(typeof n=="string"&&n&&s){const r=this._lowercase.get(n.toLowerCase());if(r)return{value:r}}if(!this._refs.size&&typeof n!="object")return!1;if(typeof n=="object"){for(const r of this._values)if(v(r,n))return{value:r}}if(i)for(const r of this._refs){const l=r.resolve(n,i,o,null,{in:!0});if(l===void 0)continue;const a=r.in&&typeof l=="object"?Array.isArray(l)?l:Object.keys(l):[l];for(const u of a)if(typeof u==typeof n){if(s&&n&&typeof n=="string"){if(u.toLowerCase()===n.toLowerCase())return{value:u,ref:r}}else if(v(u,n))return{value:u,ref:r}}}return!1}override(){this._override=!0}values(n){if(n&&n.display){const i=[];for(const o of[...this._values,...this._refs])o!==void 0&&i.push(o);return i}return Array.from([...this._values,...this._refs])}clone(){const n=new h.Values(this._values,this._refs);return n._override=this._override,n}concat(n){t(!n._override,"Cannot concat override set of values");const i=new h.Values([...this._values,...n._values],[...this._refs,...n._refs]);return i._override=this._override,i}describe(){const n=[];this._override&&n.push({override:!0});for(const i of this._values.values())n.push(i&&typeof i=="object"?{value:i}:i);for(const i of this._refs.values())n.push(i.describe());return n}},h.Values.prototype[y.symbols.values]=!0,h.Values.prototype.slice=h.Values.prototype.clone,h.lowercases=function(n){const i=new Map;if(n)for(const o of n)typeof o=="string"&&i.set(o.toLowerCase(),o);return i}},978:(C,b,m)=>{const t=m(375),v=m(8571),y=m(1687),h=m(9621),n={};C.exports=function(i,o,s={}){if(t(i&&typeof i=="object","Invalid defaults value: must be an object"),t(!o||o===!0||typeof o=="object","Invalid source value: must be true, falsy or an object"),t(typeof s=="object","Invalid options: must be an object"),!o)return null;if(s.shallow)return n.applyToDefaultsWithShallow(i,o,s);const r=v(i);if(o===!0)return r;const l=s.nullOverride!==void 0&&s.nullOverride;return y(r,o,{nullOverride:l,mergeArrays:!1})},n.applyToDefaultsWithShallow=function(i,o,s){const r=s.shallow;t(Array.isArray(r),"Invalid keys");const l=new Map,a=o===!0?null:new Set;for(let p of r){p=Array.isArray(p)?p:p.split(".");const _=h(i,p);_&&typeof _=="object"?l.set(_,a&&h(o,p)||_):a&&a.add(p)}const u=v(i,{},l);if(!a)return u;for(const p of a)n.reachCopy(u,o,p);const f=s.nullOverride!==void 0&&s.nullOverride;return y(u,o,{nullOverride:f,mergeArrays:!1})},n.reachCopy=function(i,o,s){for(const a of s){if(!(a in o))return;const u=o[a];if(typeof u!="object"||u===null)return;o=u}const r=o;let l=i;for(let a=0;a<s.length-1;++a){const u=s[a];typeof l[u]!="object"&&(l[u]={}),l=l[u]}l[s[s.length-1]]=r}},375:(C,b,m)=>{const t=m(7916);C.exports=function(v,...y){if(!v)throw y.length===1&&y[0]instanceof Error?y[0]:new t(y)}},8571:(C,b,m)=>{const t=m(9621),v=m(4277),y=m(7043),h={needsProtoHack:new Set([v.set,v.map,v.weakSet,v.weakMap])};C.exports=h.clone=function(n,i={},o=null){if(typeof n!="object"||n===null)return n;let s=h.clone,r=o;if(i.shallow){if(i.shallow!==!0)return h.cloneWithShallow(n,i);s=f=>f}else if(r){const f=r.get(n);if(f)return f}else r=new Map;const l=v.getInternalProto(n);if(l===v.buffer)return!1;if(l===v.date)return new Date(n.getTime());if(l===v.regex)return new RegExp(n);const a=h.base(n,l,i);if(a===n)return n;if(r&&r.set(n,a),l===v.set)for(const f of n)a.add(s(f,i,r));else if(l===v.map)for(const[f,p]of n)a.set(f,s(p,i,r));const u=y.keys(n,i);for(const f of u){if(f==="__proto__")continue;if(l===v.array&&f==="length"){a.length=n.length;continue}const p=Object.getOwnPropertyDescriptor(n,f);p?p.get||p.set?Object.defineProperty(a,f,p):p.enumerable?a[f]=s(n[f],i,r):Object.defineProperty(a,f,{enumerable:!1,writable:!0,configurable:!0,value:s(n[f],i,r)}):Object.defineProperty(a,f,{enumerable:!0,writable:!0,configurable:!0,value:s(n[f],i,r)})}return a},h.cloneWithShallow=function(n,i){const o=i.shallow;(i=Object.assign({},i)).shallow=!1;const s=new Map;for(const r of o){const l=t(n,r);typeof l!="object"&&typeof l!="function"||s.set(l,l)}return h.clone(n,i,s)},h.base=function(n,i,o){if(o.prototype===!1)return h.needsProtoHack.has(i)?new i.constructor:i===v.array?[]:{};const s=Object.getPrototypeOf(n);if(s&&s.isImmutable)return n;if(i===v.array){const r=[];return s!==i&&Object.setPrototypeOf(r,s),r}if(h.needsProtoHack.has(i)){const r=new s.constructor;return s!==i&&Object.setPrototypeOf(r,s),r}return Object.create(s)}},9474:(C,b,m)=>{const t=m(4277),v={mismatched:null};C.exports=function(y,h,n){return n=Object.assign({prototype:!0},n),!!v.isDeepEqual(y,h,n,[])},v.isDeepEqual=function(y,h,n,i){if(y===h)return y!==0||1/y==1/h;const o=typeof y;if(o!==typeof h||y===null||h===null)return!1;if(o==="function"){if(!n.deepFunction||y.toString()!==h.toString())return!1}else if(o!=="object")return y!=y&&h!=h;const s=v.getSharedType(y,h,!!n.prototype);switch(s){case t.buffer:return!1;case t.promise:return y===h;case t.regex:return y.toString()===h.toString();case v.mismatched:return!1}for(let r=i.length-1;r>=0;--r)if(i[r].isSame(y,h))return!0;i.push(new v.SeenEntry(y,h));try{return!!v.isDeepEqualObj(s,y,h,n,i)}finally{i.pop()}},v.getSharedType=function(y,h,n){if(n)return Object.getPrototypeOf(y)!==Object.getPrototypeOf(h)?v.mismatched:t.getInternalProto(y);const i=t.getInternalProto(y);return i!==t.getInternalProto(h)?v.mismatched:i},v.valueOf=function(y){const h=y.valueOf;if(h===void 0)return y;try{return h.call(y)}catch(n){return n}},v.hasOwnEnumerableProperty=function(y,h){return Object.prototype.propertyIsEnumerable.call(y,h)},v.isSetSimpleEqual=function(y,h){for(const n of Set.prototype.values.call(y))if(!Set.prototype.has.call(h,n))return!1;return!0},v.isDeepEqualObj=function(y,h,n,i,o){const{isDeepEqual:s,valueOf:r,hasOwnEnumerableProperty:l}=v,{keys:a,getOwnPropertySymbols:u}=Object;if(y===t.array){if(!i.part){if(h.length!==n.length)return!1;for(let E=0;E<h.length;++E)if(!s(h[E],n[E],i,o))return!1;return!0}for(const E of h)for(const g of n)if(s(E,g,i,o))return!0}else if(y===t.set){if(h.size!==n.size)return!1;if(!v.isSetSimpleEqual(h,n)){const E=new Set(Set.prototype.values.call(n));for(const g of Set.prototype.values.call(h)){if(E.delete(g))continue;let R=!1;for(const I of E)if(s(g,I,i,o)){E.delete(I),R=!0;break}if(!R)return!1}}}else if(y===t.map){if(h.size!==n.size)return!1;for(const[E,g]of Map.prototype.entries.call(h))if(g===void 0&&!Map.prototype.has.call(n,E)||!s(g,Map.prototype.get.call(n,E),i,o))return!1}else if(y===t.error&&(h.name!==n.name||h.message!==n.message))return!1;const f=r(h),p=r(n);if((h!==f||n!==p)&&!s(f,p,i,o))return!1;const _=a(h);if(!i.part&&_.length!==a(n).length&&!i.skip)return!1;let k=0;for(const E of _)if(i.skip&&i.skip.includes(E))n[E]===void 0&&++k;else if(!l(n,E)||!s(h[E],n[E],i,o))return!1;if(!i.part&&_.length-k!==a(n).length)return!1;if(i.symbols!==!1){const E=u(h),g=new Set(u(n));for(const R of E){if(!i.skip||!i.skip.includes(R)){if(l(h,R)){if(!l(n,R)||!s(h[R],n[R],i,o))return!1}else if(l(n,R))return!1}g.delete(R)}for(const R of g)if(l(n,R))return!1}return!0},v.SeenEntry=class{constructor(y,h){this.obj=y,this.ref=h}isSame(y,h){return this.obj===y&&this.ref===h}}},7916:(C,b,m)=>{const t=m(8761);C.exports=class extends Error{constructor(v){super(v.filter(y=>y!=="").map(y=>typeof y=="string"?y:y instanceof Error?y.message:t(y)).join(" ")||"Unknown error"),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,b.assert)}}},5277:C=>{const b={};C.exports=function(m){if(!m)return"";let t="";for(let v=0;v<m.length;++v){const y=m.charCodeAt(v);b.isSafe(y)?t+=m[v]:t+=b.escapeHtmlChar(y)}return t},b.escapeHtmlChar=function(m){return b.namedHtml.get(m)||(m>=256?"&#"+m+";":"&#x".concat(m.toString(16).padStart(2,"0"),";"))},b.isSafe=function(m){return b.safeCharCodes.has(m)},b.namedHtml=new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[34,"&quot;"],[160,"&nbsp;"],[162,"&cent;"],[163,"&pound;"],[164,"&curren;"],[169,"&copy;"],[174,"&reg;"]]),b.safeCharCodes=function(){const m=new Set;for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||t===32||t===46||t===44||t===45||t===58||t===95)&&m.add(t);return m}()},6064:C=>{C.exports=function(b){return b.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")}},738:C=>{C.exports=function(){}},1687:(C,b,m)=>{const t=m(375),v=m(8571),y=m(7043),h={};C.exports=h.merge=function(n,i,o){if(t(n&&typeof n=="object","Invalid target value: must be an object"),t(i==null||typeof i=="object","Invalid source value: must be null, undefined, or an object"),!i)return n;if(o=Object.assign({nullOverride:!0,mergeArrays:!0},o),Array.isArray(i)){t(Array.isArray(n),"Cannot merge array onto an object"),o.mergeArrays||(n.length=0);for(let r=0;r<i.length;++r)n.push(v(i[r],{symbols:o.symbols}));return n}const s=y.keys(i,o);for(let r=0;r<s.length;++r){const l=s[r];if(l==="__proto__"||!Object.prototype.propertyIsEnumerable.call(i,l))continue;const a=i[l];if(a&&typeof a=="object"){if(n[l]===a)continue;!n[l]||typeof n[l]!="object"||Array.isArray(n[l])!==Array.isArray(a)||a instanceof Date||a instanceof RegExp?n[l]=v(a,{symbols:o.symbols}):h.merge(n[l],a,o)}else(a!=null||o.nullOverride)&&(n[l]=a)}return n}},9621:(C,b,m)=>{const t=m(375),v={};C.exports=function(y,h,n){if(h===!1||h==null)return y;typeof(n=n||{})=="string"&&(n={separator:n});const i=Array.isArray(h);t(!i||!n.separator,"Separator option is not valid for array-based chain");const o=i?h:h.split(n.separator||".");let s=y;for(let r=0;r<o.length;++r){let l=o[r];const a=n.iterables&&v.iterables(s);if(Array.isArray(s)||a==="set"){const u=Number(l);Number.isInteger(u)&&(l=u<0?s.length+u:u)}if(!s||typeof s=="function"&&n.functions===!1||!a&&s[l]===void 0){t(!n.strict||r+1===o.length,"Missing segment",l,"in reach path ",h),t(typeof s=="object"||n.functions===!0||typeof s!="function","Invalid segment",l,"in reach path ",h),s=n.default;break}s=a?a==="set"?[...s][l]:s.get(l):s[l]}return s},v.iterables=function(y){return y instanceof Set?"set":y instanceof Map?"map":void 0}},8761:C=>{C.exports=function(...b){try{return JSON.stringify(...b)}catch(m){return"[Cannot display object: "+m.message+"]"}}},4277:(C,b)=>{const m={};b=C.exports={array:Array.prototype,buffer:!1,date:Date.prototype,error:Error.prototype,generic:Object.prototype,map:Map.prototype,promise:Promise.prototype,regex:RegExp.prototype,set:Set.prototype,weakMap:WeakMap.prototype,weakSet:WeakSet.prototype},m.typeMap=new Map([["[object Error]",b.error],["[object Map]",b.map],["[object Promise]",b.promise],["[object Set]",b.set],["[object WeakMap]",b.weakMap],["[object WeakSet]",b.weakSet]]),b.getInternalProto=function(t){if(Array.isArray(t))return b.array;if(t instanceof Date)return b.date;if(t instanceof RegExp)return b.regex;if(t instanceof Error)return b.error;const v=Object.prototype.toString.call(t);return m.typeMap.get(v)||b.generic}},7043:(C,b)=>{b.keys=function(m,t={}){return t.symbols!==!1?Reflect.ownKeys(m):Object.getOwnPropertyNames(m)}},3652:(C,b,m)=>{const t=m(375),v={};b.Sorter=class{constructor(){this._items=[],this.nodes=[]}add(y,h){const n=[].concat((h=h||{}).before||[]),i=[].concat(h.after||[]),o=h.group||"?",s=h.sort||0;t(!n.includes(o),"Item cannot come before itself: ".concat(o)),t(!n.includes("?"),"Item cannot come before unassociated items"),t(!i.includes(o),"Item cannot come after itself: ".concat(o)),t(!i.includes("?"),"Item cannot come after unassociated items"),Array.isArray(y)||(y=[y]);for(const r of y){const l={seq:this._items.length,sort:s,before:n,after:i,group:o,node:r};this._items.push(l)}if(!h.manual){const r=this._sort();t(r,"item",o!=="?"?"added into group ".concat(o):"","created a dependencies error")}return this.nodes}merge(y){Array.isArray(y)||(y=[y]);for(const n of y)if(n)for(const i of n._items)this._items.push(Object.assign({},i));this._items.sort(v.mergeSort);for(let n=0;n<this._items.length;++n)this._items[n].seq=n;const h=this._sort();return t(h,"merge created a dependencies error"),this.nodes}sort(){const y=this._sort();return t(y,"sort created a dependencies error"),this.nodes}_sort(){const y={},h=Object.create(null),n=Object.create(null);for(const l of this._items){const a=l.seq,u=l.group;n[u]=n[u]||[],n[u].push(a),y[a]=l.before;for(const f of l.after)h[f]=h[f]||[],h[f].push(a)}for(const l in y){const a=[];for(const u in y[l]){const f=y[l][u];n[f]=n[f]||[],a.push(...n[f])}y[l]=a}for(const l in h)if(n[l])for(const a of n[l])y[a].push(...h[l]);const i={};for(const l in y){const a=y[l];for(const u of a)i[u]=i[u]||[],i[u].push(l)}const o={},s=[];for(let l=0;l<this._items.length;++l){let a=l;if(i[l]){a=null;for(let u=0;u<this._items.length;++u){if(o[u]===!0)continue;i[u]||(i[u]=[]);const f=i[u].length;let p=0;for(let _=0;_<f;++_)o[i[u][_]]&&++p;if(p===f){a=u;break}}}a!==null&&(o[a]=!0,s.push(a))}if(s.length!==this._items.length)return!1;const r={};for(const l of this._items)r[l.seq]=l;this._items=[],this.nodes=[];for(const l of s){const a=r[l];this.nodes.push(a.node),this._items.push(a)}return!0}},v.mergeSort=(y,h)=>y.sort===h.sort?0:y.sort<h.sort?-1:1},5380:(C,b,m)=>{const t=m(443),v=m(2178),y={minDomainSegments:2,nonAsciiRx:/[^\x00-\x7f]/,domainControlRx:/[\x00-\x20@\:\/\\#!\$&\'\(\)\*\+,;=\?]/,tldSegmentRx:/^[a-zA-Z](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,domainSegmentRx:/^[a-zA-Z0-9](?:[a-zA-Z0-9\-]*[a-zA-Z0-9])?$/,URL:t.URL||URL};b.analyze=function(h,n={}){if(!h)return v.code("DOMAIN_NON_EMPTY_STRING");if(typeof h!="string")throw new Error("Invalid input: domain must be a string");if(h.length>256)return v.code("DOMAIN_TOO_LONG");if(y.nonAsciiRx.test(h)){if(n.allowUnicode===!1)return v.code("DOMAIN_INVALID_UNICODE_CHARS");h=h.normalize("NFC")}if(y.domainControlRx.test(h))return v.code("DOMAIN_INVALID_CHARS");h=y.punycode(h),n.allowFullyQualified&&h[h.length-1]==="."&&(h=h.slice(0,-1));const i=n.minDomainSegments||y.minDomainSegments,o=h.split(".");if(o.length<i)return v.code("DOMAIN_SEGMENTS_COUNT");if(n.maxDomainSegments&&o.length>n.maxDomainSegments)return v.code("DOMAIN_SEGMENTS_COUNT_MAX");const s=n.tlds;if(s){const r=o[o.length-1].toLowerCase();if(s.deny&&s.deny.has(r)||s.allow&&!s.allow.has(r))return v.code("DOMAIN_FORBIDDEN_TLDS")}for(let r=0;r<o.length;++r){const l=o[r];if(!l.length)return v.code("DOMAIN_EMPTY_SEGMENT");if(l.length>63)return v.code("DOMAIN_LONG_SEGMENT");if(r<o.length-1){if(!y.domainSegmentRx.test(l))return v.code("DOMAIN_INVALID_CHARS")}else if(!y.tldSegmentRx.test(l))return v.code("DOMAIN_INVALID_TLDS_CHARS")}return null},b.isValid=function(h,n){return!b.analyze(h,n)},y.punycode=function(h){h.includes("%")&&(h=h.replace(/%/g,"%25"));try{return new y.URL("http://".concat(h)).host}catch(n){return h}}},1745:(C,b,m)=>{const t=m(9848),v=m(5380),y=m(2178),h={nonAsciiRx:/[^\x00-\x7f]/,encoder:new(t.TextEncoder||TextEncoder)};b.analyze=function(n,i){return h.email(n,i)},b.isValid=function(n,i){return!h.email(n,i)},h.email=function(n,i={}){if(typeof n!="string")throw new Error("Invalid input: email must be a string");if(!n)return y.code("EMPTY_STRING");const o=!h.nonAsciiRx.test(n);if(!o){if(i.allowUnicode===!1)return y.code("FORBIDDEN_UNICODE");n=n.normalize("NFC")}const s=n.split("@");if(s.length!==2)return s.length>2?y.code("MULTIPLE_AT_CHAR"):y.code("MISSING_AT_CHAR");const[r,l]=s;if(!r)return y.code("EMPTY_LOCAL");if(!i.ignoreLength){if(n.length>254)return y.code("ADDRESS_TOO_LONG");if(h.encoder.encode(r).length>64)return y.code("LOCAL_TOO_LONG")}return h.local(r,o)||v.analyze(l,i)},h.local=function(n,i){const o=n.split(".");for(const s of o){if(!s.length)return y.code("EMPTY_LOCAL_SEGMENT");if(i){if(!h.atextRx.test(s))return y.code("INVALID_LOCAL_CHARS")}else for(const r of s){if(h.atextRx.test(r))continue;const l=h.binary(r);if(!h.atomRx.test(l))return y.code("INVALID_LOCAL_CHARS")}}},h.binary=function(n){return Array.from(h.encoder.encode(n)).map(i=>String.fromCharCode(i)).join("")},h.atextRx=/^[\w!#\$%&'\*\+\-/=\?\^`\{\|\}~]+$/,h.atomRx=new RegExp(["(?:[\\xc2-\\xdf][\\x80-\\xbf])","(?:\\xe0[\\xa0-\\xbf][\\x80-\\xbf])|(?:[\\xe1-\\xec][\\x80-\\xbf]{2})|(?:\\xed[\\x80-\\x9f][\\x80-\\xbf])|(?:[\\xee-\\xef][\\x80-\\xbf]{2})","(?:\\xf0[\\x90-\\xbf][\\x80-\\xbf]{2})|(?:[\\xf1-\\xf3][\\x80-\\xbf]{3})|(?:\\xf4[\\x80-\\x8f][\\x80-\\xbf]{2})"].join("|"))},2178:(C,b)=>{b.codes={EMPTY_STRING:"Address must be a non-empty string",FORBIDDEN_UNICODE:"Address contains forbidden Unicode characters",MULTIPLE_AT_CHAR:"Address cannot contain more than one @ character",MISSING_AT_CHAR:"Address must contain one @ character",EMPTY_LOCAL:"Address local part cannot be empty",ADDRESS_TOO_LONG:"Address too long",LOCAL_TOO_LONG:"Address local part too long",EMPTY_LOCAL_SEGMENT:"Address local part contains empty dot-separated segment",INVALID_LOCAL_CHARS:"Address local part contains invalid character",DOMAIN_NON_EMPTY_STRING:"Domain must be a non-empty string",DOMAIN_TOO_LONG:"Domain too long",DOMAIN_INVALID_UNICODE_CHARS:"Domain contains forbidden Unicode characters",DOMAIN_INVALID_CHARS:"Domain contains invalid character",DOMAIN_INVALID_TLDS_CHARS:"Domain contains invalid tld character",DOMAIN_SEGMENTS_COUNT:"Domain lacks the minimum required number of segments",DOMAIN_SEGMENTS_COUNT_MAX:"Domain contains too many segments",DOMAIN_FORBIDDEN_TLDS:"Domain uses forbidden TLD",DOMAIN_EMPTY_SEGMENT:"Domain contains empty dot-separated segment",DOMAIN_LONG_SEGMENT:"Domain contains dot-separated segment that is too long"},b.code=function(m){return{code:m,error:b.codes[m]}}},9959:(C,b,m)=>{const t=m(375),v=m(5752);b.regex=function(y={}){t(y.cidr===void 0||typeof y.cidr=="string","options.cidr must be a string");const h=y.cidr?y.cidr.toLowerCase():"optional";t(["required","optional","forbidden"].includes(h),"options.cidr must be one of required, optional, forbidden"),t(y.version===void 0||typeof y.version=="string"||Array.isArray(y.version),"options.version must be a string or an array of string");let n=y.version||["ipv4","ipv6","ipvfuture"];Array.isArray(n)||(n=[n]),t(n.length>=1,"options.version must have at least 1 version specified");for(let s=0;s<n.length;++s)t(typeof n[s]=="string","options.version must only contain strings"),n[s]=n[s].toLowerCase(),t(["ipv4","ipv6","ipvfuture"].includes(n[s]),"options.version contains unknown version "+n[s]+" - must be one of ipv4, ipv6, ipvfuture");n=Array.from(new Set(n));const i="(?:".concat(n.map(s=>{if(h==="forbidden")return v.ip[s];const r="\\/".concat(s==="ipv4"?v.ip.v4Cidr:v.ip.v6Cidr);return h==="required"?"".concat(v.ip[s]).concat(r):"".concat(v.ip[s],"(?:").concat(r,")?")}).join("|"),")"),o=new RegExp("^".concat(i,"$"));return{cidr:h,versions:n,regex:o,raw:i}}},5752:(C,b,m)=>{const t=m(375),v=m(6064),y={generate:function(){const h={},n="\\dA-Fa-f",i="["+n+"]",o="\\w-\\.~",s="!\\$&'\\(\\)\\*\\+,;=",r="%"+n,l=o+r+s+":@",a="["+l+"]",u="(?:0{0,2}\\d|0?[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])";h.ipv4address="(?:"+u+"\\.){3}"+u;const f=i+"{1,4}",p="(?:"+f+":"+f+"|"+h.ipv4address+")",_="(?:"+f+":){6}"+p,k="::(?:"+f+":){5}"+p,E="(?:"+f+")?::(?:"+f+":){4}"+p,g="(?:(?:"+f+":){0,1}"+f+")?::(?:"+f+":){3}"+p,R="(?:(?:"+f+":){0,2}"+f+")?::(?:"+f+":){2}"+p,I="(?:(?:"+f+":){0,3}"+f+")?::"+f+":"+p,A="(?:(?:"+f+":){0,4}"+f+")?::"+p,O="(?:(?:"+f+":){0,5}"+f+")?::"+f,N="(?:(?:"+f+":){0,6}"+f+")?::";h.ipv4Cidr="(?:\\d|[1-2]\\d|3[0-2])",h.ipv6Cidr="(?:0{0,2}\\d|0?[1-9]\\d|1[01]\\d|12[0-8])",h.ipv6address="(?:"+_+"|"+k+"|"+E+"|"+g+"|"+R+"|"+I+"|"+A+"|"+O+"|"+N+")",h.ipvFuture="v"+i+"+\\.["+o+s+":]+",h.scheme="[a-zA-Z][a-zA-Z\\d+-\\.]*",h.schemeRegex=new RegExp(h.scheme);const V="["+o+r+s+":]*",B="["+o+r+s+"]{1,255}",Z="(?:\\[(?:"+h.ipv6address+"|"+h.ipvFuture+")\\]|"+h.ipv4address+"|"+B+")",M="(?:"+V+"@)?"+Z+"(?::\\d*)?",F="(?:"+V+"@)?("+Z+")(?::\\d*)?",X=a+"*",U=a+"+",W="(?:\\/"+X+")*",K="\\/(?:"+U+W+")?",ee=U+W,se="["+o+r+s+"@]+"+W,ie="(?:\\/\\/\\/"+X+W+")";return h.hierPart="(?:(?:\\/\\/"+M+W+")|"+K+"|"+ee+"|"+ie+")",h.hierPartCapture="(?:(?:\\/\\/"+F+W+")|"+K+"|"+ee+")",h.relativeRef="(?:(?:\\/\\/"+M+W+")|"+K+"|"+se+"|)",h.relativeRefCapture="(?:(?:\\/\\/"+F+W+")|"+K+"|"+se+"|)",h.query="["+l+"\\/\\?]*(?=#|$)",h.queryWithSquareBrackets="["+l+"\\[\\]\\/\\?]*(?=#|$)",h.fragment="["+l+"\\/\\?]*",h}};y.rfc3986=y.generate(),b.ip={v4Cidr:y.rfc3986.ipv4Cidr,v6Cidr:y.rfc3986.ipv6Cidr,ipv4:y.rfc3986.ipv4address,ipv6:y.rfc3986.ipv6address,ipvfuture:y.rfc3986.ipvFuture},y.createRegex=function(h){const n=y.rfc3986,i="(?:\\?"+(h.allowQuerySquareBrackets?n.queryWithSquareBrackets:n.query)+")?(?:#"+n.fragment+")?",o=h.domain?n.relativeRefCapture:n.relativeRef;if(h.relativeOnly)return y.wrap(o+i);let s="";if(h.scheme){t(h.scheme instanceof RegExp||typeof h.scheme=="string"||Array.isArray(h.scheme),"scheme must be a RegExp, String, or Array");const a=[].concat(h.scheme);t(a.length>=1,"scheme must have at least 1 scheme specified");const u=[];for(let f=0;f<a.length;++f){const p=a[f];t(p instanceof RegExp||typeof p=="string","scheme at position "+f+" must be a RegExp or String"),p instanceof RegExp?u.push(p.source.toString()):(t(n.schemeRegex.test(p),"scheme at position "+f+" must be a valid scheme"),u.push(v(p)))}s=u.join("|")}const r="(?:"+(s?"(?:"+s+")":n.scheme)+":"+(h.domain?n.hierPartCapture:n.hierPart)+")",l=h.allowRelative?"(?:"+r+"|"+o+")":r;return y.wrap(l+i,s)},y.wrap=function(h,n){return{raw:h="(?=.)(?!https?:/(?:$|[^/]))(?!https?:///)(?!https?:[^/])".concat(h),regex:new RegExp("^".concat(h,"$")),scheme:n}},y.uriRegex=y.createRegex({}),b.regex=function(h={}){return h.scheme||h.allowRelative||h.relativeOnly||h.allowQuerySquareBrackets||h.domain?y.createRegex(h):y.uriRegex}},1447:(C,b)=>{const m={operators:["!","^","*","/","%","+","-","<","<=",">",">=","==","!=","&&","||","??"],operatorCharacters:["!","^","*","/","%","+","-","<","=",">","&","|","?"],operatorsOrder:[["^"],["*","/","%"],["+","-"],["<","<=",">",">="],["==","!="],["&&"],["||","??"]],operatorsPrefix:["!","n"],literals:{'"':'"',"`":"`","'":"'","[":"]"},numberRx:/^(?:[0-9]*(\.[0-9]*)?){1}$/,tokenRx:/^[\w\$\#\.\@\:\{\}]+$/,symbol:Symbol("formula"),settings:Symbol("settings")};b.Parser=class{constructor(t,v={}){if(!v[m.settings]&&v.constants)for(const y in v.constants){const h=v.constants[y];if(h!==null&&!["boolean","number","string"].includes(typeof h))throw new Error("Formula constant ".concat(y," contains invalid ").concat(typeof h," value type"))}this.settings=v[m.settings]?v:Object.assign({[m.settings]:!0,constants:{},functions:{}},v),this.single=null,this._parts=null,this._parse(t)}_parse(t){let v=[],y="",h=0,n=!1;const i=s=>{if(h)throw new Error("Formula missing closing parenthesis");const r=v.length?v[v.length-1]:null;if(n||y||s){if(r&&r.type==="reference"&&s===")")return r.type="function",r.value=this._subFormula(y,r.value),void(y="");if(s===")"){const l=new b.Parser(y,this.settings);v.push({type:"segment",value:l})}else if(n){if(n==="]")return v.push({type:"reference",value:y}),void(y="");v.push({type:"literal",value:y})}else if(m.operatorCharacters.includes(y))r&&r.type==="operator"&&m.operators.includes(r.value+y)?r.value+=y:v.push({type:"operator",value:y});else if(y.match(m.numberRx))v.push({type:"constant",value:parseFloat(y)});else if(this.settings.constants[y]!==void 0)v.push({type:"constant",value:this.settings.constants[y]});else{if(!y.match(m.tokenRx))throw new Error("Formula contains invalid token: ".concat(y));v.push({type:"reference",value:y})}y=""}};for(const s of t)n?s===n?(i(),n=!1):y+=s:h?s==="("?(y+=s,++h):s===")"?(--h,h?y+=s:i(s)):y+=s:s in m.literals?n=m.literals[s]:s==="("?(i(),++h):m.operatorCharacters.includes(s)?(i(),y=s,i()):s!==" "?y+=s:i();i(),v=v.map((s,r)=>s.type!=="operator"||s.value!=="-"||r&&v[r-1].type!=="operator"?s:{type:"operator",value:"n"});let o=!1;for(const s of v){if(s.type==="operator"){if(m.operatorsPrefix.includes(s.value))continue;if(!o)throw new Error("Formula contains an operator in invalid position");if(!m.operators.includes(s.value))throw new Error("Formula contains an unknown operator ".concat(s.value))}else if(o)throw new Error("Formula missing expected operator");o=!o}if(!o)throw new Error("Formula contains invalid trailing operator");v.length===1&&["reference","literal","constant"].includes(v[0].type)&&(this.single={type:v[0].type==="reference"?"reference":"value",value:v[0].value}),this._parts=v.map(s=>{if(s.type==="operator")return m.operatorsPrefix.includes(s.value)?s:s.value;if(s.type!=="reference")return s.value;if(this.settings.tokenRx&&!this.settings.tokenRx.test(s.value))throw new Error("Formula contains invalid reference ".concat(s.value));return this.settings.reference?this.settings.reference(s.value):m.reference(s.value)})}_subFormula(t,v){const y=this.settings.functions[v];if(typeof y!="function")throw new Error("Formula contains unknown function ".concat(v));let h=[];if(t){let n="",i=0,o=!1;const s=()=>{if(!n)throw new Error("Formula contains function ".concat(v," with invalid arguments ").concat(t));h.push(n),n=""};for(let r=0;r<t.length;++r){const l=t[r];o?(n+=l,l===o&&(o=!1)):l in m.literals&&!i?(n+=l,o=m.literals[l]):l!==","||i?(n+=l,l==="("?++i:l===")"&&--i):s()}s()}return h=h.map(n=>new b.Parser(n,this.settings)),function(n){const i=[];for(const o of h)i.push(o.evaluate(n));return y.call(n,...i)}}evaluate(t){const v=this._parts.slice();for(let y=v.length-2;y>=0;--y){const h=v[y];if(h&&h.type==="operator"){const n=v[y+1];v.splice(y+1,1);const i=m.evaluate(n,t);v[y]=m.single(h.value,i)}}return m.operatorsOrder.forEach(y=>{for(let h=1;h<v.length-1;)if(y.includes(v[h])){const n=v[h],i=m.evaluate(v[h-1],t),o=m.evaluate(v[h+1],t);v.splice(h,2);const s=m.calculate(n,i,o);v[h-1]=s===0?0:s}else h+=2}),m.evaluate(v[0],t)}},b.Parser.prototype[m.symbol]=!0,m.reference=function(t){return function(v){return v&&v[t]!==void 0?v[t]:null}},m.evaluate=function(t,v){return t===null?null:typeof t=="function"?t(v):t[m.symbol]?t.evaluate(v):t},m.single=function(t,v){if(t==="!")return!v;const y=-v;return y===0?0:y},m.calculate=function(t,v,y){if(t==="??")return m.exists(v)?v:y;if(typeof v=="string"||typeof y=="string"){if(t==="+")return(v=m.exists(v)?v:"")+(m.exists(y)?y:"")}else switch(t){case"^":return Math.pow(v,y);case"*":return v*y;case"/":return v/y;case"%":return v%y;case"+":return v+y;case"-":return v-y}switch(t){case"<":return v<y;case"<=":return v<=y;case">":return v>y;case">=":return v>=y;case"==":return v===y;case"!=":return v!==y;case"&&":return v&&y;case"||":return v||y}return null},m.exists=function(t){return t!=null}},9926:()=>{},5688:()=>{},9708:()=>{},1152:()=>{},443:()=>{},9848:()=>{},5934:C=>{C.exports=JSON.parse('{"version":"17.13.0"}')}},w={},function C(b){var m=w[b];if(m!==void 0)return m.exports;var t=w[b]={exports:{}};return d[b](t,t.exports,C),t.exports}(5107);var d,w})})(os);var Ji=os.exports;const ue=st(Ji);let He;const Qi=32e3,on=1e3;class as extends Ht{constructor(e,d,w,C){if(super(),He=w,!d)throw He.error("Token generator is required to construct this module."),new Error("Token generator is required to construct this module.");this.webRTCPeer=new je,this.signaling=null,this.autoReconnect=C,this.reconnectionInterval=on,this.alreadyDisconnected=!1,this.firstReconnection=!0,this.stopReconnection=!1,this.isReconnecting=!1,this.tokenGenerator=d,this.options=null}getRTCPeerConnection(){return this.webRTCPeer?this.webRTCPeer.getRTCPeer():null}stop(){var e;He.info("Stopping"),this.webRTCPeer.closeRTCPeer(),(e=this.signaling)==null||e.close(),this.signaling=null,this.stopReconnection=!0,this.webRTCPeer=new je}isActive(){const e=this.webRTCPeer.getRTCPeerStatus();return He.info("Broadcast status: ",e||"not_established"),e==="connected"}setReconnect(){this.signaling.on("migrate",()=>this.replaceConnection()),this.autoReconnect&&(this.signaling.on(Ne.connectionError,()=>{(this.firstReconnection||!this.alreadyDisconnected)&&(this.firstReconnection=!1,this.reconnect({error:new Error("Signaling error: wsConnectionError")}))}),this.webRTCPeer.on(Le.connectionStateChange,e=>{ve.setConnectionState(e),e==="connected"&&ve.setConnectionTime(new Date),(e==="failed"||e==="disconnected"&&this.alreadyDisconnected)&&this.firstReconnection?(this.firstReconnection=!1,this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")})):e==="disconnected"?(this.alreadyDisconnected=!0,setTimeout(()=>this.reconnect({error:new Error("Connection state change: RTCPeerConnectionState disconnected")}),1500)):this.alreadyDisconnected=!1}))}async reconnect(e){try{He.info("Attempting to reconnect..."),!this.isActive()&&!this.stopReconnection&&!this.isReconnecting&&(this.stop(),this.emit("reconnect",{timeout:an(this.reconnectionInterval),error:e!=null&&e.error?e==null?void 0:e.error:new Error("Attempting to reconnect")}),this.isReconnecting=!0,await this.connect(this.options),this.alreadyDisconnected=!1,this.reconnectionInterval=on,this.firstReconnection=!0,this.isReconnecting=!1)}catch(d){this.isReconnecting=!1,this.reconnectionInterval=an(this.reconnectionInterval),He.error("Reconnection failed, retrying in ".concat(this.reconnectionInterval,"ms. "),d),setTimeout(()=>this.reconnect({error:d}),this.reconnectionInterval)}}}const an=c=>c<Qi?c*2:c,br=window.RTCRtpSender&&!!RTCRtpSender.prototype.createEncodedStreams&&window.RTCRtpReceiver&&!!RTCRtpReceiver.prototype.createEncodedStreams,cs="RTCRtpScriptTransform"in window,ls="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHd7Y29uc3RydWN0b3IodCl7dGhpcy5kYXRhPXQsdGhpcy5iaXRPZmZzZXQ9MH1yZWFkQml0cyh0KXtpZih0aGlzLmJpdE9mZnNldCt0PnRoaXMuZGF0YS5sZW5ndGgqOCl0aHJvdyBuZXcgRXJyb3IoIkF0dGVtcHRlZCB0byByZWFkIHBhc3QgdGhlIGVuZCBvZiB0aGUgYml0c3RyZWFtIik7bGV0IGU9MDtmb3IobGV0IGk9MDtpPHQ7aSsrKXtjb25zdCBzPU1hdGguZmxvb3IodGhpcy5iaXRPZmZzZXQvOCksYT03LXRoaXMuYml0T2Zmc2V0JTgscj10aGlzLmRhdGFbc10+PmEmMTtlfD1yPDx0LTEtaSx0aGlzLmJpdE9mZnNldCsrfXJldHVybiBlfXNraXAodCl7dGhpcy5iaXRPZmZzZXQrPXR9cmVhZEV4cEdvbG9tYlVuc2lnbmVkKCl7bGV0IHQ9LTE7Zm9yKGxldCBlPTA7ZT09PTA7dCsrKWU9dGhpcy5yZWFkQml0cygxKTtyZXR1cm4oMTw8dCktMSt0aGlzLnJlYWRCaXRzKHQpfXJlYWRFeHBHb2xvbWJTaWduZWQoKXtjb25zdCB0PXRoaXMucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7cmV0dXJuIHQlMj09PTA/LSh0LzIpOih0KzEpLzJ9fWNvbnN0IF89e1NMSUNFX05PTl9JRFI6MSxTTElDRV9QQVJUSVRJT05fQToyLFNMSUNFX0lEUjo1LFNFSV9IMjY0OjYsU0VJX0gyNjVfUFJFRklYOjM5LFNFSV9IMjY1X1NVRkZJWDo0MCxTUFNfSDI2NDo3LFNQU19IMjY1OjMzLFBQU19IMjY0OjgsUFBTX0gyNjU6MzR9LEg9e1BJQ19USU1JTkc6MSxVU0VSX0RBVEFfVU5SRUdJU1RFUkVEOjV9LGg9e0xFR0FDWToxLE5FVzoyLFRJTUVDT0RFOjMsT1RIRVI6NH0sUj0iNmU5Y2ZkMmEtNTkwNy00OWZmLWIzNjMtODk3OGE2ZTgzNDBlIixOPSI5YTIxZjNiZS0zMWYwLTRiNzgtYjBiZS1jN2Y3ZGJiOTcyNTAiLEE9ImQ0MGUzOGVhLWQ0MTktNGM2Mi05NGVkLTIwYWMzN2I0ZTRmYSI7Y2xhc3Mgentjb25zdHJ1Y3Rvcih0PSJIMjY0Iil7dGhpcy5zcHM9bmV3IE1hcCx0aGlzLnBwcz1uZXcgTWFwLHRoaXMuYWN0aXZlU1BTPW51bGwsdGhpcy5jb2RlYz10fWNvbGxlY3RQUFModCl7dGhpcy5jb2RlYz09PSJIMjY0Ij90aGlzLmNvbGxlY3RIMjY0UFBTKHQpOnRoaXMuY29sbGVjdEgyNjVQUFModCl9Y29sbGVjdFNQUyh0KXt0aGlzLmNvZGVjPT09IkgyNjQiP3RoaXMuY29sbGVjdEgyNjRTUFModCk6dGhpcy5jb2xsZWN0SDI2NVNQUyh0KX1jb2xsZWN0SDI2NFNQUyh0KXtjb25zdCBlPW5ldyB3KHQpLGk9ZS5yZWFkQml0cyg4KSxzPVsxMDAsMTEwLDEyMiwyNDQsNDQsODMsODYsMTE4LDEyOCwxMzgsMTM5LDEzNCwxMzVdO2Uuc2tpcCg4KSxlLnNraXAoOCk7Y29uc3QgYT1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2lmKGE+MzF8fGE8MCl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgc2VxX3BhcmFtZXRlcl9zZXRfaWQiKTtpZihzLmluY2x1ZGVzKGkpKXtjb25zdCBvPWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7aWYobz09PTMmJmUuc2tpcCgxKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5za2lwKDEpLGUucmVhZEJpdHMoMSkpe2NvbnN0IG09byE9PTM/ODoxMjtmb3IobGV0IHA9MDtwPG07cCsrKWlmKGUucmVhZEJpdHMoMSkpe2NvbnN0IEU9cDw2PzE2OjY0O2xldCBkPTgsdT04O2ZvcihsZXQgST0wO0k8RTtJKyspe2lmKHUhPT0wKXtjb25zdCBsPWUucmVhZEV4cEdvbG9tYlNpZ25lZCgpO3U9KGQrbCsyNTYpJTI1Nn1kPXU9PT0wP2Q6dX19fX1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2NvbnN0IHI9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtpZihyPT09MCllLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2Vsc2UgaWYocj09PTEpe2Uuc2tpcCgxKSxlLnJlYWRFeHBHb2xvbWJTaWduZWQoKSxlLnJlYWRFeHBHb2xvbWJTaWduZWQoKTtjb25zdCBvPWUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCk7Zm9yKGxldCBmPTA7ZjxvO2YrKyllLnJlYWRFeHBHb2xvbWJTaWduZWQoKX1lLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUuc2tpcCgxKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkQml0cygxKT09PTAmJmUuc2tpcCgxKSxlLnNraXAoMSksZS5yZWFkQml0cygxKSYmKGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpLGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCkpO2xldCBjO2lmKGUucmVhZEJpdHMoMSkpe2xldCBmPWZ1bmN0aW9uKGQpe2NvbnN0IHU9ZC5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtkLnNraXAoNCksZC5za2lwKDQpO2ZvcihsZXQgVT0wO1U8PXU7VSsrKWQucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZC5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxkLnNraXAoMSk7ZC5za2lwKDUpO2NvbnN0IEk9ZC5yZWFkQml0cyg1KSxsPWQucmVhZEJpdHMoNSksRz1kLnJlYWRCaXRzKDUpO3JldHVybntjcGJfcmVtb3ZhbF9kZWxheV9sZW5ndGhfbWludXMxOkksZHBiX291dHB1dF9kZWxheV9sZW5ndGhfbWludXMxOmwsdGltZV9vZmZzZXRfbGVuZ3RoOkd9fTtlLnJlYWRCaXRzKDEpJiZlLnJlYWRCaXRzKDgpPT09MjU1JiYoZS5za2lwKDE2KSxlLnNraXAoMTYpKSxlLnJlYWRCaXRzKDEpJiZlLnNraXAoMSksZS5yZWFkQml0cygxKSYmKGUuc2tpcCgzKSxlLnNraXAoMSksZS5yZWFkQml0cygxKSYmZS5za2lwKDI0KSksZS5yZWFkQml0cygxKSYmKGUucmVhZEV4cEdvbG9tYlVuc2lnbmVkKCksZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSk7Y29uc3Qgbz1lLnJlYWRCaXRzKDEpP3tudW1fdW5pdHNfaW5fdGljazplLnJlYWRCaXRzKDMyKSx0aW1lX3NjYWxlOmUucmVhZEJpdHMoMzIpLGZpeGVkX2ZyYW1lX3JhdGVfZmxhZzplLnJlYWRCaXRzKDEpfTp2b2lkIDAsbT1lLnJlYWRCaXRzKDEpP2YoZSk6dm9pZCAwLHA9ZS5yZWFkQml0cygxKT9mKGUpOnZvaWQgMDsobXx8cCkmJmUuc2tpcCgxKTtjb25zdCBFPWUucmVhZEJpdHMoMSk7Yz17dGltaW5nX2luZm86byxuYWxfaHJkX3BhcmFtZXRlcnM6bSx2Y2xfaHJkX3BhcmFtZXRlcnM6cCxwaWNfc3RydWN0X3ByZXNlbnRfZmxhZzpFfX10aGlzLnNwcy5zZXQoYSx7dnVpX3BhcmFtZXRlcnM6Y30pfWNvbGxlY3RIMjY1U1BTKHQpe31jb2xsZWN0SDI2NFBQUyh0KXtjb25zdCBlPW5ldyB3KHQpLGk9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKTtpZihpPjI1NXx8aTwwKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwaWNfcGFyYW1ldGVyX3NldF9pZCIpO2NvbnN0IHM9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKTt0aGlzLnBwcy5zZXQoaSx7c2VxX3BhcmFtZXRlcl9zZXRfaWQ6c30pfWNvbGxlY3RIMjY1UFBTKHQpe31maW5kQWN0aXZlU1BTKHQpe2NvbnN0IGU9bmV3IHcodCk7ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxlLnJlYWRFeHBHb2xvbWJVbnNpZ25lZCgpO2NvbnN0IGk9ZS5yZWFkRXhwR29sb21iVW5zaWduZWQoKSxzPXRoaXMucHBzLmdldChpKTtpZihzKXtjb25zdCBhPXRoaXMuc3BzLmdldChzLnNlcV9wYXJhbWV0ZXJfc2V0X2lkKTtpZihhKXt0aGlzLmFjdGl2ZVNQUz1hO3JldHVybn19dGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgZmluZCB0aGUgYWN0aXZlIFNQUyIpfX1jb25zdCBnPW5ldyB6O2Z1bmN0aW9uIEMobix0KXtmb3IoO3Q8bi5ieXRlTGVuZ3RoLTQ7KXtpZihuW3RdPT09MCYmblt0KzFdPT09MCYmKG5bdCsyXT09PTF8fG5bdCsyXT09PTAmJm5bdCszXT09PTEpKXJldHVybiB0O3QrPTF9cmV0dXJuLTF9ZnVuY3Rpb24gUChuKXtjb25zdCB0PW5ldyBVaW50OEFycmF5KG4uYnl0ZUxlbmd0aCk7bGV0IGU9MCxpPTA7Zm9yKGxldCBzPTI7czxuLmJ5dGVMZW5ndGg7cysrKW5bc109PT0zJiZuW3MtMV09PT0wJiZuW3MtMl09PT0wJiYodC5zZXQobi5zdWJhcnJheShpLHMpLGUpLGUrPXMtaSxpPXMrMSk7cmV0dXJuIGk8bi5ieXRlTGVuZ3RoJiZ0LnNldChuLnN1YmFycmF5KGkpLGUpLHR9ZnVuY3Rpb24gVyhuLHQpe2xldCBlPTA7Y29uc3QgaT10PT09IkgyNjQiPzE6MixzPVtdO2Zvcig7ZTxuLmJ5dGVMZW5ndGgtNDspe2NvbnN0IGE9QyhuLGUpO2lmKGE+PWUpe2NvbnN0IHI9blthKzJdPT09MT8zOjQsYz1DKG4sYStyK2kpO2lmKGM+YSlzLnB1c2gobi5zdWJhcnJheShhLGMpKSxlPWM7ZWxzZXtzLnB1c2gobi5zdWJhcnJheShhKSk7YnJlYWt9fWVsc2UgYnJlYWt9cmV0dXJuIHN9ZnVuY3Rpb24gRihuLHQpe2xldCBlPSEwO3JldHVybiBXKG4sdCkuZmlsdGVyKGk9Pntjb25zdCBzPWlbMl09PT0xPzM6NCxhPXQ9PT0iSDI2NCI/MToyLHI9aVtzXSxjPXQ9PT0iSDI2NCI/ciYzMTpyPj4xJjYzO2lmKGUpc3dpdGNoKGMpe2Nhc2UgXy5QUFNfSDI2NDpjYXNlIF8uUFBTX0gyNjU6Zy5jb2xsZWN0UFBTKFAoaS5zdWJhcnJheShzK2EpKSk7YnJlYWs7Y2FzZSBfLlNQU19IMjY0OmNhc2UgXy5TUFNfSDI2NTpnLmNvbGxlY3RTUFMoUChpLnN1YmFycmF5KHMrYSkpKTticmVhaztjYXNlIF8uU0xJQ0VfSURSOmNhc2UgXy5TTElDRV9OT05fSURSOmNhc2UgXy5TTElDRV9QQVJUSVRJT05fQTp0cnl7Zy5maW5kQWN0aXZlU1BTKFAoaS5zdWJhcnJheShzK2EpKSksZT0hMX1jYXRjaChvKXtjb25zb2xlLmluZm8oIkZhaWxlZCB0byBmaW5kIGFjdGl2ZSBTUFMuIFdpbGwgbm90IGJlIGFibGUgdG8gZXh0cmFjdCBQSUMgdGltaW5nIG1ldGFkYXRhIil9YnJlYWt9cmV0dXJuW18uU0VJX0gyNjQsXy5TRUlfSDI2NV9QUkVGSVgsXy5TRUlfSDI2NV9TVUZGSVhdLmluY2x1ZGVzKGMpfSl9ZnVuY3Rpb24gcShuKXtsZXQgdD0wLGU9MDtmb3IoO25bZV09PT0yNTU7KXQrPTI1NSxlKys7dCs9bltlXSxlKys7bGV0IGk9MDtmb3IoO25bZV09PT0yNTU7KWkrPTI1NSxlKys7cmV0dXJuIGkrPW5bZV0sZSsrLHt0eXBlOnQsY29udGVudDpuLnN1YmFycmF5KGUsZStpKX19ZnVuY3Rpb24gVihuKXtjb25zdCB0PW5ldyBVaW50OEFycmF5KFQoTikpLGU9bmV3IFVpbnQ4QXJyYXkoVChSKSksaT1uZXcgVWludDhBcnJheShUKEEpKTtyZXR1cm4gdC5ldmVyeSgocyxhKT0+cz09PW5bYV0pP2guVElNRUNPREU6ZS5ldmVyeSgocyxhKT0+cz09PW5bYV0pP2guTEVHQUNZOmkuZXZlcnkoKHMsYSk9PnM9PT1uW2FdKT9oLk5FVzpoLk9USEVSfWZ1bmN0aW9uIFkobix0KXtsZXQgZT0wO24udXVpZD10LnN1YmFycmF5KGUsZSsxNiksZSs9MTY7Y29uc3QgaT1WKG4udXVpZCkscz10LnN1YmFycmF5KGUpO3N3aXRjaChpKXtjYXNlIGguTEVHQUNZOmNhc2UgaC5PVEhFUjpuLnVucmVnaXN0ZXJlZD1zO2JyZWFrO2Nhc2UgaC5USU1FQ09ERTpuLnRpbWVjb2RlPUQocyk7YnJlYWs7Y2FzZSBoLk5FVzp7bGV0IGE9MDtjb25zdCByPUwoRGF0ZS5ub3coKSkubGVuZ3RoLGM9cy5zdWJhcnJheShhLHIpO2ErPXI7Y29uc3Qgbz1zLnN1YmFycmF5KGEpO24udGltZWNvZGU9RChjKSxuLnVucmVnaXN0ZXJlZD1vO2JyZWFrfX19ZnVuY3Rpb24gRChuKXtjb25zdCB0PW4ucmVkdWNlKChhLHIpPT4oYTw8QmlnSW50KDgpKStCaWdJbnQociksQmlnSW50KDApKSxlPU51bWJlcih0KSxpPW5ldyBEYXRlKGUpO3JldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoaS50b0lTT1N0cmluZygpKX1mdW5jdGlvbiBqKG4sdCl7dmFyIGYsbSxwLEUsZDtpZighZy5hY3RpdmVTUFMpe2NvbnNvbGUud2FybigiQ2Fubm90IGZpbmQgdGhlIGFjdGl2ZSBTUFMiKTtyZXR1cm59Y29uc3QgZT0oZj1nLmFjdGl2ZVNQUy52dWlfcGFyYW1ldGVycy5uYWxfaHJkX3BhcmFtZXRlcnMpIT1udWxsP2Y6Zy5hY3RpdmVTUFMudnVpX3BhcmFtZXRlcnMudmNsX2hyZF9wYXJhbWV0ZXJzLGk9e2NwYl9kcGJfZGVsYXlzX3ByZXNlbnRfZmxhZzplPzE6MCxjcGJfcmVtb3ZhbF9kZWxheV9sZW5ndGhfbWludXMxOihtPWU9PW51bGw/dm9pZCAwOmUuY3BiX3JlbW92YWxfZGVsYXlfbGVuZ3RoX21pbnVzMSkhPW51bGw/bToyMyxkcGJfb3V0cHV0X2RlbGF5X2xlbmd0aF9taW51czE6KHA9ZT09bnVsbD92b2lkIDA6ZS5kcGJfb3V0cHV0X2RlbGF5X2xlbmd0aF9taW51czEpIT1udWxsP3A6MjMsdGltZV9vZmZzZXRfbGVuZ3RoOmU/KEU9ZS50aW1lX29mZnNldF9sZW5ndGgpIT1udWxsP0U6MjQ6dm9pZCAwLHBpY19zdHJ1Y3RfcHJlc2VudF9mbGFnOihkPWcuYWN0aXZlU1BTLnZ1aV9wYXJhbWV0ZXJzLnBpY19zdHJ1Y3RfcHJlc2VudF9mbGFnKSE9bnVsbD9kOjB9O2lmKCFpLnBpY19zdHJ1Y3RfcHJlc2VudF9mbGFnKXtjb25zb2xlLndhcm4oInBpY19zdHJ1Y3RfcHJlc2VudF9mbGFnIGlzIG5vdCBwcmVzZW50Iik7cmV0dXJufWNvbnN0IHM9bmV3IHcodCk7aS5jcGJfZHBiX2RlbGF5c19wcmVzZW50X2ZsYWcmJihzLnNraXAoaS5jcGJfcmVtb3ZhbF9kZWxheV9sZW5ndGhfbWludXMxKzEpLHMuc2tpcChpLmRwYl9vdXRwdXRfZGVsYXlfbGVuZ3RoX21pbnVzMSsxKSk7Y29uc3QgYT1bMSwxLDEsMiwyLDMsMywyLDNdLHI9cy5yZWFkQml0cyg0KTtpZihyPj1hLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGljX3N0cnVjdCIpO2NvbnN0IGM9YVtyXSxvPVtdO2ZvcihsZXQgdT0wO3U8Yzt1KyspaWYocy5yZWFkQml0cygxKSl7Y29uc3QgbD17fTtzLnNraXAoMikscy5za2lwKDEpLHMuc2tpcCg1KTtjb25zdCBHPXMucmVhZEJpdHMoMSk7aWYocy5za2lwKDIpLGwubl9mcmFtZXM9cy5yZWFkQml0cyg4KSxHPyhsLnNlY29uZHNfdmFsdWU9cy5yZWFkQml0cyg2KSxsLm1pbnV0ZXNfdmFsdWU9cy5yZWFkQml0cyg2KSxsLmhvdXJzX3ZhbHVlPXMucmVhZEJpdHMoNSkpOnMucmVhZEJpdHMoMSkmJihsLnNlY29uZHNfdmFsdWU9cy5yZWFkQml0cyg2KSxzLnJlYWRCaXRzKDEpJiYobC5taW51dGVzX3ZhbHVlPXMucmVhZEJpdHMoNikscy5yZWFkQml0cygxKSYmKGwuaG91cnNfdmFsdWU9cy5yZWFkQml0cyg1KSkpKSxpLnRpbWVfb2Zmc2V0X2xlbmd0aCl0cnl7bC50aW1lX29mZnNldD1zLnJlYWRCaXRzKGkudGltZV9vZmZzZXRfbGVuZ3RoKX1jYXRjaChVKXtjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcmVhZCB0aW1lX29mZnNldCIsVSksbC50aW1lX29mZnNldD0wfWVsc2UgbC50aW1lX29mZnNldD0wO28ucHVzaChsKX1uLnNlaVBpY1RpbWluZ1RpbWVDb2RlQXJyYXk9b31mdW5jdGlvbiBYKG4sdCl7aWYodCE9PSJIMjY0IiYmdCE9PSJIMjY1Iil0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGNvZGVjICIuY29uY2F0KHQpKTtjb25zdCBlPXt9O3JldHVybiBnLmNvZGVjPXQsRihuZXcgVWludDhBcnJheShuLmRhdGEpLHQpLmZvckVhY2goaT0+e2NvbnN0IHM9aVsyXT09PTE/Mzo0LGE9dD09PSJIMjY0Ij8xOjIscj1QKGkuc3ViYXJyYXkocythKSksYz1xKHIpO3N3aXRjaChjLnR5cGUpe2Nhc2UgSC5QSUNfVElNSU5HOmooZSxjLmNvbnRlbnQpO2JyZWFrO2Nhc2UgSC5VU0VSX0RBVEFfVU5SRUdJU1RFUkVEOlkoZSxjLmNvbnRlbnQpO2JyZWFrfX0pLGV9ZnVuY3Rpb24gJChuKXtyZXR1cm4vXlswLTlhLWZBLUZdezh9LVswLTlhLWZBLUZdezR9LVswLTlhLWZBLUZdezR9LVswLTlhLWZBLUZdezR9LVswLTlhLWZBLUZdezEyfSQvLnRlc3Qobil9ZnVuY3Rpb24gVChuKXtyZXR1cm4gbi5yZXBsYWNlKC8tL2csIiIpLm1hdGNoKC8uezEsMn0vZykubWFwKHQ9PnBhcnNlSW50KHQsMTYpKX1mdW5jdGlvbiBKKG4sdCxlKXtjb25zdCBpPW5ldyBVaW50OEFycmF5KFQobikpLHM9TChlKSxhPW5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShKU09OLnN0cmluZ2lmeSh0KSkscj1uZXcgVWludDhBcnJheShpLmxlbmd0aCtzLmxlbmd0aCthLmxlbmd0aCk7cmV0dXJuIHIuc2V0KGkpLHIuc2V0KHMsaS5sZW5ndGgpLHIuc2V0KGEscy5sZW5ndGgraS5sZW5ndGgpLHJ9ZnVuY3Rpb24gSyhuKXtjb25zdCB0PVtdLGU9TWF0aC5mbG9vcihuLmJ5dGVMZW5ndGgvMjU1KSxpPW4uYnl0ZUxlbmd0aCUyNTU7Zm9yKGxldCBzPTA7czxlO3MrKyl0LnB1c2goMjU1KTtyZXR1cm4gdC5wdXNoKGkpLG5ldyBVaW50OEFycmF5KFs1LC4uLnRdKX1mdW5jdGlvbiBaKG4pe2NvbnN0IHQ9W107Zm9yKGxldCBlPTA7ZTxuLmJ5dGVMZW5ndGg7ZSsrKWUrMjxuLmJ5dGVMZW5ndGgmJlswLDEsMiwzXS5pbmNsdWRlcyhuW2UrMl0pJiZuW2VdPT09MCYmbltlKzFdPT09MD8odC5wdXNoKG5bZV0pLHQucHVzaChuW2UrMV0pLGUrPTIsdC5wdXNoKDMpKTp0LnB1c2gobltlXSk7cmV0dXJuIHQucHVzaCgxMjgpLG5ldyBVaW50OEFycmF5KHQpfWZ1bmN0aW9uIEwobil7Y29uc3QgdD1bXTtpZighaXNOYU4obikpe2NvbnN0IGU9QmlnSW50KG4pO2ZvcihsZXQgaT0wO2k8TWF0aC5jZWlsKE1hdGguZmxvb3IoTWF0aC5sb2cyKG5ldyBOdW1iZXIobikpKzEpLzgpO2krKyl0LnVuc2hpZnQobmV3IE51bWJlcihlPj5CaWdJbnQoOCppKSZCaWdJbnQoMjU1KSkpfXJldHVybiBuZXcgVWludDhBcnJheSh0KX1mdW5jdGlvbiBRKHt1dWlkOm4scGF5bG9hZDp0LHRpbWVjb2RlOmV9KXtjb25zdCBpPVswLDAsMCwxXSxzPVsxMDJdLGE9SihuLHQsZSkscj1LKGEpLGM9WihhKSxvPW5ldyBVaW50OEFycmF5KGkubGVuZ3RoK3MubGVuZ3RoK3IubGVuZ3RoK2MubGVuZ3RoKTtyZXR1cm4gby5zZXQoaSksby5zZXQocyxpLmxlbmd0aCksby5zZXQocixpLmxlbmd0aCtzLmxlbmd0aCksby5zZXQoYyxpLmxlbmd0aCtzLmxlbmd0aCtyLmxlbmd0aCksb31mdW5jdGlvbiBlZSh7dXVpZDpuLHBheWxvYWQ6dCx0aW1lY29kZTplfSxpKXtpZihuPT09IiJ8fHQ9PT0iIil0aHJvdyBuZXcgRXJyb3IoInV1aWQgYW5kIHBheWxvYWQgY2Fubm90IGJlIGVtcHR5Iik7JChuKXx8KGNvbnNvbGUud2FybigiSW52YWxpZCBVVUlELiBVc2luZyBkZWZhdWx0IFVVSUQuIiksbj1BLGU9RGF0ZS5ub3coKSk7Y29uc3Qgcz1RKHt1dWlkOm4scGF5bG9hZDp0LHRpbWVjb2RlOmV9KSxhPW5ldyBEYXRhVmlldyhpLmRhdGEpLHI9bmV3IEFycmF5QnVmZmVyKGkuZGF0YS5ieXRlTGVuZ3RoK3MuYnl0ZUxlbmd0aCksYz1uZXcgRGF0YVZpZXcocik7Zm9yKGxldCBvPTA7bzxpLmRhdGEuYnl0ZUxlbmd0aDtvKyspYy5zZXRVaW50OChvLGEuZ2V0VWludDgobykpO2ZvcihsZXQgbz0wO288cy5ieXRlTGVuZ3RoO28rKyljLnNldFVpbnQ4KGkuZGF0YS5ieXRlTGVuZ3RoK28sc1tvXSk7aS5kYXRhPXJ9Y29uc3QgdGU9MmUzLHk9W107bGV0IFM9IiIsaz17fTtjb25zdCBiPXt9O2xldCB4PVtdO2Z1bmN0aW9uIHYobil7cmV0dXJuIG5ldyBUcmFuc2Zvcm1TdHJlYW0oe3N0YXJ0KCl7fSxmbHVzaCgpe30sYXN5bmMgdHJhbnNmb3JtKHQsZSl7dmFyIGkscztpZih0IGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGE9KChpPWtbdC5nZXRNZXRhZGF0YSgpLnBheWxvYWRUeXBlXSk9PW51bGw/dm9pZCAwOmkudG9VcHBlckNhc2UoKSl8fChTPT1udWxsP3ZvaWQgMDpTLnRvVXBwZXJDYXNlKCkpO2lmKGE9PT0iSDI2NCIpe2NvbnN0IHI9WCh0LGEpOyhyLnRpbWVjb2RlfHxyLnVucmVnaXN0ZXJlZHx8KChzPXIuc2VpUGljVGltaW5nVGltZUNvZGVBcnJheSk9PW51bGw/dm9pZCAwOnMubGVuZ3RoKT4wKSYmc2VsZi5wb3N0TWVzc2FnZSh7bWlkOm4sbWV0YWRhdGE6cn0pfX1lLmVucXVldWUodCl9fSl9ZnVuY3Rpb24gTygpe09iamVjdC5rZXlzKGIpLnNvcnQoKS5qb2luKCk9PT14LnNvcnQoKS5qb2luKCkmJih5LnNoaWZ0KCkseD1bXSl9ZnVuY3Rpb24gbmUobil7Y29uc3QgdD1uZXcgRGF0ZSgpLmdldFRpbWUoKTtiW25dPXQsT2JqZWN0LmtleXMoYikuZmlsdGVyKGk9PnQtYltpXT50ZSkuZm9yRWFjaChpPT57ZGVsZXRlIGJbaV0sZGVsZXRlIHhbaV19KSxPKCl9ZnVuY3Rpb24gTSgpe3JldHVybiBuZXcgVHJhbnNmb3JtU3RyZWFtKHtzdGFydCgpe30sZmx1c2goKXt9LGFzeW5jIHRyYW5zZm9ybShuLHQpe2lmKG4gaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgaT1uLmdldE1ldGFkYXRhKCkuc3luY2hyb25pemF0aW9uU291cmNlO2lmKG5lKGkpLCF4LmluY2x1ZGVzKGkpJiZ5Lmxlbmd0aCl0cnl7aWYoIS8oaDI2WzRdKS8udGVzdChTKSl0aHJvdyBuZXcgRXJyb3IoIlNlbmRpbmcgbWV0YWRhdGEgaXMgbm90IHN1cHBvcnRlZCB3aXRoIGFueSBvdGhlciBjb2RlYyBvdGhlciB0aGFuIEguMjY0Iik7eVswXS51dWlkPT09QSYmKHlbMF0udGltZWNvZGU9RGF0ZS5ub3coKSksZWUoeVswXSxuKSx4LnB1c2goaSl9Y2F0Y2gocyl7Y29uc29sZS5lcnJvcihzKX1maW5hbGx5e08oKX19dC5lbnF1ZXVlKG4pfX0pfWZ1bmN0aW9uIEIoe3JlYWRhYmxlOm4sd3JpdGFibGU6dH0sZSl7bi5waXBlVGhyb3VnaChlKS5waXBlVG8odCl9YWRkRXZlbnRMaXN0ZW5lcigicnRjdHJhbnNmb3JtIixuPT57bGV0IHQ7aWYobi50cmFuc2Zvcm1lci5vcHRpb25zLm5hbWU9PT0ic2VuZGVyVHJhbnNmb3JtIilTPW4udHJhbnNmb3JtZXIub3B0aW9ucy5jb2RlYyx0PU0oKTtlbHNlIGlmKG4udHJhbnNmb3JtZXIub3B0aW9ucy5uYW1lPT09InJlY2VpdmVyVHJhbnNmb3JtIilrPW4udHJhbnNmb3JtZXIub3B0aW9ucy5wYXlsb2FkVHlwZUNvZGVjfHx7fSxTPW4udHJhbnNmb3JtZXIub3B0aW9ucy5jb2RlY3x8IiIsdD12KG4udHJhbnNmb3JtZXIub3B0aW9ucy5taWQpO2Vsc2UgcmV0dXJuO0Iobi50cmFuc2Zvcm1lcix0KX0pLGFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLG49Pntjb25zdHthY3Rpb246dH09bi5kYXRhO3N3aXRjaCh0KXtjYXNlImluc2VydGFibGUtc3RyZWFtcy1zZW5kZXIiOlM9bi5kYXRhLmNvZGVjLEIobi5kYXRhLE0oKSk7YnJlYWs7Y2FzZSJpbnNlcnRhYmxlLXN0cmVhbXMtcmVjZWl2ZXIiOms9bi5kYXRhLnBheWxvYWRUeXBlQ29kZWN8fHt9LFM9bi5kYXRhLmNvZGVjfHwiIixCKG4uZGF0YSx2KG4uZGF0YS5taWQpKTticmVhaztjYXNlIm1ldGFkYXRhLXNlaS11c2VyLWRhdGEtdW5yZWdpc3RlcmVkIjp5LnB1c2goe3V1aWQ6bi5kYXRhLnV1aWQscGF5bG9hZDpuLmRhdGEucGF5bG9hZH0pO2JyZWFrfX0pfSkoKTsK",qi=c=>Uint8Array.from(atob(c),e=>e.charCodeAt(0)),cn=typeof window<"u"&&window.Blob&&new Blob([qi(ls)],{type:"text/javascript;charset=utf-8"});function us(c){let e;try{if(e=cn&&(window.URL||window.webkitURL).createObjectURL(cn),!e)throw"";const d=new Worker(e,{name:c==null?void 0:c.name});return d.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(e)}),d}catch(d){return new Worker("data:text/javascript;base64,"+ls,{name:c==null?void 0:c.name})}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}const ye=Oe.get("Publish"),or={mediaStream:null,bandwidth:0,metadata:!1,disableVideo:!1,disableAudio:!1,codec:Se.H264,simulcast:!1,scalabilityMode:null,peerConfig:{autoInitStats:!0,statsIntervalMs:1e3}};class eo extends as{constructor(e,d,w=!0){e&&ye.warn("The streamName property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, set via token generator"),super(null,d,ye,w)}async connect(e=or){const d=ue.object({sourceId:ue.string(),stereo:ue.boolean(),dtx:ue.boolean(),absCaptureTime:ue.boolean(),dependencyDescriptor:ue.boolean(),mediaStream:ue.alternatives().try(ue.array().items(ue.object()),ue.object()),bandwidth:ue.number(),metadata:ue.boolean(),disableVideo:ue.boolean(),disableAudio:ue.boolean(),codec:ue.string().valid(...Object.values(Se)),simulcast:ue.boolean(),scalabilityMode:ue.string(),peerConfig:ue.object(),record:ue.boolean(),events:ue.array().items(ue.string().valid("active","inactive","viewercount")),priority:ue.number()}),{error:w,value:C}=d.validate(e);w&&ye.warn(w,C),this.options=be(q(q({},or),e),{peerConfig:q(q({},or.peerConfig),e.peerConfig),setSDPToPeer:!1}),this.options.metadata=this.options.metadata&&this.options.codec===Se.H264&&!this.options.disableVideo,await this.initConnection({migrate:!1})}async reconnect(e){var d,w;this.options.mediaStream=(w=(d=this.webRTCPeer)==null?void 0:d.getTracks())!=null?w:this.options.mediaStream,super.reconnect(e)}async replaceConnection(){var e,d;ye.info("Migrating current connection"),this.options.mediaStream=(d=(e=this.webRTCPeer)==null?void 0:e.getTracks())!=null?d:this.options.mediaStream,await this.initConnection({migrate:!0})}async record(){var e;this.recordingAvailable?(this.options.record=!0,await((e=this.signaling)==null?void 0:e.cmd("record")),ye.info("Broadcaster start recording")):ye.error("Record not available")}async unrecord(){var e;this.recordingAvailable?(this.options.record=!1,await((e=this.signaling)==null?void 0:e.cmd("unrecord")),ye.info("Broadcaster stop recording")):ye.error("Unrecord not available")}stop(){var e;super.stop(),(e=this.worker)==null||e.terminate(),this.worker=null}async initConnection(e){var r,l;ye.debug("Broadcast option values: ",this.options),this.stopReconnection=!1;let d;if(!this.options.mediaStream)throw ye.error("Error while broadcasting. MediaStream required"),new Error("MediaStream required");if(!e.migrate&&this.isActive())throw ye.warn("Broadcast currently working"),new Error("Broadcast currently working");let w;try{w=await this.tokenGenerator(),this.options.peerConfig.iceServers=w==null?void 0:w.iceServers,this.options.peerConfig.encodedInsertableStreams=this.options.metadata}catch(a){throw ye.error("Error generating token."),a instanceof zt&&(a.status===401||!this.autoReconnect?this.stopReconnection=!0:this.reconnect()),a}if(!w)throw ye.error("Error while broadcasting. Publisher data required"),new Error("Publisher data required");const C=is(w.jwt);if(this.streamName=C.millicast.streamName,this.recordingAvailable=C[Hi.atob("bWlsbGljYXN0")].record,this.options.record&&!this.recordingAvailable)throw ye.error("Error while broadcasting. Record option detected but recording is not available"),new Error("Record option detected but recording is not available");const b=new jr({streamName:this.streamName,url:"".concat(w.urls[0],"?token=").concat(w.jwt)}),m=e.migrate?new je:this.webRTCPeer;await m.createRTCPeer(this.options.peerConfig,Gt.Publisher),(r=this.stopReemitingWebRTCPeerInstanceEvents)==null||r.call(this),(l=this.stopReemitingSignalingInstanceEvents)==null||l.call(this),this.stopReemitingWebRTCPeerInstanceEvents=ft(m,this,[Le.connectionStateChange]),this.stopReemitingSignalingInstanceEvents=ft(b,this,[Ne.broadcastEvent]);const t=m.getRTCLocalSDP(this.options),v=b.connect();d=await Promise.all([t,v]);const y=d[0];this.options.metadata&&(this.worker||(this.worker=new us),this.getRTCPeerConnection().getSenders().forEach(u=>{if(cs)u.transform=new RTCRtpScriptTransform(this.worker,{name:"senderTransform",codec:this.options.codec});else if(br){const{readable:f,writable:p}=u.createEncodedStreams();this.worker.postMessage({action:"insertable-streams-sender",codec:this.options.codec,readable:f,writable:p},[f,p])}}));let h=this.signaling;this.signaling=b;const n=this.signaling.publish(y,this.options),i=m.peer.setLocalDescription(m.sessionDescription);d=await Promise.all([n,i]);let o=d[0];!this.options.disableVideo&&this.options.bandwidth>0&&(o=m.updateBandwidthRestriction(o,this.options.bandwidth)),await m.setRTCRemoteSDP(o),ye.info("Broadcasting to streamName: ",this.streamName);let s=this.webRTCPeer;this.webRTCPeer=m,this.setReconnect(),e.migrate&&this.webRTCPeer.on(Le.connectionStateChange,a=>{var u,f;["connected","disconnected","failed","closed"].includes(a)&&((u=h==null?void 0:h.close)==null||u.call(h),(f=s==null?void 0:s.closeRTCPeer)==null||f.call(s),h=s=null)})}sendMetadata(e,d=Pi){var w;if((w=this.options)!=null&&w.metadata&&this.worker)this.worker.postMessage({action:"metadata-sei-user-data-unregistered",uuid:d,payload:e});else{let C="Could not send metadata due to:";this.options?this.options.metadata?this.worker||(C+="\n- Stream not being published."):(C+="\n- Metadata option is not enabled.",this.options.codec!==Se.H264&&(C+="\n- Incompatible codec. Only H264 available."),this.options.disableVideo&&(C+="\n- Video disabled.")):C+="\n- Stream not being published.",ye.warn(C)}}}const he=Oe.get("View"),ar={metadata:!1,disableVideo:!1,disableAudio:!1,peerConfig:{autoInitStats:!0,statsIntervalMs:1e3}};class to extends as{constructor(e,d,w=null,C=!0){e&&he.warn("The streamName property has been deprecated. In a future release, this will be removed. Please do not rely on this value. Instead, set via token generator"),super(null,d,he,C),this.payloadTypeCodec={},this.tracksMidValues={},w&&this.on(Le.track,b=>{w.srcObject=b.streams[0]})}async connect(e=ar){this.options=be(q(q({},ar),e),{peerConfig:q(q({},ar.peerConfig),e.peerConfig),setSDPToPeer:!1}),await this.initConnection({migrate:!1})}async select(e={}){he.debug("Viewer select layer values: ",e),await this.signaling.cmd("select",{layer:e}),he.info("Connected to streamName: ",this.streamName)}async addRemoteTrack(e,d){return he.info("Viewer adding remote % track",e),this.webRTCPeer.addRemoteTrack(e,d)}async project(e,d){for(const w of d){if(!w.trackId&&!w.media)throw he.error("Error in projection mapping, trackId or mediaId must be set"),new Error("Error in projection mapping, trackId or mediaId must be set");const C=this.webRTCPeer.getRTCPeer();if(w.mediaId&&!C.getTransceivers().find(b=>b.mid===w.mediaId.toString()))throw he.error("Error in projection mapping, ".concat(w.mediaId," mid not found in local transceivers")),new Error("Error in projection mapping, ".concat(w.mediaId," mid not found in local transceivers"))}he.debug("Viewer project source: layer mappings: ",e,d),await this.signaling.cmd("project",{sourceId:e,mapping:d}),he.info("Projection done")}async unproject(e){he.debug("Viewer unproject mediaIds: ",e),await this.signaling.cmd("unproject",{mediaIds:e}),he.info("Unprojection done")}async replaceConnection(){he.info("Migrating current connection"),await this.initConnection({migrate:!0})}stop(){var e;super.stop(),(e=this.worker)==null||e.terminate(),this.worker=null,this.payloadTypeCodec={},this.tracksMidValues={}}async initConnection(e){var r,l;he.debug("Viewer connect options values: ",this.options),this.stopReconnection=!1;let d;if(!e.migrate&&this.isActive())throw he.warn("Viewer currently subscribed"),new Error("Viewer currently subscribed");let w;try{w=await this.tokenGenerator(),this.options.peerConfig.iceServers=w==null?void 0:w.iceServers,this.options.metadata&&(this.options.peerConfig.encodedInsertableStreams=br)}catch(a){throw he.error("Error generating token."),a instanceof zt&&(a.status===401||!this.autoReconnect?this.stopReconnection=!0:this.reconnect()),a}if(!w)throw he.error("Error while subscribing. Subscriber data required"),new Error("Subscriber data required");const C=is(w.jwt);this.streamName=C.millicast.streamName;const b=new jr({streamName:this.streamName,url:"".concat(w.urls[0],"?token=").concat(w.jwt)}),m=e.migrate?new je:this.webRTCPeer;await m.createRTCPeer(this.options.peerConfig),(r=this.stopReemitingWebRTCPeerInstanceEvents)==null||r.call(this),(l=this.stopReemitingSignalingInstanceEvents)==null||l.call(this),this.stopReemitingWebRTCPeerInstanceEvents=ft(m,this,Object.values(Le)),this.stopReemitingSignalingInstanceEvents=ft(b,this,[Ne.broadcastEvent]),this.options.metadata&&(this.worker||(this.worker=new us),m.on("track",a=>{var u,f,p;if(this.tracksMidValues[(u=a.transceiver)==null?void 0:u.mid]=a.track,cs)a.receiver.transform=new RTCRtpScriptTransform(this.worker,{name:"receiverTransform",payloadTypeCodec:q({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(f=a.transceiver)==null?void 0:f.mid});else if(br){const{readable:_,writable:k}=a.receiver.createEncodedStreams();this.worker.postMessage({action:"insertable-streams-receiver",payloadTypeCodec:q({},this.payloadTypeCodec),codec:this.options.metadata&&"h264",mid:(p=a.transceiver)==null?void 0:p.mid,readable:_,writable:k},[_,k])}}),this.worker.onmessage=a=>{const u=new TextDecoder,f=a.data.metadata;if(f.mid=a.data.mid,f.track=this.tracksMidValues[a.data.mid],f.uuid){const p=f.uuid;f.uuid=p.reduce((_,k)=>_+k.toString(16).padStart(2,"0"),""),f.uuid=f.uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5")}if(f.timecode&&(f.timecode=new Date(u.decode(f.timecode))),f.unregistered){const p=u.decode(f.unregistered);try{const _=JSON.parse(p);f.unregistered=_}catch(_){he.info("The content could not be converted to JSON, returning raw bytes instead")}}this.emit("metadata",f),this.emit("onMetadata",f)});const t=m.getRTCLocalSDP(be(q({},this.options),{stereo:!0})),v=b.connect();d=await Promise.all([t,v]);const y=d[0];let h=this.signaling;this.signaling=b;const n=this.signaling.subscribe(y,be(q({},this.options),{vad:this.options.multiplexedAudioTracks>0})),i=m.peer.setLocalDescription(m.sessionDescription);d=await Promise.all([n,i]);const o=d[0];this.payloadTypeCodec=me.getCodecPayloadType(o),await m.setRTCRemoteSDP(o),he.info("Connected to streamName: ",this.streamName);let s=this.webRTCPeer;this.webRTCPeer=m,this.setReconnect(),e.migrate&&this.webRTCPeer.on(Le.connectionStateChange,a=>{var u,f;a==="connected"?setTimeout(()=>{var p,_;(p=h==null?void 0:h.close)==null||p.call(h),(_=s==null?void 0:s.closeRTCPeer)==null||_.call(s),h=s=null,he.info("Current connection migrated")},1e3):["disconnected","failed","closed"].includes(a)&&((u=h==null?void 0:h.close)==null||u.call(h),(f=s==null?void 0:s.closeRTCPeer)==null||f.call(s),h=s=null)})}}exports.Director=kt;exports.Logger=Oe;exports.PeerConnection=je;exports.Publish=eo;exports.Signaling=jr;exports.View=to;
